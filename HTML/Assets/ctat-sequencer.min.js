/*
 MIT License - https://bitbucket.org/pellepim/jstimezonedetect/src/default/LICENCE.txt

 For usage and examples, visit:
 http://pellepim.bitbucket.org/jstz/

 Copyright (c) Jon Nylander
*/
var $jscomp={scope:{},checkStringArgs:function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""}};
$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var e=b.length,h=a.length;c=Math.max(0,Math.min(c|0,b.length));for(var g=0;g<h&&c<e;)if(b[c++]!=a[g++])return!1;return g>=h}},"es6-impl","es3");
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"endsWith");a+="";void 0===c&&(c=b.length);c=Math.max(0,Math.min(c|0,b.length));for(var e=a.length;0<e&&0<c;)if(b[--c]!=a[--e])return!1;return 0>=e}},"es6-impl","es3");$jscomp.polyfill("Number.isNaN",function(a){return a?a:function(a){return"number"===typeof a&&isNaN(a)}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}},"es6-impl","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;
$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill("WeakMap",function(a){function b(a){$jscomp.owns(a,d)||$jscomp.defineProperty(a,d,{value:{}})}function c(a){var c=Object[a];c&&(Object[a]=function(a){b(a);return c(a)})}if(function(){if(!a||!Object.seal)return!1;try{var b=Object.seal({}),c=Object.seal({}),d=new a([[b,2],[c,3]]);if(2!=d.get(b)||3!=d.get(c))return!1;d.delete(b);d.set(c,4);return!d.has(b)&&4==d.get(c)}catch(q){return!1}}())return a;var d="$jscomp_hidden_"+Math.random().toString().substring(2);c("freeze");c("preventExtensions");
c("seal");var e=0,h=function(a){this.id_=(e+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};h.prototype.set=function(a,c){b(a);if(!$jscomp.owns(a,d))throw Error("WeakMap key fail: "+a);a[d][this.id_]=c;return this};h.prototype.get=function(a){return $jscomp.owns(a,d)?a[d][this.id_]:void 0};h.prototype.has=function(a){return $jscomp.owns(a,d)&&$jscomp.owns(a[d],this.id_)};h.prototype.delete=
function(a){return $jscomp.owns(a,d)&&$jscomp.owns(a[d],this.id_)?delete a[d][this.id_]:!1};return h},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_MAP=!1;
$jscomp.polyfill("Map",function(a){if(!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([[b,"s"]]));if("s"!=c.get(b)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var d=c.entries(),g=d.next();if(g.done||g.value[0]!=b||"s"!=g.value[1])return!1;g=d.next();return g.done||4!=g.value[0].x||"t"!=g.value[1]||!d.next().done?!1:!0}catch(f){return!1}}())return a;$jscomp.initSymbol();
$jscomp.initSymbolIterator();var b=new WeakMap,c=function(a){this.data_={};this.head_=h();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};c.prototype.set=function(a,b){var c=d(this,a);c.list||(c.list=this.data_[c.id]=[]);c.entry?c.entry.value=b:(c.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,value:b},c.list.push(c.entry),this.head_.previous.next=c.entry,this.head_.previous=c.entry,this.size++);return this};c.prototype.delete=
function(a){a=d(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};c.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=h();this.size=0};c.prototype.has=function(a){return!!d(this,a).entry};c.prototype.get=function(a){return(a=d(this,a).entry)&&a.value};c.prototype.entries=function(){return e(this,function(a){return[a.key,
a.value]})};c.prototype.keys=function(){return e(this,function(a){return a.key})};c.prototype.values=function(){return e(this,function(a){return a.value})};c.prototype.forEach=function(a,b){for(var c=this.entries(),d;!(d=c.next()).done;)d=d.value,a.call(b,d[1],d[0],this)};c.prototype[Symbol.iterator]=c.prototype.entries;var d=function(a,c){var d;d=c&&typeof c;"object"==d||"function"==d?b.has(c)?d=b.get(c):(d=""+ ++g,b.set(c,d)):d="p_"+c;var n=a.data_[d];if(n&&$jscomp.owns(a.data_,d))for(a=0;a<n.length;a++){var f=
n[a];if(c!==c&&f.key!==f.key||c===f.key)return{id:d,list:n,index:a,entry:f}}return{id:d,list:n,index:-1,entry:void 0}},e=function(a,b){var c=a.head_;return $jscomp.iteratorPrototype(function(){if(c){for(;c.head!=a.head_;)c=c.previous;for(;c.next!=c.head;)return c=c.next,{done:!1,value:b(c)};c=null}return{done:!0,value:void 0}})},h=function(){var a={};return a.previous=a.next=a.head=a},g=0;return c},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.polyfill("Set",function(a){if(!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),d=new a($jscomp.makeIterator([b]));if(!d.has(b)||1!=d.size||d.add(b)!=d||1!=d.size||d.add({x:4})!=d||2!=d.size)return!1;var e=d.entries(),h=e.next();if(h.done||h.value[0]!=b||h.value[1]!=b)return!1;h=e.next();return h.done||h.value[0]==b||4!=h.value[0].x||h.value[1]!=h.value[0]?!1:e.next().done}catch(g){return!1}}())return a;
$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=function(a){this.map_=new Map;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)this.add(b.value)}this.size=this.map_.size};b.prototype.add=function(a){this.map_.set(a,a);this.size=this.map_.size;return this};b.prototype.delete=function(a){a=this.map_.delete(a);this.size=this.map_.size;return a};b.prototype.clear=function(){this.map_.clear();this.size=0};b.prototype.has=function(a){return this.map_.has(a)};b.prototype.entries=function(){return this.map_.entries()};
b.prototype.values=function(){return this.map_.values()};b.prototype[Symbol.iterator]=b.prototype.values;b.prototype.forEach=function(a,b){var c=this;this.map_.forEach(function(d){return a.call(b,d,d,c)})};return b},"es6-impl","es3");$jscomp.polyfill("Object.assign",function(a){return a?a:function(a,c){for(var b=1;b<arguments.length;b++){var e=arguments[b];if(e)for(var h in e)$jscomp.owns(e,h)&&(a[h]=e[h])}return a}},"es6-impl","es3");
$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6-impl","es3");$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,c){return c})}},"es6","es3");$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var h=a[e];if(b.call(c,h,e,a))return{i:e,v:h}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).i}},"es6-impl","es3");$jscomp.polyfill("Object.setPrototypeOf",function(a){return a?a:"object"!=typeof"".__proto__?null:function(a,c){a.__proto__=c;if(a.__proto__!==c)throw new TypeError(a+" is not extensible");return a}},"es6","es5");
var jstz=function(){var a={"America/Denver":["America/Mazatlan"],"Europe/London":["Africa/Casablanca"],"America/Chicago":["America/Mexico_City"],"America/Asuncion":["America/Campo_Grande","America/Santiago"],"America/Montevideo":["America/Sao_Paulo","America/Santiago"],"Asia/Beirut":"Asia/Amman Asia/Jerusalem Europe/Helsinki Asia/Damascus Africa/Cairo Asia/Gaza Europe/Minsk".split(" "),"Pacific/Auckland":["Pacific/Fiji"],"America/Los_Angeles":["America/Santa_Isabel"],"America/New_York":["America/Havana"],
"America/Halifax":["America/Goose_Bay"],"America/Godthab":["America/Miquelon"],"Asia/Dubai":["Asia/Yerevan"],"Asia/Jakarta":["Asia/Krasnoyarsk"],"Asia/Shanghai":["Asia/Irkutsk","Australia/Perth"],"Australia/Sydney":["Australia/Lord_Howe"],"Asia/Tokyo":["Asia/Yakutsk"],"Asia/Dhaka":["Asia/Omsk"],"Asia/Baku":["Asia/Yerevan"],"Australia/Brisbane":["Asia/Vladivostok"],"Pacific/Noumea":["Asia/Vladivostok"],"Pacific/Majuro":["Asia/Kamchatka","Pacific/Fiji"],"Pacific/Tongatapu":["Pacific/Apia"],"Asia/Baghdad":["Europe/Minsk",
"Europe/Moscow"],"Asia/Karachi":["Asia/Yekaterinburg"],"Africa/Johannesburg":["Asia/Gaza","Africa/Cairo"]},b=function(a){a=-a.getTimezoneOffset();return null!==a?a:0},c=function(){var a=b(new Date(2014,0,2)),c=b(new Date(2014,5,2)),d=a-c;return 0>d?a+",1":0<d?c+",1,s":a+",0"},d=function(){var a;if("undefined"!==typeof Intl&&"undefined"!==typeof Intl.DateTimeFormat&&(a=Intl.DateTimeFormat(),"undefined"!==typeof a&&"undefined"!==typeof a.resolvedOptions&&(a=a.resolvedOptions().timeZone)&&(-1<a.indexOf("/")||
"UTC"===a)))return a},e=function q(a,b,c){"undefined"===typeof b&&(b=864E5,c=36E5);var f=(new Date(a.getTime()-b)).getTime();a=a.getTime()+b;for(var d=(new Date(f)).getTimezoneOffset(),m=null;f<a-c;){var r=new Date(f);if(r.getTimezoneOffset()!==d){m=r;break}f+=c}return 864E5===b?q(m,36E5,6E4):36E5===b?q(m,6E4,1E3):m},h=function(a,b,c,d){if("N/A"!==c)return c;if("Asia/Beirut"===b){if("Africa/Cairo"===d.name&&13983768E5===a[6].s&&14116788E5===a[6].e||"Asia/Jerusalem"===d.name&&13959648E5===a[6].s&&
14118588E5===a[6].e)return 0}else if("America/Santiago"===b){if("America/Asuncion"===d.name&&14124816E5===a[6].s&&1397358E6===a[6].e||"America/Campo_Grande"===d.name&&14136912E5===a[6].s&&13925196E5===a[6].e)return 0}else if("America/Montevideo"===b){if("America/Sao_Paulo"===d.name&&14136876E5===a[6].s&&1392516E6===a[6].e)return 0}else if("Pacific/Auckland"===b&&"Pacific/Fiji"===d.name&&14142456E5===a[6].s&&13961016E5===a[6].e)return 0;return c},g=function(b,c){for(var f={},d=jstz.olson.dst_rules.zones,
g=d.length,e=a[c],m=0;m<g;m++){var r=d[m],z;z=d[m];for(var k=0,l=0;l<b.length;l++)if(z.rules[l]&&b[l]){if(b[l].s>=z.rules[l].s&&b[l].e<=z.rules[l].e)k=0,k+=Math.abs(b[l].s-z.rules[l].s),k+=Math.abs(z.rules[l].e-b[l].e);else{k="N/A";break}if(864E6<k){k="N/A";break}}z=k=h(b,c,k,z);"N/A"!==z&&(f[r.name]=z)}for(var q in f)if(f.hasOwnProperty(q))for(b=0;b<e.length;b++)if(e[b]===q)return q;return c},k=function(a){var b=function(){for(var a=[],b=0;b<jstz.olson.dst_rules.years.length;b++){var c;c=jstz.olson.dst_rules.years[b];
var d=(new Date(c,0,1,0,0,1,0)).getTime();c=(new Date(c,12,31,23,59,59)).getTime();for(var m=(new Date(d)).getTimezoneOffset(),r=null,g=null;d<c-864E5;){var k=new Date(d),l=k.getTimezoneOffset();l!==m&&(l<m&&(r=k),l>m&&(g=k),m=l);d+=864E5}c=r&&g?{s:e(r).getTime(),e:e(g).getTime()}:!1;a.push(c)}return a}();return function(a){for(var b=0;b<a.length;b++)if(!1!==a[b])return!0;return!1}(b)?g(b,a):a};return{determine:function(){var b=d();b||(b=jstz.olson.timezones[c()],"undefined"!==typeof a[b]&&(b=k(b)));
return{name:function(){return b}}}}}();jstz.olson=jstz.olson||{};
jstz.olson.timezones={"-720,0":"Etc/GMT+12","-660,0":"Pacific/Pago_Pago","-660,1,s":"Pacific/Apia","-600,1":"America/Adak","-600,0":"Pacific/Honolulu","-570,0":"Pacific/Marquesas","-540,0":"Pacific/Gambier","-540,1":"America/Anchorage","-480,1":"America/Los_Angeles","-480,0":"Pacific/Pitcairn","-420,0":"America/Phoenix","-420,1":"America/Denver","-360,0":"America/Guatemala","-360,1":"America/Chicago","-360,1,s":"Pacific/Easter","-300,0":"America/Bogota","-300,1":"America/New_York","-270,0":"America/Caracas",
"-240,1":"America/Halifax","-240,0":"America/Santo_Domingo","-240,1,s":"America/Asuncion","-210,1":"America/St_Johns","-180,1":"America/Godthab","-180,0":"America/Argentina/Buenos_Aires","-180,1,s":"America/Montevideo","-120,0":"America/Noronha","-120,1":"America/Noronha","-60,1":"Atlantic/Azores","-60,0":"Atlantic/Cape_Verde","0,0":"UTC","0,1":"Europe/London","60,1":"Europe/Berlin","60,0":"Africa/Lagos","60,1,s":"Africa/Windhoek","120,1":"Asia/Beirut","120,0":"Africa/Johannesburg","180,0":"Asia/Baghdad",
"180,1":"Europe/Moscow","210,1":"Asia/Tehran","240,0":"Asia/Dubai","240,1":"Asia/Baku","270,0":"Asia/Kabul","300,1":"Asia/Yekaterinburg","300,0":"Asia/Karachi","330,0":"Asia/Kolkata","345,0":"Asia/Kathmandu","360,0":"Asia/Dhaka","360,1":"Asia/Omsk","390,0":"Asia/Rangoon","420,1":"Asia/Krasnoyarsk","420,0":"Asia/Jakarta","480,0":"Asia/Shanghai","480,1":"Asia/Irkutsk","525,0":"Australia/Eucla","525,1,s":"Australia/Eucla","540,1":"Asia/Yakutsk","540,0":"Asia/Tokyo","570,0":"Australia/Darwin","570,1,s":"Australia/Adelaide",
"600,0":"Australia/Brisbane","600,1":"Asia/Vladivostok","600,1,s":"Australia/Sydney","630,1,s":"Australia/Lord_Howe","660,1":"Asia/Kamchatka","660,0":"Pacific/Noumea","690,0":"Pacific/Norfolk","720,1,s":"Pacific/Auckland","720,0":"Pacific/Majuro","765,1,s":"Pacific/Chatham","780,0":"Pacific/Tongatapu","780,1,s":"Pacific/Apia","840,0":"Pacific/Kiritimati"};jstz.olson.dst_rules={years:[2008,2009,2010,2011,2012,2013,2014],zones:[{name:"Africa/Cairo",rules:[{e:12199572E5,s:12090744E5},{e:1250802E6,s:1240524E6},{e:12858804E5,s:12840696E5},!1,!1,!1,{e:14116788E5,s:1406844E6}]},{name:"Africa/Casablanca",rules:[{e:12202236E5,s:12122784E5},{e:12508092E5,s:12438144E5},{e:1281222E6,s:12727584E5},{e:13120668E5,s:13017888E5},{e:13489704E5,s:1345428E6},{e:13828392E5,s:13761E8},{e:14142888E5,s:14069448E5}]},{name:"America/Asuncion",rules:[{e:12050316E5,s:12243888E5},
{e:12364812E5,s:12558384E5},{e:12709548E5,s:12860784E5},{e:13024044E5,s:1317528E6},{e:1333854E6,s:13495824E5},{e:1364094E6,s:1381032E6},{e:13955436E5,s:14124816E5}]},{name:"America/Campo_Grande",rules:[{e:12032172E5,s:12243888E5},{e:12346668E5,s:12558384E5},{e:12667212E5,s:1287288E6},{e:12981708E5,s:13187376E5},{e:13302252E5,s:1350792E6},{e:136107E7,s:13822416E5},{e:13925196E5,s:14136912E5}]},{name:"America/Goose_Bay",rules:[{e:122559486E4,s:120503526E4},{e:125704446E4,s:123648486E4},{e:128909886E4,
s:126853926E4},{e:13205556E5,s:129998886E4},{e:13520052E5,s:13314456E5},{e:13834548E5,s:13628952E5},{e:14149044E5,s:13943448E5}]},{name:"America/Havana",rules:[{e:12249972E5,s:12056436E5},{e:12564468E5,s:12364884E5},{e:12885012E5,s:12685428E5},{e:13211604E5,s:13005972E5},{e:13520052E5,s:13332564E5},{e:13834548E5,s:13628916E5},{e:14149044E5,s:13943412E5}]},{name:"America/Mazatlan",rules:[{e:1225008E6,s:12074724E5},{e:12564576E5,s:1238922E6},{e:1288512E6,s:12703716E5},{e:13199616E5,s:13018212E5},{e:13514112E5,
s:13332708E5},{e:13828608E5,s:13653252E5},{e:14143104E5,s:13967748E5}]},{name:"America/Mexico_City",rules:[{e:12250044E5,s:12074688E5},{e:1256454E6,s:12389184E5},{e:12885084E5,s:1270368E6},{e:1319958E6,s:13018176E5},{e:13514076E5,s:13332672E5},{e:13828572E5,s:13653216E5},{e:14143068E5,s:13967712E5}]},{name:"America/Miquelon",rules:[{e:12255984E5,s:12050388E5},{e:1257048E6,s:12364884E5},{e:12891024E5,s:12685428E5},{e:1320552E6,s:12999924E5},{e:13520016E5,s:1331442E6},{e:13834512E5,s:13628916E5},{e:14149008E5,
s:13943412E5}]},{name:"America/Santa_Isabel",rules:[{e:12250116E5,s:1207476E6},{e:12564612E5,s:12389256E5},{e:12885156E5,s:12703752E5},{e:13199652E5,s:13018248E5},{e:13514148E5,s:13332744E5},{e:13828644E5,s:13653288E5},{e:1414314E6,s:13967784E5}]},{name:"America/Santiago",rules:[{e:1206846E6,s:1223784E6},{e:1237086E6,s:12552336E5},{e:127035E7,s:12866832E5},{e:13048236E5,s:13138992E5},{e:13356684E5,s:13465584E5},{e:1367118E6,s:13786128E5},{e:13985676E5,s:14100624E5}]},{name:"America/Sao_Paulo",rules:[{e:12032136E5,
s:12243852E5},{e:12346632E5,s:12558348E5},{e:12667176E5,s:12872844E5},{e:12981672E5,s:1318734E6},{e:13302216E5,s:13507884E5},{e:13610664E5,s:1382238E6},{e:1392516E6,s:14136876E5}]},{name:"Asia/Amman",rules:[{e:1225404E6,s:12066552E5},{e:12568536E5,s:12381048E5},{e:12883032E5,s:12695544E5},{e:13197528E5,s:13016088E5},!1,!1,{e:14147064E5,s:13959576E5}]},{name:"Asia/Damascus",rules:[{e:12254868E5,s:120726E7},{e:125685E7,s:12381048E5},{e:12882996E5,s:12701592E5},{e:13197492E5,s:13016088E5},{e:13511988E5,
s:13330584E5},{e:13826484E5,s:1364508E6},{e:14147028E5,s:13959576E5}]},{name:"Asia/Dubai",rules:[!1,!1,!1,!1,!1,!1,!1]},{name:"Asia/Gaza",rules:[{e:12199572E5,s:12066552E5},{e:12520152E5,s:12381048E5},{e:1281474E6,s:126964086E4},{e:1312146E6,s:130160886E4},{e:13481784E5,s:13330584E5},{e:13802292E5,s:1364508E6},{e:1414098E6,s:13959576E5}]},{name:"Asia/Irkutsk",rules:[{e:12249576E5,s:12068136E5},{e:12564072E5,s:12382632E5},{e:12884616E5,s:12697128E5},!1,!1,!1,!1]},{name:"Asia/Jerusalem",rules:[{e:12231612E5,
s:12066624E5},{e:1254006E6,s:1238112E6},{e:1284246E6,s:12695616E5},{e:131751E7,s:1301616E6},{e:13483548E5,s:13330656E5},{e:13828284E5,s:13645152E5},{e:1414278E6,s:13959648E5}]},{name:"Asia/Kamchatka",rules:[{e:12249432E5,s:12067992E5},{e:12563928E5,s:12382488E5},{e:12884508E5,s:12696984E5},!1,!1,!1,!1]},{name:"Asia/Krasnoyarsk",rules:[{e:12249612E5,s:12068172E5},{e:12564108E5,s:12382668E5},{e:12884652E5,s:12697164E5},!1,!1,!1,!1]},{name:"Asia/Omsk",rules:[{e:12249648E5,s:12068208E5},{e:12564144E5,
s:12382704E5},{e:12884688E5,s:126972E7},!1,!1,!1,!1]},{name:"Asia/Vladivostok",rules:[{e:12249504E5,s:12068064E5},{e:12564E8,s:1238256E6},{e:12884544E5,s:12697056E5},!1,!1,!1,!1]},{name:"Asia/Yakutsk",rules:[{e:1224954E6,s:120681E7},{e:12564036E5,s:12382596E5},{e:1288458E6,s:12697092E5},!1,!1,!1,!1]},{name:"Asia/Yekaterinburg",rules:[{e:12249684E5,s:12068244E5},{e:1256418E6,s:1238274E6},{e:12884724E5,s:12697236E5},!1,!1,!1,!1]},{name:"Asia/Yerevan",rules:[{e:1224972E6,s:1206828E6},{e:12564216E5,s:12382776E5},
{e:1288476E6,s:12697272E5},{e:13199256E5,s:13011768E5},!1,!1,!1]},{name:"Australia/Lord_Howe",rules:[{e:12074076E5,s:12231342E5},{e:12388572E5,s:12545838E5},{e:12703068E5,s:12860334E5},{e:13017564E5,s:1317483E6},{e:1333206E6,s:13495374E5},{e:13652604E5,s:1380987E6},{e:139671E7,s:14124366E5}]},{name:"Australia/Perth",rules:[{e:12068136E5,s:12249576E5},!1,!1,!1,!1,!1,!1]},{name:"Europe/Helsinki",rules:[{e:12249828E5,s:12068388E5},{e:12564324E5,s:12382884E5},{e:12884868E5,s:1269738E6},{e:13199364E5,
s:13011876E5},{e:1351386E6,s:13326372E5},{e:13828356E5,s:13646916E5},{e:14142852E5,s:13961412E5}]},{name:"Europe/Minsk",rules:[{e:12249792E5,s:12068352E5},{e:12564288E5,s:12382848E5},{e:12884832E5,s:12697344E5},!1,!1,!1,!1]},{name:"Europe/Moscow",rules:[{e:12249756E5,s:12068316E5},{e:12564252E5,s:12382812E5},{e:12884796E5,s:12697308E5},!1,!1,!1,!1]},{name:"Pacific/Apia",rules:[!1,!1,!1,{e:13017528E5,s:13168728E5},{e:13332024E5,s:13489272E5},{e:13652568E5,s:13803768E5},{e:13967064E5,s:14118264E5}]},
{name:"Pacific/Fiji",rules:[!1,!1,{e:12696984E5,s:12878424E5},{e:13271544E5,s:1319292E6},{e:1358604E6,s:13507416E5},{e:139005E7,s:1382796E6},{e:14215032E5,s:14148504E5}]},{name:"Europe/London",rules:[{e:12249828E5,s:12068388E5},{e:12564324E5,s:12382884E5},{e:12884868E5,s:1269738E6},{e:13199364E5,s:13011876E5},{e:1351386E6,s:13326372E5},{e:13828356E5,s:13646916E5},{e:14142852E5,s:13961412E5}]}]};(function(a,b){"object"==typeof module&&module.exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Spinner=b()})(this,function(){function a(a,b){a=document.createElement(a||"div");for(var c in b)a[c]=b[c];return a}function b(a){for(var b=1,c=arguments.length;b<c;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var m=["opacity",b,~~(100*a),c,d].join("-");c=.01+c/d*100;d=Math.max(1-(1-a)/b*(100-c),a);var r=f.substring(0,f.indexOf("Animation")).toLowerCase();l[m]||
(t.insertRule("@"+(r&&"-"+r+"-"||"")+"keyframes "+m+"{0%{opacity:"+d+"}"+c+"%{opacity:"+a+"}"+(c+.01)+"%{opacity:1}"+(c+b)%100+"%{opacity:"+a+"}100%{opacity:"+d+"}}",t.cssRules.length),l[m]=1);return m}function d(a,b){a=a.style;var c,f;b=b.charAt(0).toUpperCase()+b.slice(1);if(void 0!==a[b])return b;for(f=0;f<q.length;f++)if(c=q[f]+b,void 0!==a[c])return c}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function h(a){for(var b=1;b<arguments.length;b++){var c=arguments[b],f;for(f in c)void 0===
a[f]&&(a[f]=c[f])}return a}function g(a,b){return"string"==typeof a?a:a[b%a.length]}function k(a){this.opts=h(a||{},k.defaults,p)}function n(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}t.addRule(".spin-vml","behavior:url(#default#VML)");k.prototype.lines=function(a,f){function d(){return e(c("group",{coordsize:t+" "+t,coordorigin:-r+" "+-r}),{width:t,height:t})}function m(a,m,k){b(p,b(e(d(),{rotation:360/f.lines*a+"deg",left:~~m}),b(e(c("roundrect",
{arcsize:f.corners}),{width:r,height:f.scale*f.width,left:f.scale*f.radius,top:-f.scale*f.width>>1,filter:k}),c("fill",{color:g(f.color,a),opacity:f.opacity}),c("stroke",{opacity:0}))))}var r=f.scale*(f.length+f.width),t=2*f.scale*r,k=-(f.width+f.length)*f.scale*2+"px",p=e(d(),{position:"absolute",top:k,left:k});if(f.shadow)for(k=1;k<=f.lines;k++)m(k,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(k=1;k<=f.lines;k++)m(k);return b(a,p)};k.prototype.opacity=
function(a,b,c,f){a=a.firstChild;f=f.shadow&&f.lines||0;a&&b+f<a.childNodes.length&&(a=(a=(a=a.childNodes[b+f])&&a.firstChild)&&a.firstChild)&&(a.opacity=c)}}var q=["webkit","Moz","ms","O"],l={},f,t,p={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2E9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};k.defaults={};h(k.prototype,{spin:function(b){this.stop();var c=this,d=c.opts,m=
c.el=a(null,{className:d.className});e(m,{position:d.position,width:0,zIndex:d.zIndex,left:d.left,top:d.top});b&&b.insertBefore(m,b.firstChild||null);m.setAttribute("role","progressbar");c.lines(m,c.opts);if(!f){var g=0,k=(d.lines-1)*(1-d.direction)/2,t,p=d.fps,n=p/d.speed,l=(1-d.opacity)/(n*d.trail/100),h=n/d.lines;(function I(){g++;for(var a=0;a<d.lines;a++)t=Math.max(1-(g+(d.lines-a)*h)%n*l,d.opacity),c.opacity(m,a*d.direction+k,t,d);c.timeout=c.el&&setTimeout(I,~~(1E3/p))})()}return c},stop:function(){var a=
this.el;a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0);return this},lines:function(d,r){function m(b,c){return e(a(),{position:"absolute",width:r.scale*(r.length+r.width)+"px",height:r.scale*r.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/r.lines*k+r.rotate)+"deg) translate("+r.scale*r.radius+"px,0)",borderRadius:(r.corners*r.scale*r.width>>1)+"px"})}for(var k=0,t=(r.lines-1)*(1-r.direction)/2,p;k<r.lines;k++)p=e(a(),
{position:"absolute",top:1+~(r.scale*r.width/2)+"px",transform:r.hwaccel?"translate3d(0,0,0)":"",opacity:r.opacity,animation:f&&c(r.opacity,r.trail,t+k*r.direction,r.lines)+" "+1/r.speed+"s linear infinite"}),r.shadow&&b(p,e(m("#000","0 0 4px #000"),{top:"2px"})),b(d,b(p,m(g(r.color,k),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});if("undefined"!==typeof document){t=function(){var c=a("style",{type:"text/css"});b(document.getElementsByTagName("head")[0],
c);return c.sheet||c.styleSheet}();var w=e(a("group"),{behavior:"url(#default#VML)"});!d(w,"transform")&&w.adj?n():f=d(w,"animation")}return k});var CTATConfig={Options:{},addProperty:function(a,b,c,d){c=c||b[0];Object.defineProperty(CTATConfig,a,{enumerable:!0,configurable:!1,writable:!d,value:c.toLowerCase()});var e={};b.forEach(function(b){e[b]=b.toLowerCase();Object.defineProperty(CTATConfig,a+"_is_"+b,{enumerable:!1,writable:!1,value:function(){return CTATConfig[this.prop].toLowerCase()==this.val}.bind({prop:a,val:e[b]})})});CTATConfig.Options[a]=e}};CTATConfig.addProperty("platform",["CTAT","Google","Undefined"],"CTAT",!0);
CTATConfig.addProperty("external",["Google","LTI","SCORM","noUI","None"],"None");CTATConfig.setExternal=function(a){CTATConfig.external=a};CTATConfig.addProperty("parserType",["XML","JSON"],"XML");"undefined"!==typeof module&&(module.exports=CTATConfig);var CTATGlobals={tutorRunning:!1,Tab:{Tracker:1,Focus:null,previousFocus:null},NameSpace:{svg:"http://www.w3.org/2000/svg",xml:"http://www.w3.org/2000/xmlns/",xlink:"http://www.w3.org/1999/xlink",ev:"http://www.w3.org/2001/xml-events",mathml:"http://www.w3.org/1998/Math/MathML"},EncodedParams:{authenticity_token:"authenticity_token",info:"info",question_file:"question_file",skills:"skills"},CommDisabled:!1,orientation:"portrait",ignoreInterfaceDescriptions:!0},useDebugging;
void 0===useDebugging&&(useDebugging=!1);var useDebuggingBasic;void 0===useDebuggingBasic&&(useDebuggingBasic=!1);var version="4.4.0",ctatcontainer="container",movieclips=[],canvasCalibrate=5,flashVars=null,mobileAPI=null,aVars=null;CTATGlobals.interfaceElement=null;var commMessageHandler=CTATGlobals.selectedTextInput=null,commLoggingLibrary=null,logHintSAI=null,logHintStepID="",nameTranslator=null,hints=[],hintIndex=0;CTATGlobals.suppressStudentFeedback=!1;CTATGlobals.confirmDone=!1;
var incompatibleBrowserMessage="Your browser does not support CTAT. Please update or replace your browser.";var CTATSandboxDriver={};function getSafeElementById(a){return document.getElementById(a)};var CTATGlobalFunctions={};function unhighlightall(a){if(CTATShellTools.component_descriptions){a=CTATShellTools.getAllComponents();for(var b=0;b<a.length;b++){var c=a[b];c.setHintHighlight&&c.setHintHighlight(!1,null)}}}CTATGlobalFunctions.stringToBoolean=function(a){switch(String(a).toLowerCase()){case "true":case "yes":case "1":return!0;case "false":case "no":case "0":case "":case null:return!1;default:return!!a}};
CTATGlobalFunctions.isInstructorMode=function(){var a=flashVars?flashVars.getRawFlashVars():null;return a&&a.deliverymode?"delivery"==a.deliverymode?!1:!0:!1};CTATGlobalFunctions.getLoggingLibrary=function(a){null==commLoggingLibrary&&(commLoggingLibrary=new CTATLoggingLibrary(!0));return commLoggingLibrary};CTATGlobalFunctions.setPreviewMode=function(a,b){CTATGlobalFunctions.isCTATObject(a)?a.setPreviewMode(b):a.previewMode=b};
CTATGlobalFunctions.setCenterTutor=function(a,b){CTATGlobalFunctions.isCTATObject(a)?a.setCenterTutor(b):a.centerTutor=b};CTATGlobalFunctions.setTutorWidth=function(a,b){CTATGlobalFunctions.isCTATObject(a)?a.setTutorWidth(b):a.width=b};CTATGlobalFunctions.setTutorHeight=function(a,b){CTATGlobalFunctions.isCTATObject(a)?a.setTutorHeight(b):a.height=b};CTATGlobalFunctions.setTutorDimensions=function(a,b,c){CTATGlobalFunctions.isCTATObject(a)?a.setTutorDimensions(b,c):(a.width=b,a.height=c)};
CTATGlobalFunctions.setTutorValue=function(a,b,c){CTATGlobalFunctions.isCTATObject(a)?a.setTutorValue(b,c):a[b]=c};CTATGlobalFunctions.setCommunicationMode=function(a,b){CTATGlobalFunctions.isCTATObject(a)?a.setCommunicationMode(b):a.tutoring_service_communication=b};CTATGlobalFunctions.setRemoteSocketURL=function(a,b){CTATGlobalFunctions.isCTATObject(a)?a.setRemoteSocketURL(b):a.remoteSocketURL=b};
CTATGlobalFunctions.setRemoteSocketPort=function(a,b){CTATGlobalFunctions.isCTATObject(a)?a.setRemoteSocketPort(b):a.remoteSocketPort=b};CTATGlobalFunctions.setProblemSummary=function(a){};CTATGlobalFunctions.isCTATObject=function(a){return"object"==typeof testConfig&&testConfig.getClassName?!0:!1};CTATGlobalFunctions.getCTATClassname=function(a){return"object"==typeof testConfig&&testConfig.getClassName?testConfig.getClassName():"object"};
CTATGlobalFunctions.toBoolean=function(a){return"boolean"===typeof a?a:"string"===typeof a?CTATGlobalFunctions.stringToBoolean(a):"number"===typeof a?0<a:a?!0:!1};function noenter(a){if(CTATConfig.platform_is_Google())return 0;a=a||window.event;return 13!==(a.keyCode||a.charCode)}CTATGlobalFunctions.isBlank=function(a){return!a||/^\s*$/.test(a)};function componentToHex(a){a=a.toString(16);return 1==a.length?"0"+a:a}
function rgbToHex(a,b,c){return"#"+componentToHex(a)+componentToHex(b)+componentToHex(c)}function hexToRgb(a){return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}
function parseQueryStringArgs(a){ctatdebug("parseQueryStringArgs ()");ctatdebug("Query String: "+a);var b="?"==a.charAt(0)?a.substring(1):a;a={};if(b)for(var b=b.split("&"),c=0;c<b.length;c++){var d=b[c].split("=");a[decodeURIComponent(d[0])]=decodeURIComponent(d[1].replace(/\+/g," "))}return a}
function setOrientation(a){ctatdebug("setOrientation ("+a+")");switch(a){case -90:case 90:mobileAPI&&mobileAPI.processOrientationChange("landscape");break;default:mobileAPI&&mobileAPI.processOrientationChange("portrait")}}Object.hasOwnProperty("create")||(Object.create=function(){function a(){}return function(b){if(1!=arguments.length)throw Error("Object.create implementation only accepts one parameter.");a.prototype=b;return new a}}());
function thisMovie(a){return-1!=navigator.appName.indexOf("Microsoft")?window[a]:document[a]}function introspect(a,b,c,d){c=c||"";"number"!==this.typeOf(d)&&(d=1);var e=this.typeOf(b);a=[c,a," ",e," :"].join("");if("object"===e){if(0<d){c=[c,"  "].join("");for(var h in b)e=this.introspect(h,b[h],c,d-1),a=[a,"\n",e].join("");return a}return[a," ..."].join("")}return"null"===e?[a," null"].join(""):[a," ",b].join("")}
function findPointOfAttachment(a){ctatdebug("findPointOfAttachment ("+a+")");for(var b=0;b<movieclips.length;b++){var c=movieclips[b];ctatdebug("Examining: "+c.getName()+"...");if(!0===c.isRegistered(a))return c}return null}function findMovieClip(a){a=a.trim();ctatdebug("findMovieClip ("+a.trim()+")");for(var b=0;b<movieclips.length;b++){var c=movieclips[b];ctatdebug("Examining: "+c.getName()+"...");if(c.getName()==a)return c}return null}
function colName(a,b){ctatdebug("colName ("+a+")");for(var c="";0<=a;)c=String.fromCharCode(a%26+97)+c,a=Math.floor(a/26)-1;!0===b&&c.toUpperCase();return c}function selectText(a){}function urldecode(a){return decodeURIComponent((""+a).replace(/\+/g,"%20"))}function detectIE(){var a=window.navigator.userAgent,b=a.indexOf("MSIE "),c=a.indexOf("Trident/");return 0<b?parseInt(a.substring(b+5,a.indexOf(".",b)),10):0<c?(b=a.indexOf("rv:"),parseInt(a.substring(b+3,a.indexOf(".",b)),10)):!1}
function listProperties(a){ctatdebug("listProperties (l: "+a.length+")");for(var b in a)ctatdebug("["+b+"]")}function listPropertiesKV(a,b){ctatdebug("listPropertiesKV (size: "+a.length+")");if(1==b)for(b=0;b<a.length;b++)ctatdebug("["+b+"]: "+a[b]);else for(var c in a)ctatdebug("["+c+"]: "+a[c])}function listAllDivAttributes(a){ctatdebug("listAllDivAttributes ()");var b=0;a=a.attributes;for(var c=a.length;b<c;b++)pointer.ctatdebug("Attribute: "+a[b].nodeName+", with value: "+a[b].nodeValue)}
var getBackgroundDimensions=function(a){ctatdebug("Using url: "+$(a).css("background-image"));var b=new Image;b.src=$(a).css("background-image").replace(/url\(|\)$|"/ig,"");return b.width+" "+b.height},getBackgroundWidth=function(a){ctatdebug("Using url: "+$(a).css("background-image"));var b=new Image;b.src=$(a).css("background-image").replace(/url\(|\)$|"/ig,"");return b.width},getBackgroundHeight=function(a){ctatdebug("Using url: "+$(a).css("background-image"));var b=new Image;b.src=$(a).css("background-image").replace(/url\(|\)$|"/ig,
"");return b.height};function getIndicesOf(a,b,c){var d=0,e=a.length,h=[];c||(b=b.toLowerCase(),a=a.toLowerCase());for(;-1<(c=b.indexOf(a,d));)h.push(c),d=c+e;return h}CTATGlobalFunctions.formatColor=function(a){if(/^#[0-9a-f]{6}$/i.test(a))return a;var b=a.match(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i);if(null!==b)return rgbToHex(Number(b[1]),Number(b[2]),Number(b[3]));b=a.match(/^#?([0-9a-f]{0,6})$/i);if(null!==b){for(a=b[1];6>a.length;)a="0"+a;return"#"+a}return a};
CTATGlobalFunctions.Gensym=function(){this.make_gensym=function(){var a="",b=0;return{set_prefix:function(b){a=String(b)},set_index:function(a){b=a},gensym:function(){var c=a+b;b+=1;return c}}};var a=this.make_gensym();a.set_index(2);var b=this.make_gensym();b.set_index(1);b.set_prefix("ctatdiv");return{z_index:a.gensym,div_id:b.gensym}};CTATGlobalFunctions.gensym=CTATGlobalFunctions.Gensym();var CTATBase=function(a,b){function c(a,b,c){null===a&&(a="unknownclass");null===b&&(b="nullinstance");return"["+a+":"+b+"] "+c}var d=a,e=b,h=this,g=!0;"undefined"!=CTATBase.DebuggingFilter[d]&&CTATBase.DebuggingFilter[d]&&(g=!1);this.getClassName=function(){return d};this.getClassname=function(){return d};this.setClassName=function(a){d=a};this.setName=function(a){e=a};this.getName=function(){return e};this.getUseDebugging=function(){return useDebugging};this.setUseDebugging=function(a){useDebugging=
a};this.toHHMMSS=function(a){var b=parseInt(a,10);a=Math.floor(b/3600);var c=Math.floor((b-3600*a)/60),b=b-3600*a-60*c;10>a&&(a="0"+a);10>c&&(c="0"+c);10>b&&(b="0"+b);return a+":"+c+":"+b};this.ctatdebug=function(a){if(g){var b=a;useDebuggingBasic?h.ctatdebugInternal(b,"UnknownClass"):(null===a&&(b="No message provided"),useDebugging&&h.ctatdebugInternal(b,h.getClassName()))}};this.ctatdebugObject=function(a){var b=0,c;for(c in a)this.ctatdebug("("+b+")"+c+": "+a[c]),b++};this.ctatdebugInternal=function(a,
b){if(null===a||void 0===a)a="No message!";""===a&&(a="Empty message!");if(useDebuggingBasic)b=c("Unknown","undefined",a),CTATBase.customconsole||(CTATBase.customconsole=getSafeElementById("customconsole")),CTATBase.customconsole?(CTATBase.customconsole.innerHTML+=b+"<br>",CTATBase.customconsole.scrollTop=CTATBase.customconsole.scrollHeight):console.log(b);else{null===b&&(b="UndefinedClass");null===a&&(a="No message");b=c(b,h.getName(),a);try{console.trace(b)}catch(q){}"google"==CTATConfig.platform?
Logger.log(b):(CTATBase.customconsole||(CTATBase.customconsole=getSafeElementById("customconsole")),null!==CTATBase.customconsole&&(CTATBase.customconsole.innerHTML+=b+"<br>",CTATBase.customconsole.scrollTop=CTATBase.customconsole.scrollHeight))}};this.ctatdebugObjectShallow=function(a){var b="",c;for(c in a)b+=c+", ";h.ctatdebugInternal("Object: "+b,"Global")};this.urldecode=function(a){return decodeURIComponent((a+"").replace(/\+/g,"%20"))};this.entitiesConvert=function(a){this.ctatdebug("entitiesConvert ()");
return this.urldecode(unescape(a))};this.entitiesGenerate=function(a){return a}};function formatLogMessageGoogle(a,b,c){c=(new CTATBase(a,b)).htmlEncode(c);return"["+a+":"+b+"] "+c}function ctatdebug(a){(useDebugging||useDebuggingBasic)&&null!==a&&("google"==CTATConfig.platform?Logger.log(formatLogMessageGoogle("CTATTutor","tutor",a)):(ctatdebug.debugPointer||(ctatdebug.debugPointer=new CTATBase("CTATTutor","tutor")),ctatdebug.debugPointer.ctatdebug(a,"CTATTutor")))}
Object.defineProperty(CTATBase,"DebuggingFilter",{enumerable:!1,configurable:!1,writable:!0,value:[]});"undefined"!==typeof module&&(module.exports=CTATBase);var CTATXML=function(){CTATBase.call(this,"CTATXML","xmlparser");this.parse=function(a){return this.parseXML(a)};this.parseXML=function(a){this.ctatdebug("parseXML ()");var b=null;try{"undefined"!==typeof $?b=$.parseXML(a):"undefined"!==typeof XMLParser?b=(new XMLParser).parseFromString(a):this.ctatdebug("Bottoming out, no parser configured!")}catch(c){return null!=b?this.ctatdebug("JQuery could not process the provided XML: "+c.message+" ("+b.parseError.errorCode+") ("+b.parseError.reason+") ("+
b.parseError.line+")"):this.ctatdebug("JQuery could not process the provided XML (xmlDoc==null): "+c.message),null}return null==b?(this.ctatdebug("Unspecified error parsing xml message. xmlDoc is null"),null):b.documentElement};this.getElementName=function(a){return a.nodeName};this.getElementValue=function(a){return a.nodeValue};this.getElementChildren=function(a){for(var b=[],c=0;c<a.childNodes.length;c++)1==a.childNodes[c].nodeType&&b.push(a.childNodes[c]);return b};this.getNodeTextValue=function(a){if(null==
a)return"";if(null==a.childNodes)return a.nodeValue;if(0==a.childNodes.length)return"";for(var b=a.childNodes,c=0;c<b.length;c++){var d=b[c];if("value"==d.nodeName||"Value"==d.nodeName){if(1==d.childNodes.length)return d.childNodes[0].nodeValue;if(0==d.childNodes.length)break;else return d.childNodes[1].nodeValue}}return a.childNodes[0].nodeValue};this.getValueNodesAsText=function(a){var b=this;return this.getElementChildren(a).reduce(function(a,d){"value"===b.getElementName(d)&&a.push(b.getNodeTextValue(d));
return a},[])};this.setNodeTextValue=function(a,b){if(null==a)return null;if(null==a.childNodes)return a.nodeValue;if(0==a.childNodes.length)return"";for(var c=a.childNodes,d=0;d<c.length;d++){var e=c[d];if("value"==e.nodeName||"Value"==e.nodeName){if(1==e.childNodes.length)return e.childNodes[0].nodeValue=b;if(0==e.childNodes.length)break;else return e.childNodes[1].nodeValue=b}}return a.childNodes[0].nodeValue=b};this.addElement=function(a,b,c,d){return a instanceof Element&&(b=String(b))?(c="<"+
b+">"+(d?"<![CDATA[":"")+String(c),c+=d?"]]\x3e":"",c+="</"+b+">",$(a).append(c).children().last().get()[0]):null};this.getElementAttr=function(a,b){if(!a.attributes)return this.ctatdebug("Warning: Element "+a.nodeName+" does not have any attributes"),"";for(var c=0;c<a.attributes.length;c++)if(a.attributes[c].nodeName==b)return a.attributes[c].nodeValue;return""};this.listElementAttr=function(a){this.ctatdebug("Listing "+a.attributes.length+" attributes for element "+a.nodeName+" ...");for(var b=
0;b<a.attributes.length;b++)this.ctatdebug(b+" name: "+a.attributes[b].nodeName+", value: "+a.attributes[b].nodeValue)};this.stringify=function(a){return this.xmlToString(a)};this.xmlToString=function(a){this.ctatdebug("xmlToString ()");return null==a?(this.ctatdebug("Error: xml data is null"),null):(new XMLSerializer).serializeToString(a)}};CTATXML.prototype=Object.create(CTATBase.prototype);CTATXML.prototype.constructor=CTATXML;"undefined"!==typeof module&&(module.exports=CTATXML);var CTATDefaultLanguagePack={HORIZONTAL:"LR",VERTICAL:"TB",LOADING:"Please wait while the tutor is being loaded",NEXTPROBLEM:"Retrieving the Next Problem...",CONGRATULATIONS_YOU_ARE_DONE:"Congratulations, you are done with this problem.",DONE_WITH_PROBLEM_SET:"You are done with this problem set.",SURE_YOU_ARE_DONE:"Are you sure you are done?",TUTORDISCONNECTED:"The tutor has disconnected. Please refresh the page.",OUTOFORDER:"You need to do other steps first, before doing the step you just worked on. You might request a hint for more help.",
DONE:"Done",HINT:"Hint",NEXT:"Next",PREVIOUS:"Previous",HIGHLIGHTEDSTEP:"Instead of the step you are working on, please work on the highlighted step.",NO_HINT_AVAILABLE:"No hint is available at this step.",NOTDONE:"I'm sorry, but you are not done yet. Please continue working.",AUTHORPLEASECLOSE:"Authoring Tools disconnected. Please close this page.",ERROR_502:"Error contacting the server, please refresh the page and try again (HTTP status 502: gateway response).",ERROR_CONN_TS:"Connection refused by tutoring service, please check your server or contact an administrator.",
ERROR_CONN_LS:"Connection refused by the logging server, please check your connection or contact an administrator.",AWAITING_OTHER_COLLABORATORS:"Waiting for other team members...",YOUR_COLLABORATOR:"Your team member ",COLLABORATOR_QUIT_CLICK_OK:"has quit. Please click OK to exit, then restart the problem.",COLLABORATOR_QUIT_CLICK_X:"has quit. Please the red X at top right to exit, then restart the problem."},CTATLanguageManager=function(){CTATBase.call(this,"CTATLanguageManager","theLanguagePack");
var a=this;this.getString=function(b){a.ctatdebug("getString ("+b+") -> "+typeof CTATLanguagePack);if("undefined"!==typeof CTATLanguagePack){if(CTATLanguagePack[b])return CTATLanguagePack[b]}else a.ctatdebug("No custom language pack defined, using default...");return CTATDefaultLanguagePack[b]};this.filterString=function(b){a.ctatdebug("filterString ("+b+") -> "+typeof CTATLanguagePack);if("undefined"!==typeof CTATLanguagePack){if(CTATLanguagePack[b])return a.ctatdebug("Found tag in provided language pack, returning: "+
CTATLanguagePack[b]),CTATLanguagePack[b]}else a.ctatdebug("No custom language pack defined, using default...");return"undefined"!==typeof CTATDefaultLanguagePack&&CTATDefaultLanguagePack[b]?(a.ctatdebug("Found tag in default language pack, returning: "+CTATDefaultLanguagePack[b]),CTATDefaultLanguagePack[b]):b}};CTATLanguageManager.prototype=Object.create(CTATBase.prototype);CTATLanguageManager.prototype.constructor=CTATLanguageManager;CTATLanguageManager.theSingleton=new CTATLanguageManager;var CTATMsgType=function(){CTATBase.call(this,"CTATMsgType","")};CTATMsgType.findProperty=function(a,b){var c=a.toLowerCase(),d="<"+b.toLowerCase()+">";a=c.indexOf(d)+d.length;b=c.indexOf("</"+b.toLowerCase()+">");if(a<d.length||0>b)return null;d={};d.start=a;d.end=b;return d};
CTATMsgType.makeValues=function(a){if(null==a)return"";if("string"==typeof a)return a;if(a.constructor&&"Array"==a.constructor.name){if(!a.length)return"";for(var b=0,c,d="<value>"+(null==(c=a[b++])?"":c.toString());b<a.length;)d+="</value><value>"+(null==(c=a[b++])?"":c.toString());return d+"</value>"}return a.outerHTML?a.outerHTML:a.toString()};
CTATMsgType.setProperty=function(a,b,c){var d=CTATMsgType.findProperty(a,b),e;d?(e=a.slice(0,d.start),e+=CTATMsgType.makeValues(c),e+=a.slice(d.end,a.length)):(d=a.indexOf("</properties>"),e=a.slice(0,d),e+="<"+b+">"+CTATMsgType.makeValues(c)+"</"+b+">",e+=a.slice(d,a.length));return e};CTATMsgType.getProperty=function(a,b){return(b=CTATMsgType.findProperty(a,b))?a.slice(b.start,b.end):""};
CTATMsgType.valueToArray=function(a){if(!a.startsWith("<value>")||!a.endsWith("</value>"))return null;var b=new CTATXML;try{for(var c=b.getElementChildren(b.parse('<?xml version="1.0" encoding="UTF-16"?><root>'+a+"</root>")),d=[],e=0;e<c.length;++e)"value"==b.getElementName(c[e]).toLowerCase()&&d.push(b.getNodeTextValue(c[e]));return d}catch(h){return console.log("Error in CTATMsgType.valueToArray("+a+")",h),null}};
CTATMsgType.getValue=function(a,b){a=CTATMsgType.valueToArray(a);return!a||a.length<=b?null:a[b]};CTATMsgType.getMessageType=function(a){return CTATMsgType.getProperty(a,"MessageType")};CTATMsgType.getTransactionID=function(a){return CTATMsgType.getProperty(a,CTATMessage.TRANSACTION_ID_TAG)};CTATMsgType.setTransactionID=function(a,b){return CTATMsgType.setProperty(a,CTATMessage.TRANSACTION_ID_TAG,b)};
CTATMsgType.isCorrectOrIncorrect=function(a){return"string"==typeof a?CTATMsgType.CorrectTypes[a.toLowerCase()]?!0:!1:!1};CTATMsgType.hasTextFeedback=function(a){return"string"==typeof a?CTATMsgType.TextFeedbackTypes[a.toLowerCase()]?!0:!1:!1};CTATMsgType.isHintResponse=function(a){return"string"==typeof a?CTATMsgType.HintResponseTypes[a.toLowerCase()]?!0:!1:!1};
CTATMsgType.isDoneMessage=function(a){var b=CTATMsgType.getProperty(a,"Selection");a=CTATMsgType.getProperty(a,"Action");if(!b||!a)return!1;b=b.toString().toLowerCase();a=a.toString().toLowerCase();var c=CTATMsgType.DONE.toLowerCase();if(c!=b&&c!=CTATMsgType.getValue(b,0))return!1;b=CTATMsgType.BUTTON_PRESSED.toLowerCase();return b!=a&&b!=CTATMsgType.getValue(a,0)?!1:!0};
CTATMsgType.getSAIArraysFromElement=function(a,b){var c={selection:[],action:[],input:[]};a=b.getElementChildren(a);for(var d=0;d<a.length;d++){var e=a[d];switch(b.getElementName(e)){case "Selection":for(var e=b.getElementChildren(e),h=0;h<e.length;h++)c.selection.push(b.getNodeTextValue(e[h]));break;case "Action":e=b.getElementChildren(e);for(h=0;h<e.length;h++)c.action.push(b.getNodeTextValue(e[h]));break;case "Input":e=b.getElementChildren(e);for(h=0;h<e.length;h++)c.input.push(b.getNodeTextValue(e[h]));
break;case "properties":return CTATMsgType.getSAIArraysFromElement(e,b)}}return c};Object.defineProperty(CTATMsgType,"CorrectTypes",{enumerable:!1,configurable:!1,writable:!1,value:{correctaction:1,incorrectaction:1,lispcheckaction:1}});Object.defineProperty(CTATMsgType,"TextFeedbackTypes",{enumerable:!1,configurable:!1,writable:!1,value:{showhintsmessage:1,successmessage:1,buggymessage:1,wrongusermessage:1,nohintmessage:1,highlightmsg:1,showhintsmessagefromlisp:1}});
Object.defineProperty(CTATMsgType,"HintResponseTypes",{enumerable:!1,configurable:!1,writable:!1,value:{showhintsmessage:1,nohintmessage:1,showhintsmessagefromlisp:1}});Object.defineProperty(CTATMsgType,"BUGGY_MSG",{enumerable:!1,configurable:!1,writable:!1,value:"BuggyMsg"});Object.defineProperty(CTATMsgType,"DONE",{enumerable:!1,configurable:!1,writable:!1,value:"Done"});Object.defineProperty(CTATMsgType,"BUTTON_PRESSED",{enumerable:!1,configurable:!1,writable:!1,value:"ButtonPressed"});
Object.defineProperty(CTATMsgType,"DEFAULT_STUDENT_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Student"});Object.defineProperty(CTATMsgType,"DEFAULT_TOOL_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Tutor"});Object.defineProperty(CTATMsgType,"UNGRADED_TOOL_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Tutor (unevaluated)"});Object.defineProperty(CTATMsgType,"DEFAULT_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:CTATMsgType.DEFAULT_STUDENT_ACTOR});
Object.defineProperty(CTATMsgType,"ANY_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Any"});Object.defineProperty(CTATMsgType,"SHOW_ALL_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:"Show All Feedback"});Object.defineProperty(CTATMsgType,"DELAY_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:"Delay Feedback"});Object.defineProperty(CTATMsgType,"HIDE_ALL_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:"Hide All Feedback"});
Object.defineProperty(CTATMsgType,"HIDE_BUT_COMPLETE",{enumerable:!1,configurable:!1,writable:!1,value:"Hide feedback but require all steps"});Object.defineProperty(CTATMsgType,"HIDE_BUT_ENFORCE",{enumerable:!1,configurable:!1,writable:!1,value:"Hide feedback but enforce constraints"});Object.defineProperty(CTATMsgType,"DEFAULT_OUT_OF_ORDER_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:CTATLanguageManager.theSingleton.filterString("HIGHLIGHTEDSTEP")});
Object.defineProperty(CTATMsgType,"NOT_DONE_MSG",{enumerable:!1,configurable:!1,writable:!1,value:CTATLanguageManager.theSingleton.filterString("NOTDONE")});Object.defineProperty(CTATMsgType,"TRACE_OUTCOME",{enumerable:!1,configurable:!1,writable:!1,value:"TraceOutcome"});Object.defineProperty(CTATMsgType,"PREVIOUS_FOCUS",{enumerable:!1,configurable:!1,writable:!1,value:"PreviousFocus"});Object.defineProperty(CTATMsgType,"ASSOCIATED_RULES",{enumerable:!1,configurable:!1,writable:!1,value:"AssociatedRules"});
Object.defineProperty(CTATMsgType,"BEGIN_RESTORE",{enumerable:!1,configurable:!1,writable:!1,value:"BeginRestore"});Object.defineProperty(CTATMsgType,"BEGIN_GO_TO_STATE",{enumerable:!1,configurable:!1,writable:!1,value:"BeginGoToState"});Object.defineProperty(CTATMsgType,"END_GO_TO_STATE",{enumerable:!1,configurable:!1,writable:!1,value:"EndGoToState"});Object.defineProperty(CTATMsgType,"BUGGY_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:"BuggyMessage"});
Object.defineProperty(CTATMsgType,"CORRECT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"CorrectAction"});Object.defineProperty(CTATMsgType,"HINT_REQUEST",{enumerable:!1,configurable:!1,writable:!1,value:"HintRequest"});Object.defineProperty(CTATMsgType,"INCORRECT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"InCorrectAction"});Object.defineProperty(CTATMsgType,"INTERFACE_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"InterfaceAction"});
Object.defineProperty(CTATMsgType,"INTERFACE_IDENTIFICATION",{enumerable:!1,configurable:!1,writable:!1,value:"InterfaceIdentification"});Object.defineProperty(CTATMsgType,"PROBLEM_RESTORE_END",{enumerable:!1,configurable:!1,writable:!1,value:"ProblemRestoreEnd"});Object.defineProperty(CTATMsgType,"PROBLEM_SUMMARY_REQUEST",{enumerable:!1,configurable:!1,writable:!1,value:"ProblemSummaryRequest"});
Object.defineProperty(CTATMsgType,"PROBLEM_SUMMARY_RESPONSE",{enumerable:!1,configurable:!1,writable:!1,value:"ProblemSummaryResponse"});Object.defineProperty(CTATMsgType,"SET_PREFERENCES",{enumerable:!1,configurable:!1,writable:!1,value:"SetPreferences"});Object.defineProperty(CTATMsgType,"SHOW_HINTS_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:"ShowHintsMessage"});Object.defineProperty(CTATMsgType,"SUCCESS_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:"SuccessMessage"});
Object.defineProperty(CTATMsgType,"START_STATE_END",{enumerable:!1,configurable:!1,writable:!1,value:"StartStateEnd"});Object.defineProperty(CTATMsgType,"STATE_GRAPH",{enumerable:!1,configurable:!1,writable:!1,value:"StateGraph"});Object.defineProperty(CTATMsgType,"UNTUTORED_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"UntutoredAction"});Object.defineProperty(CTATMsgType,"GO_TO_STATE",{enumerable:!1,configurable:!1,writable:!1,value:"GoToState"});
Object.defineProperty(CTATMsgType,"INTERFACE_REBOOT",{enumerable:!1,configurable:!1,writable:!1,value:"InterfaceReboot"});Object.defineProperty(CTATMsgType,"CompletionValue",{enumerable:!1,configurable:!1,writable:!1,value:["incomplete","complete"]});CTATMsgType.prototype=Object.create(CTATBase.prototype);CTATMsgType.prototype.constructor=CTATMsgType;"undefined"!==typeof module&&(module.exports=CTATMsgType);var CTATVersionComparator=function(){CTATBase.call(this,"CTATVersionComparator","");this.compare=function(a,b){if(null===a||"undefined"===typeof a)return null===b||"undefined"===typeof b?0:-1;if(null===b||"undefined"===typeof b)return 1;var c=0,d=a.split("."),e=b.split("."),h;for(h=0;h<Math.min(d.length,e.length);h++)try{var g=parseInt(d[h]),k=parseInt(e[h]),c=g<k?-1:g>k?1:0;if(0!==c)return c}catch(n){if(c=d[h].toString()<e[h].toString()?-1:d[h].toString()>e[h].toString()?1:0,0!==c)return c}return h<
d.length?1:h<e.length?-1:a.toString()<b.toString()?-1:a.toString()>b.toString()?1:0}};CTATVersionComparator.prototype=Object.create(CTATBase.prototype);CTATVersionComparator.prototype.constructor=CTATVersionComparator;CTATVersionComparator.vc=new CTATVersionComparator;"undefined"!==typeof module&&(module.exports=CTATVersionComparator);var CTATExampleTracerSkill=function(a,b,c,d,e,h,g){CTATBase.call(this,"CTATExampleTracerSkill",b);var k=this,n=0,q=CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_11;this.skillName=null==a||""==a.trim()?b:b+" "+a;this.pGuess=Number(c);Number.isNaN(k.pGuess)&&(k.pGuess=CTATExampleTracerSkill.DEFAULT_P_GUESS);this.pKnown=Number(d);Number.isNaN(k.pKnown)&&(k.pKnown=CTATExampleTracerSkill.DEFAULT_P_KNOWN);this.pLearn=Number(h);Number.isNaN(k.pLearn)&&(k.pLearn=CTATExampleTracerSkill.DEFAULT_P_LEARN);this.pSlip=
Number(e);Number.isNaN(k.pSlip)&&(k.pSlip=CTATExampleTracerSkill.DEFAULT_P_SLIP);this.history=/^0*[xX]([0-9a-fA-F]+)$/.test(g)?parseInt(g,16):/^(\-|\+)?[0-9]+$/.test(g)?parseInt(g,10):CTATExampleTracerSkill.DEFAULT_HISTORY;this.opportunityCount=0;this.masteryThreshold=CTATExampleTracerSkill.DEFAULT_MASTERY_THRESHOLD;this.description=this.label=null;var l=function(a,b,c,f,d,g,e){this.skillName=a;this.pGuess=b;this.pKnown=c;this.pLearn=f;this.pSlip=d;this.history=g;this.opportunityCount=e;this.getSkillName=
function(){return this.skillName}};l.prototype.constructor=l;var f=[];this.getSkillName=function(){return k.skillName};this.getCategory=function(a){null==a&&(a=k.skillName);var b=a.indexOf(" ");return 0>b?"":a.substring(b+1)};this.setTransactionNumber=function(a){n=a};this.getUpdates=function(){return f};this.updatesToJSONforTutorshop=function(){return f.map(function(a){return k.toJSONforTutorshop(a)})};this.addUpdate=function(a){f.push(new l(a.skillName,a.pGuess,a.pKnown,a.pLearn,a.pSlip,a.history,
a.opportunityCount))};this.recordUpdate=function(a){k.updatePKnown(a);k.updateHistory(a);k.changeOpportunityCount(1);f.push(new l(k.skillName,k.pGuess,k.pKnown,k.pLearn,k.pSlip,k.history,k.opportunityCount))};this.updatePKnown=function(a){k.pKnown=CTATExampleTracerSkill.updatePKnownStatic(a,k.pGuess,k.pKnown,k.pSlip,k.pLearn);return k.pKnown};this.updateHistory=function(a){k.history=CTATExampleTracerSkill.updateHistoryStatic(a,k.history);return k.history};this.changeOpportunityCount=function(a){k.opportunityCount+=
a;return k.opportunityCount};this.getTransactionNumber=function(){return n};this.getSkillBarString=function(a){var b=this.getSkillName(),b=b+this.getSkillBarDelimiter()+k.pKnown,b=b+this.getSkillBarDelimiter()+(this.hasReachedMastery()?"1":"0");!0===a&&(b=b+this.getSkillBarDelimiter()+this.getLabel());return b.toString()};this.getSkillBarDelimiter=function(){return q};this.toXML=function(a){var b;b=""+(' name="'+CTATExampleTracerSkill.getName(k.skillName)+'"');b+=' category="'+k.getCategory()+'"';
b+=' label="'+k.getLabel()+'"';b+=' description="'+k.getDescription()+'"';b+=' pKnown="'+Number(k.pKnown).toString()+'"';b+=' pLearn="'+Number(k.pLearn).toString()+'"';b+=' pGuess="'+Number(k.pGuess).toString()+'"';b+=' pSlip="'+Number(k.pSlip).toString()+'"';b+=' history="'+k.history+'"';b+=' opportunityCount="'+k.opportunityCount+'"';return a?"&lt;Skill"+b+" /&gt;":"<Skill"+b+" />"};this.toJSONforTutorshop=function(a){var b={};a||(a=k);b.name=CTATExampleTracerSkill.getName(a.getSkillName());b.category=
CTATExampleTracerSkill.getCategory(a.getSkillName());b.p_known=a.pKnown;b.p_learn=a.pLearn;b.p_guess=a.pGuess;b.p_slip=a.pSlip;b.history=a.history;b.opportunity_count=a.opportunityCount;return b};this.getPKnown=function(){return k.pKnown};this.getPLearn=function(){return k.pLearn};this.getPGuess=function(){return k.pGuess};this.getPSlip=function(){return k.pSlip};this.getHistory=function(){return k.history};this.getOpportunityCount=function(){return k.opportunityCount};this.setOpportunityCount=function(a){k.opportunityCount=
Number(a)||0};this.hasReachedMastery=function(){return null===k.pKnown||"undefined"===typeof k.pKnown?!1:k.pKnown>=k.masteryThreshold};this.getLabel=function(){return!k.label||1>k.label.length?CTATExampleTracerSkill.getName(k.skillName):k.label};this.getDescription=function(){return!k.description||1>k.description.length?k.skillName:k.description};this.setVersion=function(a){null!==a&&"undefined"!==typeof a&&0<a.length&&(q=CTATExampleTracerSkill.versionToSkillBarDelimiter(a))};this.setLabel=function(a){k.label=
a};this.setDescription=function(a){k.description=a};CTATExampleTracerSkill.makeStepID=function(a,b){for(var c="",f=0,d=a;2>f++;d=b)if(!(null===d||"undefined"===typeof d||1>d.length)){for(var g=!1,e=0;e<d.length;e++)if(null!==d[e]&&"undefined"!==typeof d[e]){var k=d[e].toString();1>k.length||d===a&&("hint".toString().toUpperCase()===k.toString().toUpperCase()||"help".toString().toUpperCase()===k.toString().toUpperCase())||d===b&&CTATMsgType.PREVIOUS_FOCUS.toString().toUpperCase()===k.toString().toUpperCase()||
(c=c+(g?",":"[")+k,g=!0)}!0===g&&(c+="]")}return c.toString()};CTATExampleTracerSkill.updateHistoryStatic=function(a,b){var c=1<<CTATExampleTracerSkill.MAX_INTEGER_SHIFT;a=b<<1|(a.toString().toUpperCase()===CTATExampleTracerSkill.CORRECT.toString().toUpperCase()?1:0);return a&c?a^c:a};CTATExampleTracerSkill.updatePKnownStatic=function(a,b,c,f,d){var m=0;if(a.toString().toUpperCase()===CTATExampleTracerSkill.CORRECT.toString().toUpperCase())a=+(c*(1-f)),m=+(a/(a+ +(b*(1-c))));else if(a.toString().toUpperCase()===
CTATExampleTracerSkill.INCORRECT.toString().toUpperCase()||a.toString().toUpperCase()===CTATExampleTracerSkill.HINT.toString().toUpperCase())a=+(c*f),m=+(a/(a+ +((1-c)*(1-b))));return+(m+d*(1-m))};CTATExampleTracerSkill.getName=function(a){var b=a.indexOf(" ");return 0>b?a:a.substring(0,b)};CTATExampleTracerSkill.getCategory=function(a){a=null==a?"":String(a);var b=a.indexOf(" ");return 0>b?"":a.substring(b+1)};CTATExampleTracerSkill.versionToSkillBarDelimiter=function(a){return null===a||"undefined"===
typeof a?CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_10:0<=CTATVersionComparator.vc.compare(a,"2.11")?CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_11:CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_10}};CTATExampleTracerSkill.fromJSON=function(a){if(!a)return null;var b=new CTATExampleTracerSkill("",""),c;for(c in a)a.hasOwnProperty(c)&&"function"!=typeof a[c]&&(b[c]=a[c]);return b};Object.defineProperty(CTATExampleTracerSkill,"MAX_INTEGER_SHIFT",{enumerable:!1,configurable:!1,writable:!1,value:31});
Object.defineProperty(CTATExampleTracerSkill,"HINT",{enumerable:!1,configurable:!1,writable:!1,value:"hint"});Object.defineProperty(CTATExampleTracerSkill,"CORRECT",{enumerable:!1,configurable:!1,writable:!1,value:"correct"});Object.defineProperty(CTATExampleTracerSkill,"INCORRECT",{enumerable:!1,configurable:!1,writable:!1,value:"incorrect"});Object.defineProperty(CTATExampleTracerSkill,"SKILL_BAR_DELIMITER_v2_10",{enumerable:!1,configurable:!1,writable:!1,value:"="});
Object.defineProperty(CTATExampleTracerSkill,"SKILL_BAR_DELIMITER_v2_11",{enumerable:!1,configurable:!1,writable:!1,value:"`"});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_MASTERY_THRESHOLD",{enumerable:!1,configurable:!1,writable:!1,value:.95});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_GUESS",{enumerable:!1,configurable:!1,writable:!1,value:.2});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_KNOWN",{enumerable:!1,configurable:!1,writable:!1,value:.3});
Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_SLIP",{enumerable:!1,configurable:!1,writable:!1,value:.3});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_LEARN",{enumerable:!1,configurable:!1,writable:!1,value:.15});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_HISTORY",{enumerable:!1,configurable:!1,writable:!1,value:0});CTATExampleTracerSkill.prototype=Object.create(CTATBase.prototype);CTATExampleTracerSkill.prototype.constructor=CTATExampleTracerSkill;
"undefined"!==typeof module&&(module.exports=CTATExampleTracerSkill);var CTATProblem=function(){CTATBase.call(this,"CTATProblem","problem");var a="",b="",c="tutor",d="",e="",h=[],g=[],k="notstarted";this.setState=function(a){k=a};this.getState=function(){return k};this.setLabel=function(b){a=b};this.getLabel=function(){return a};this.setDescription=function(a){b=a};this.getDescription=function(){return b};this.setTutorFlag=function(a){c=a};this.getTutorFlag=function(){return c};this.setProblemFile=function(a){d=a};this.getProblemFile=function(){return d};this.setStudentInterface=
function(a){e=a};this.getStudentInterface=function(){return e};this.addSkillOpps=function(a){h.push(a);g.push(new CTATExampleTracerSkill(a.category,a.name))};this.getSkillOpps=function(){return h};this.getSkills=function(){return g}};CTATProblem.prototype=Object.create(CTATBase.prototype);CTATProblem.prototype.constructor=CTATProblem;CTATProblem.prototype.toString=function(){return this.getProblemFile()+" on "+this.getStudentInterface()};var CTATProblemSet=function(){CTATBase.call(this,"CTATProblemSet","problemset");var a=this,b=[];this.addProblem=function(a){b.push(a)};this.getProblems=function(){return b};this.getProblemSize=function(){return b.length};this.getFirstProblem=function(){a.ctatdebug("getFirstProblem () problems.length "+b.length);return 0==b.length?null:b[0]}};CTATProblemSet.prototype=Object.create(CTATBase.prototype);CTATProblemSet.prototype.constructor=CTATProblemSet;var CTATPackage=function(){CTATBase.call(this,"CTATPackage","packagemanager");var a=this,b=new CTATXML,c="",d="",e="",h=new CTATProblemSet,g=[h],k={};this.init=function(d){a.ctatdebug("init ()");if(null==d)a.ctatdebug("Error: document root to be parsed is null.");else{var g=b.getElementName(d);a.ctatdebug("Root name: "+g);if(!/Package/i.test(g))return d=c.substring(c.lastIndexOf("/")+1),a.addProblem(c,e,d,d,d);d=b.getElementChildren(d);for(g=0;g<d.length;g++){var l=d[g],f=b.getElementName(l);a.ctatdebug("Examining element: "+
b.getElementName(l));switch(f){case "Problems":a.processProblemsElement(l);break;case "ProblemSets":a.processProblemSetsElement(l);break;case "Assets":k=a.processAssetsElement(l,k)}}}};this.processProblemsElement=function(c){c=b.getElementChildren(c);a.ctatdebug("CTATPackage.processProblemsElement ... nChildren="+c.length);for(var d=[],g=0;g<c.length;g++){var f=c[g],e=b.getElementAttr(f,"problem_file"),p=b.getElementAttr(f,"student_interface"),n=b.getElementAttr(f,"name"),m=b.getElementAttr(f,"label"),
r=b.getElementAttr(f,"description");k[e]=e;k[p]=p;a.ctatdebug("Problem ["+g+"] desc: "+r+", ui: "+p+", brd: "+e);e=a.addProblem(e,p,n,m,r);e.setTutorFlag(b.getElementAttr(f,"tutor_flag"));f=b.getElementChildren(f);for(p=0;p<f.length;p++)if("Skills"==b.getElementName(f[p]))for(n=b.getElementChildren(f[p]),m=0;m<n.length;m++){var r=n[m],h=0;e.addSkillOpps({name:b.getElementAttr(r,"name"),category:b.getElementAttr(r,"category"),opportunities:Number.isNaN(h=Number.parseInt(b.getElementAttr(r,"occurrences")),
10)?0:h})}d.push(e)}console.log("CTATPackage.processProblemsElement result",d);return d};this.processProblemSetsElement=function(c){c=b.getElementChildren(c);a.ctatdebug("CTATPackage.processProblemSetsElement ... nChildren="+c.length);for(var d=0;d<c.length;d++);return[]};this.processAssetsElement=function(c,d){c=b.getElementChildren(c);a.ctatdebug("CTATPackage.processAssetsElement ... nChildren="+c.length);for(var g=0;g<c.length;g++){var f=c[g],e;"Asset"==b.getElementName(f)&&"undefined"!=d[e=b.getElementAttr(f,
"name")]&&(d[e]=b.getElementAttr(f,"asset_locator"))}return d};this.addProblem=function(b,c,d,f,g){var e=new CTATProblem;e.setProblemFile(b);e.setStudentInterface(c);e.setName(d?d:b);e.setLabel(f?f:b);e.setDescription(g?g:b);a.ctatdebug("Adding problem ...");a.getProblemSets()[0].addProblem(e);return e};this.getRelativePath=function(a,b){return b?CTATPackage.makeRelativePath(k[a],k[b]):k[a]};this.setURLPrefix=function(a){d=a};this.getURLPrefix=function(){return d};this.setPackageURL=function(a){c=
a};this.getPackageURL=function(){return c};this.setDefaultStudentInterface=function(a){e=a};this.getDefaultStudentInterface=function(){return e};this.getProblems=function(){return h};this.getProblemSets=function(){return g}};CTATPackage.prototype=Object.create(CTATBase.prototype);CTATPackage.prototype.constructor=CTATPackage;
CTATPackage.makeRelativePath=function(a,b){if(!b)return a;if(!a)return b;a=String(a).split("/");b=String(b).split("/");for(var c=0,d=0,e="";c<a.length&&d<b.length&&a[c]==b[d];)d=++c;for(;c++<a.length-1;)e+="../";for(;d<b.length-1;)e=e+b[d++]+"/";return e+b[d]};var CTATConnectionBase=function(a,b){CTATBase.call(this,"CTATConnectionBase","ctatconnection");var c=-1,d="",e="http";this.setURL=function(a){d=a};this.getURL=function(){return d};this.setID=function(a){c=a};this.getID=function(){return c};this.setSocketType=function(a){e=a};this.getSocketType=function(){return e}};CTATConnectionBase.prototype=Object.create(CTATBase.prototype);CTATConnectionBase.prototype.constructor=CTATConnectionBase;var CTATConnection=function(a){function b(){g.ctatdebug("init ()");var a=flashVars?flashVars.getRawFlashVars():c?c:{},a=a.session_id?a.session_id:"dummySession";if(null!==d){"dummySession"==a&&g.ctatdebug("Unable to find CTAT session information from environment, trying OLI ...");try{d.setRequestHeader("Content-type",e.contentType),d.setRequestHeader("ctatsession",a)}catch(q){alert("HTTP object creation error: "+q.message)}}else"undefined"==typeof $?alert("Internal error: http object is null right after creation"):
e.headers.ctatsession=a;g.ctatdebug("init () done")}CTATConnectionBase.call(this,"CTATConnection");var c=a,d=null,e={contentType:"text/plain",data:null,processData:!1,method:"POST",mimeType:"text/html",headers:{}},h=!1,g=this,k=null;g.setSocketType("http");this.setContentType=function(a){e.contentType=a};this.getContentType=function(){return e.contentType};this.setConsumed=function(a){h=a;g.ctatdebug("consumed: "+h)};this.getConsumed=function(){g.ctatdebug("consumed: "+h);return h};this.assignReceiveFunction=
function(a){k=a;d&&"undefined"!=typeof d.onreadystatechange&&(d.onreadystatechange=a)};this.assignFailFunction=function(a){e.error=a;d&&"function"==typeof d.error&&d.error(a)};this.setData=function(a){e.data=a};this.getData=function(){return e.data};this.getHTTPObject=function(){return d};this.getMethod=function(){return e.method};this.setMethod=function(a){e.method=a};this.send=function(){g.ctatdebug("send ()");var a=g.getHTTPObject(),c=function(){g.ctatdebug("Networking error!")};a&&(a.onerror=
c);try{a&&a.open(g.getMethod(),g.getURL(),!0)}catch(l){g.ctatdebug("Error in newConnection.httpObject.open: "+l.message);return}b();try{"undefined"!=typeof $?d=a=$.ajax(g.getURL(),e).done(k).fail(c):e.data?a.send(e.data):a.send()}catch(l){this.ctatdebug("Error in newConnection.httpObject.send: "+l.message)}};this.then=function(a,b){var c=d&&"function"==typeof d.then;g.ctatdebug("CTATConnection.then() supported "+c+", done & fail:\n  "+a+",\n  "+b);return c?d.then(a,b):Promise.resolve("CTATConnection.then() not supported").then(a,
b)};g.ctatdebug("createHTTPObject ()");d=new XMLHttpRequest;if("undefined"!=typeof $)d=null;else if(window.XMLHttpRequest)g.ctatdebug("Creating regular XMLHttpRequest ..."),d=new XMLHttpRequest,d.overrideMimeType&&d.overrideMimeType("text/html");else if(g.ctatdebug("Trying alternative HTTP object creation ..."),window.ActiveXObject){g.ctatdebug("Detected window.ActiveXObject ...");try{g.ctatdebug("Creating Msxml2.XMLHTTP ..."),d=new ActiveXObject("Msxml2.XMLHTTP")}catch(n){try{g.ctatdebug("Creating Microsoft.XMLHTTP ..."),
d=new ActiveXObject("Microsoft.XMLHTTP")}catch(q){alert("Error: Unable to create HTTP Request Object: "+q.message)}}}else alert("Internal error: an HTTP connection object could not be created")};CTATConnection.prototype=Object.create(CTATConnectionBase.prototype);CTATConnection.prototype.constructor=CTATConnection;var CTATGuid={s4:function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},guid:function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()}};var CTATConfiguration=function(){CTATBase.call(this,"CTATConfiguration","config");var a=this,b={},c=null,d=null,e=null,h=null;this.raw={admit_code:"ies",authenticity_token:"",auth_token:"none",BehaviorRecorderMode:"AuthorTimeTutoring",class_name:"DefaultClass",curriculum_service_url:"",connection:"javascript",dataset_level_name:"none",dataset_level_type:"ProblemSet",dataset_name:"none",expire_logout_url:"none",info:"",instructor_name:"none",instrumentation_log:"off",lcId:"none",Logging:"None",log_service_url:"http://pslc-qa.andrew.cmu.edu/log/server",
log_to_disk_directory:".",problem_name:"none",problem_position:"none",problem_started_url:"none",problem_state_status:"empty",question_file:"none",refresh_session_url:"none",remoteSocketPort:"20080",remoteSocketSecurePort:"20443",remoteSocketURL:"127.0.0.1",restore_problem_url:"",reuse_swf:"false",run_problem_url:"none",school_name:"none",SessionLog:"true",session_id:CTATGuid.guid(),session_timeout:"none",show_debug_traces:"false",skills:"",source_id:"PACT_CTAT_HTML5",student_interface:"none",student_problem_id:"none",
study_condition_name:"none",study_condition_type:"none",study_condition_description:"none",study_name:"Study1",target_frame:"_parent",TutorShopDeliveryMethod:"sendandload",tutoring_service_communication:"javascript",user_guid:"none",wmode:"opaque",ssl:"off",sui:"",centerTutor:!1,previewMode:!1,width:550,height:450};this.assignRawFlashVars=function(b){a.ctatdebug("assignRawFlashVars() raw['session_id'] "+a.raw.session_id+", aData['session_id'] "+b.session_id);a.raw=b;a.preParse()};this.getRawFlashVars=
function(){return a.raw};this.getSingleParameterValues=function(b){var c=[];if(!b)return c;var d=a.getRawFlashVars(),g;for(g in b){var e=b[g];d[e]&&"none"!=d[e]&&c.push(d[e])}return c};this.usingFlash=function(){return this.getSingleParameterValues(["student_interface","swf_name"]).some(function(a){return 0<=a.search(/[.]swf$/i)})};this.generateDefaultConfiguration=function(b,c){var d={},g=0,e=0;if(b)for(var f in b)d[f]=b[f],g++;a.ctatdebug("generateDefaultConfiguration() nDefaults "+g+", result['session_id'] "+
d.session_id);if("undefined"!=typeof c&&null!=c)for(f in c)d[f]=c[f],e++;a.ctatdebug("generateDefaultConfiguration() nLocalVars "+e);c=b=null;if(window&&window.frameElement&&(c=window.frameElement.getAttribute("data-params"))){b=jQuery.parseJSON(c);console.log("setting data params from iframe attr");for(var k in b)d[k]=CTATGlobals.EncodedParams[k]?decodeURIComponent(b[k].replace(/\+/g,"%20")):b[k],console.log("set "+k+" to "+d[k])}if(null===b)for(k=$('object param[name="flashvars"]'),a.ctatdebug("generateDefaultConfiguration() objs "+
k),b=0;b<k.length;++b)if(c=$(k[b]).attr("value"),a.ctatdebug("generateDefaultConfiguration() fVarsAsString "+c),c&&(c=parseQueryStringArgs(c))&&c.question_file)for(var p in c)d[p]=c[p];ctatdebug("tutorPrep ("+d+")");p={};if(null===d||void 0===d)ctatdebug("tutorPrep(): Internal error: null argument passed");else{ctatdebug("parseQueryString ()");k=location.search;ctatdebug("Query String: "+k);b="?"==k.charAt(0)?k.substring(1):k;k={};if(b)for(b=b.split("&"),c=0;c<b.length;c++){g=b[c].split("=");ctatdebug("Setting flashvar "+
g[0]+", to: "+decodeURIComponent(g[1].replace(/\+/g," ")));k[decodeURIComponent(g[0])]="";for(e=1;e<g.length;e++)k[decodeURIComponent(g[0])]+=(1<e?"=":"")+decodeURIComponent(g[e].replace(/\+/g," "));ctatdebug("Decoded args: "+k[decodeURIComponent(g[0])])}null!==k&&(ctatdebug("tutorPrep(): Assigning parsed arguments ..."),p=k);k=!1;for(var h in p)if(p.hasOwnProperty(h))switch(ctatdebug("Processing external FlashVar "+h+"("+p[h]+")"),h){case "GENERATED":"on"==p[h]&&(d.session_id=CTATGuid.guid(),k=!0);
break;case "BRD":d.question_file=p[h];break;case "BRMODE":d.BehaviorRecorderMode=p[h];break;case "PROBLEM":d.problem_name=p[h];break;case "DATASET":d.dataset_name=p[h];break;case "LEVEL1":d.dataset_level_name1=p[h];break;case "TYPE1":d.dataset_level_type1=p[h];break;case "LEVEL2":d.dataset_level_name2=p[h];break;case "TYPE2":d.dataset_level_type2=p[h];break;case "LEVEL3":d.dataset_level_name3=p[h];break;case "TYPE3":d.dataset_level_type3=p[h];break;case "LEVEL4":d.dataset_level_name4=p[h];break;case "TYPE4":d.dataset_level_type4=
p[h];break;case "USER":d.user_guid=p[h];break;case "SESSION":!1===k&&(d.session_id=p[h]);break;case "SOURCE":d.source_id=p[h];break;case "LOGTYPE":d.Logging=p[h];break;case "PORT":d.remoteSocketPort=p[h];break;case "REMOTEURL":d.remoteSocketURL=p[h];break;case "DISKDIR":d.log_to_disk_directory=p[h];break;case "log_service_url":d.log_service_url=p[h];break;case "URL":d.log_service_url=p[h];break;case "LOGURL":d.log_service_url=p[h];break;case "CONNECTION":d.tutoring_service_communication=p[h];break;
case "SUI":d.sui=p[h];break;case "VAR1":d.var1=p[h];break;case "VAL1":d.val1=p[h];break;case "VAR2":d.var2=p[h];break;case "VAL2":d.val2=p[h];break;case "VAR3":d.var3=p[h];break;case "VAL3":d.val3=p[h];break;case "VAR4":d.var4=p[h];break;case "VAL4":d.val4=p[h];break;case "SLOG":case "SessionLog":d.SessionLog=p[h];break;case "KEYBOARDGROUP":"Disabled"==p[h]&&(d.keyboard="disabled");"Auto"==p[h]&&(d.keyboard="auto");"On"==p[h]&&(d.keyboard="on");break;default:d[h]=p[h]}}return d};this.getCustomFields=
function(){return b};this.setTimeZone=function(b){a.ctatdebug("setTimeZone ("+b+")");null==b||""==b||void 0==b?(b=jstz.determine(),a.ctatdebug("Assigning detected timezone: "+b.name()),b=b.name()):(50<b.length&&(b=b.substr(0,50)),3!=b.length&&4!=b.length||a.ctatdebug("3 and 4 letter time zone abbreviations are deprecated. See list of tz database zone names for better options"));null!=a.raw&&(a.raw.timezone=b)};this.getTimeZone=function(){return null!=a.raw&&a.raw.timezone?a.raw.timezone:"UTC"};this.listWithAmpersands=
function(){var b="",c;for(c in a.raw)var d=c+"="+encodeURIComponent(a.raw[c]),b=""!=b?b+"&"+d:d;a.ctatdebug("CTATConfiguration.listWithAmpersands() result "+b.substring(0,25)+"...");return b};this.listFlashVars=function(){ctatdebug("listFlashVars ()");for(var b in a.raw)ctatdebug("["+b+"]: "+a.raw[b])};this.preParse=function(){ctatdebug("preParse ()");if(void 0==a.raw.dataset_name||void 0==a.raw.dataset_name)a.raw.dataset_name="DefaultDataset";var c=0,d;for(d in a.raw){if("VAR"==d||"var"==d)b[d]=
a.raw[d];c++}a.ctatdebug("preParse() nRaw "+c);c=0;for(d=!0;1==d;){d=!1;var e="custom_field_name"+(c+1),h="custom_field_value"+(c+1);a.ctatdebug("Trying : "+a.raw[e]+","+a.raw[h]);null!=a.raw[e]&&(a.ctatdebug("Adding: "+e+","+a.raw[h]),b[a.raw[e]]=a.raw[h],d=!0,c++)}};this.getDatasetNames=function(){a.ctatdebug("getDatasetNames ()");if(null!=c)return c;c={};c=[];for(var b=0,d=!0;1==d;){var d=!1,e="dataset_level_name"+(b+1);null!=a.raw[e]&&(a.ctatdebug("Adding: "+e+","+a.raw[e]),c[b]=a.raw[e],d=!0,
b++)}return c};this.getDatasetTypes=function(){a.ctatdebug("getDatasetTypes ()");if(null!=d)return d;d=[];for(var b=0,c=!0;1==c;){var c=!1,e="dataset_level_type"+(b+1);null!=a.raw[e]&&(a.ctatdebug("Adding: "+e+","+a.raw[e]),d[b]=a.raw[e],c=!0,b++)}return d};this.getConditionNames=function(){var b=[],c=0;void 0!=a.raw.study_condition_name&&""!=a.raw.study_condition_name&&(b.push(a.raw.study_condition_name),c++);for(var d=0,e=!0;1==e;){var e=!1,h="study_condition_name"+(d+1);null!=a.raw[h]&&(a.ctatdebug("Adding: "+
h+","+a.raw[h]),b[d+c]=a.raw[h],e=!0,d++)}return b};this.getConditionTypes=function(){e=[];var b=0;void 0!=a.raw.study_condition_type&&""!=a.raw.study_condition_type&&(e.push(a.raw.study_condition_type),b++);for(var c=0,d=!0;1==d;){var d=!1,h="study_condition_type"+(c+1);null!=a.raw[h]&&(a.ctatdebug("Adding: "+h+","+a.raw[h]),e[c+b]=a.raw[h],d=!0,c++)}return e};this.getConditionDescriptions=function(){a.ctatdebug("getConditionDescriptions ()");h=[];var b=0;a.raw.study_condition_description&&""!==
a.raw.study_condition_description&&(a.ctatdebug("Adding study_condition_description: "+a.raw.study_condition_description),h.push(a.raw.study_condition_description),b++);for(var c=0,d=!0;!0===d;){var d=!1,e="study_condition_description"+(c+1);null!=a.raw[e]&&(a.ctatdebug("Adding: "+e+","+a.raw[e]),h[c+b]=a.raw[e],d=!0,c++)}return h};this.get=function(b){return a.raw[b]};this.set=function(b,c){b&&(a.raw[b]=c)};this.setParams=function(b){if(b)for(var c in b)a.set(c,b[c])};this.isInstructorMode=function(){var a=
this.getRawFlashVars();return a&&a.deliverymode?"delivery"==a.deliverymode?!1:!0:!1};this.getLoggingLibrary=function(){null===commLoggingLibrary&&(commLoggingLibrary=new CTATLoggingLibrary(!0));return commLoggingLibrary};this.setPreviewMode=function(b,c){a.raw.previewMode=c};this.setCenterTutor=function(b,c){a.raw.centerTutor=c};this.setTutorWidth=function(b,c){a.raw.width=c};this.setTutorHeight=function(b,c){a.raw.height=c};this.setTutorDimensions=function(b,c,d){a.raw.width=c;a.raw.height=d};this.setTutorValue=
function(b,c,d){a.raw[c]=d};this.setCommunicationMode=function(b,c){a.raw.tutoring_service_communication=c};this.setRemoteSocketURL=function(b,c){a.raw.remoteSocketURL=c};this.setRemoteSocketPort=function(b,c){a.raw.remoteSocketPort=c}};CTATConfiguration.prototype=Object.create(CTATBase.prototype);CTATConfiguration.prototype.constructor=CTATConfiguration;flashVars=CTATConfiguration.theConfObject=null;
CTATConfiguration.generateDefaultConfigurationObject=function(a,b){if(!CTATConfiguration.theConfObject){CTATConfiguration.theConfObject=new CTATConfiguration;var c=CTATConfiguration.theConfObject.generateDefaultConfiguration(CTATConfiguration.theConfObject.raw,a);CTATConfiguration.theConfObject.assignRawFlashVars(c);"none"==CTATConfiguration.theConfObject.get("session_id")&&CTATConfiguration.theConfObject.set("session_id",CTATGuid.guid());flashVars=CTATConfiguration.theConfObject;console.log("CTATConfiguration.generateDefaultConfigurationObject() flashVars.getRawFlashVars()['session_id'] "+
flashVars.getRawFlashVars().session_id);console.log("flashVars.getRawFlashVars()['remoteSocketPort'] "+flashVars.getRawFlashVars().remoteSocketPort)}"Default"!=b&&"OLI"!=b||CTATConfiguration.theConfObject.setParams(a);return CTATConfiguration.theConfObject};CTATConfiguration.getRawFlashVars=function(){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.getRawFlashVars()};
CTATConfiguration.get=function(a){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.get(a)};CTATConfiguration.set=function(a,b){CTATConfiguration.generateDefaultConfigurationObject();CTATConfiguration.theConfObject.set(a,b)};CTATConfiguration.getCustomFields=function(){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.getCustomFields()};
CTATConfiguration.setParams=function(a){CTATConfiguration.generateDefaultConfigurationObject();CTATConfiguration.theConfObject.setParams(a)};CTATConfiguration.getSingleParameterValues=function(a){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.getSingleParameterValues(a)};CTATConfiguration.usingFlash=function(){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.usingFlash()};CTATConfiguration.prototype.set=CTATConfiguration.prototype.set;
CTATConfiguration.prototype.get=CTATConfiguration.prototype.get;var CTATWSConnection=function(a){CTATConnectionBase.call(this,"CTATWSConnection");var b="",c=!1,d=this,e=null,h=[],g=!1,k=0,n=0,q=null,l=null;d.setSocketType("ws");this.setConsumed=function(a){c=a;d.ctatdebug("consumed: "+c)};this.getConsumed=function(){d.ctatdebug("consumed: "+c);return c};this.assignReceiveFunction=function(a){q=a};this.assignCloseFunction=function(a){l=a};this.setData=function(a){b=a};this.getData=function(){return b};this.init=function(){ctatdebug("init ("+d.getURL()+"); websocket "+
e);null==e&&(e=new WebSocket(d.getURL()),e.addEventListener("open",function(a){ctatdebug("STATUS: open");g=!0;ctatdebug("Connection open, flushing outgoing queue ...");k=(new Date).getTime();if(0<h.length){for(a=0;a<h.length;a++)e.send(h[a]);h=[]}}),e.addEventListener("message",function(a){n=(new Date).getTime();ctatdebug("STATUS: message after "+(n-k)+" ms");ctatdebug("Received: "+a.data);q?q(a.data):ctatdebug("Error: no processing function provided")}),e.addEventListener("close",function(a){ctatdebug("STATUS: close; "+
(a?"code "+a.code+", reason "+a.reason:"no event"));g=!1;e.close(1E3,a?a.reason?a.reason:"received close code "+a.code:"no close event received");l&&l(a)}),e.addEventListener("error",function(a){ctatdebug("STATUS: error; "+(a?a.type:"no event"));g=!1;e.close(1E3,"client closing in response to error")}),ctatdebug("init () done"))};this.send=function(){ctatdebug("send ()");d.init();!1===g?(ctatdebug("Connection not ready yet, storing ..."),h.push(b)):(ctatdebug("Connection ready, sending data ..."),
k=(new Date).getTime(),e.send(b))};this.getWebSocket=function(){return e};this.close=function(a,b){g=!1;l=b||l;e.close(1E3,a||"no reason")}};CTATWSConnection.prototype=Object.create(CTATConnectionBase.prototype);CTATWSConnection.prototype.constructor=CTATWSConnection;var CTATCanvasComponent=function(a){var b=this,c=[];this.addShape=function(a){c.push(a)};this.hideShape=function(a){for(var b=0;b<c.length;b++)if(c[b].getName()==a){c[b].modifyCanvasCSS("visibility","hidden");break}};this.showShape=function(a){for(var b=0;b<c.length;b++)if(c[b].getName()==a){c[b].modifyCanvasCSS("visibility","visible");break}};this.hideComponent=function(){for(var a=0;a<c.length;a++)c[a].modifyCanvasCSS("visibility","hidden")};this.showComponent=function(){for(var a=0;a<c.length;a++)c[a].modifyCanvasCSS("visibility",
"visible")};this.moveShape=function(a,b,h){for(var d=0;d<c.length;d++)if(c[d].getName()==a){c[d].modifyCanvasCSS("left",b+"px");c[d].modifyCanvasCSS("top",h+"px");break}};this.moveComponent=function(a,b){for(var d=0;d<c.length;d++)c[d].modifyCanvasCSS("left",a+"px"),c[d].modifyCanvasCSS("top",b+"px")};this.removeShape=function(a){for(var b=0,d=0;d<c.length;d++)if(c[d].getName()==a){b=d;break}c[b].detatchCanvas();c.splice(b,1)};this.removeComponent=function(){for(;0<c.length;)b.removeShape(c[0].getName())}};var scrimIsUp=!1,errorScrim=!1,waitScrim=!0,warnScrim=!1,connectionScrim=!1,authorTimeSet=!0,inAuthorTime=!0,CTATScrim=function(){function a(){warnScrim=!1;m.scrimDown()}function b(a){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&m.scrimDownForced(),m.ctatdebug("errScrimUp ("+a+")"),!0===errorScrim?!0===g&&(g=!1,getSafeElementById(ctatcontainer).removeChild(p)):!0===warnScrim&&(g=!0),m.scrimUp(a))}function c(a,b){m.ctatdebug("makeHTMLButton ()");var c=document.createElement("input");c.type="button";
c.value=b;a?(m.ctatdebug("clickHandle!=null"),c.onclick=a):(m.ctatdebug("clickHandle==null"),c.onclick=m.defaultClickHandler);c.id=b;c.setAttribute("class","scrimButton");return c}CTATBase.call(this,"CTATScrim","__undefined__");var d="",e=!1,h=!1,g=!1,k=null,n=null,q=new CTATCanvasComponent("CTAT Scrim"),l=[],f=null,t=null,p=null,w=null,m=this;this.scrimUp=function(b,l){if("google"!=CTATConfig.platform){m.ctatdebug("scrimUp ("+b+", "+l+")");if(l)return setTimeout(m.scrimUp.bind(m,b),l);b=CTATGlobals.languageManager.filterString(b);
m.ctatdebug("Message: "+b);!0===scrimIsUp?(d=!0===waitScrim?b:d+(" \n "+b),q.removeComponent(),m.removeHTMLElements()):(d=b,scrimIsUp=!0);m.ctatdebug("scrimUp() to call drawScrim() scrimIsUp "+scrimIsUp);m.ctatdebug("drawScrim ()");if("google"==CTATConfig.platform)m.ctatdebug("This is not available for now when we're in this environment");else if($('<div id="scrim" class="ctatpageoverlay"></div>').appendTo("body"),$("#scrim").css("z-index",1E3),"google"!=CTATConfig.platform&&($("#scrimpanel").empty(),
$("#scrim").append('<div class="css3-windows-7"><div class="fenster"><h4 class="titel">CTAT Info Panel</h4><div id="scrimpanel" class="inhalt"><br>'+d+"<br><br></div></div></div>"),!0===g&&(waitScrim=!1,p=c(a,"close"),$(p).appendTo("#scrimpanel")),!0===e&&(waitScrim=!1,f=c(k,"yes"),$(f).appendTo("#scrimpanel"),e=!1),!0===h&&(waitScrim=!1,t=c(n,"no"),$(t).appendTo("#scrimpanel"),h=!1),!0===waitScrim)){m.ctatdebug("Adding spinner ...");$("#scrimpanel").append("<br>");b=$('<div id="scrim_spin">');b.css("width",
"100%");b.css("position","relative");$("#scrimpanel").append(b);try{var r=(new Spinner({className:"scrim_spinner"})).spin();$("#scrim_spin").append(r.el)}catch(B){(B instanceof ReferenceError||B instanceof TypeError)&&m.ctatdebug('Spinner is not available, please include it in the build or add <script src="node_modules/spin.js/spin.min.js">\x3c/script> to the html file.',B,typeof B)}}}};this.waitScrimUp=function(){m.ctatdebug("waitScrimUp () CTATConfig.platform "+CTATConfig.platform+", scrimIsUp "+
scrimIsUp);"google"!=CTATConfig.platform&&(!0===scrimIsUp&&m.scrimDownForced(),waitScrim=!0,m.scrimUp(CTATGlobals.languageManager.getString("LOADING")),m.ctatdebug("return from waitScrimUp(): scrimIsUp "+scrimIsUp))};this.nextProblemScrimUp=function(){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&m.scrimDownForced(),m.ctatdebug("nextProblemScrimUp ()"),m.scrimUp(CTATGlobals.languageManager.getString("NEXTPROBLEM")))};this.OKScrimUp=function(a,b){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&m.scrimDownForced(),
m.ctatdebug("OKScrimUp ("+a+","+b+")"),waitScrim=h=e=g=warnScrim=errorScrim=!1,m.scrimUp(a),w=c(b,"OK"),$(w).appendTo("#scrimpanel"))};this.confirmScrimUp=function(a,b,c){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&m.scrimDownForced(),m.ctatdebug("confirmScrimUp ("+a+","+b+","+c+")"),h=e=!0,n=c,k=b,m.scrimUp(a))};this.errorScrimUp=function(a){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&m.scrimDownForced(),!1===authorTimeSet?(m.ctatdebug("we don't know if we're in authorTime or not yet so we're just going to hold onto the messasge"),
l.push("ERROR: "+a),errorScrim=!0):!1===inAuthorTime?m.ctatdebug("We're not in authorTime, student's don't need to see our design mistakes"):(errorScrim=!0,b("ERROR: "+a)))};this.warningScrimUp=function(a){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&m.scrimDownForced(),!1===authorTimeSet?(m.ctatdebug("we don't know if we're in authorTime or not yet so we're just going to hold onto the messasge"),l.push("WARNING: "+a),warnScrim=!0):!1===inAuthorTime?m.ctatdebug("We're not in authorTime, student's don't need to see our design mistakes"):
(warnScrim=!0,b("WARNING: "+a)))};this.handleTSDisconnect=function(){connectionScrim=!0;m.scrimUp(CTATGlobals.languageManager.getString("TUTORDISCONNECTED"))};this.removeHTMLElements=function(){};this.scrimDown=function(){"google"!=CTATConfig.platform&&(!1===scrimIsUp?m.ctatdebug("The scrim isn't up, returning"):!0===errorScrim?m.ctatdebug("The scrim is up to describe errors to the user, leave it up!"):!0===warnScrim?m.ctatdebug("The scrim is up to display warnings to the user, leave it up!"):!0===
connectionScrim?m.ctatdebug("The scrim is up for a connection issue leave it up!"):m.scrimDownForced())};this.scrimDownForced=function(){m.ctatdebug("enter scrimDownForced() scrimIsUp "+scrimIsUp);$("#scrim").remove();q.removeComponent();m.removeHTMLElements();waitScrim=scrimIsUp=!1;d="";m.ctatdebug("exit scrimDownForced() scrimIsUp "+scrimIsUp)};this.defaultClickHandler=function(){m.ctatdebug("defaultClickHandler ()");m.scrimDown()};this.setInAuthorTime=function(a){m.ctatdebug("setting inAuthorTime = "+
a);authorTimeSet=!0;inAuthorTime=a;if(!a)warnScrim=errorScrim=!1,g&&null.removeChild(p);else if(errorScrim||warnScrim)for(var c in l)b(c)};this.getInAuthorTime=function(){return inAuthorTime}};CTATScrim.prototype=Object.create(CTATBase.prototype);CTATScrim.prototype.constructor=CTATScrim;CTATGlobals.languageManager=CTATLanguageManager.theSingleton;CTATScrim.scrim=new CTATScrim;var CTAT=function(){};"undefined"!=typeof window&&null!=window&&(window.CTAT=CTAT);"undefined"!==typeof module&&(module.exports=CTAT);CTAT.ToolTutor={interfaceMessages:[],tutorMessages:[]};
Object.defineProperty(CTAT.ToolTutor,"message_handler",{enumerable:!0,get:function(){if(window.hasOwnProperty("getInterfaceObject")&&"function"===typeof window.getInterfaceObject)return window.getInterfaceObject();if(window.hasOwnProperty("interfaceObject"))return window.interfaceObject;this.hasOwnProperty("_interface")||(this._interface=null);return this._interface},set:function(a){window.hasOwnProperty("interfaceObject")?window.interfaceObject=a:this._interface=a;return a}});
Object.defineProperty(CTAT.ToolTutor,"tutor",{enumerable:!0,get:function(){if(window.hasOwnProperty("getTutorObject")&&"function"===typeof window.getTutorObject)return window.getTutorObject();if(window.hasOwnProperty("tutorObject"))return window.tutorObject;this.hasOwnProperty("_tutor")||(this._tutor=null);return this._tutor},set:function(a){window.hasOwnProperty("tutorObject")?window.tutorObject=a:this._tutor=a;return a}});
CTAT.ToolTutor.registerTutor=function(a){if(window.hasOwnProperty("registerTutor")&&"function"===typeof window.registerTutor)return window.registerTutor(a);if(this.tutor=a)for(;0<this.tutorMessages.length;)this.sendToTutor(this.tutorMessages.shift())};
CTAT.ToolTutor.sendToInterface=function(a){ctatdebug("CTAT.ToolTutor.sendToInterface()\n  "+a);return window.hasOwnProperty("sendToInterface")&&"function"===typeof window.sendToInterface?window.sendToInterface.apply(null,arguments):this.message_handler?this.message_handler.receiveFromTutor(a):commMessageHandler?commMessageHandler.processMessage(a):this.interfaceMessages.push(a)};
CTAT.ToolTutor.registerInterfaceMessageHandler=function(a){ctatdebug("CTAT.ToolTutor.registerInterfaceMessageHandler("+a+")");"string"===typeof a&&(a=document.getElementById(a));if(this.message_handler=a)for(;0<this.interfaceMessages.length;)this.sendToInterface(this.interfaceMessages.shift())};CTAT.ToolTutor.registerInterface=function(a){if(window.hasOwnProperty("registerInterface")&&"function"===typeof window.registerInterface)return window.registerInterface(a);this.registerInterfaceMessageHandler(a)};
CTAT.ToolTutor.sendToTutor=function(a){return window.hasOwnProperty("sendToTutor")&&"function"===typeof window.sendToTutor?window.sendToTutor(a):this.tutor?this.tutor.receiveFromInterface(a):this.tutorMessages.push(a)};
CTAT.ToolTutor.reboot=function(a){(a="undefined"!=typeof location&&location&&location.href?location.href:null)&&console.log("ToolTutor.reboot(), setting location to "+a);return a&&!CTATConfiguration.get("editorMode")?("function"==typeof setTimeout?setTimeout(location.replace.bind(location),600,a):location.replace(a),!0):!1};var CTATTutorMessageBuilder=function(){CTATBase.call(this,"CTATTutorMessageBuilder","__undefined__")};CTATTutorMessageBuilder.isHint=function(a){return null===a||"undefined"===typeof a?!1:0===a.toString().toLowerCase().indexOf(CTATTutorMessageBuilder.HINT.toLowerCase())};CTATTutorMessageBuilder.isCorrect=function(a){if(null===a||"undefined"===typeof a)return!1;a=a.toString().toLowerCase();return 0===a.indexOf(CTATTutorMessageBuilder.CORRECT.toLowerCase())?!0:0===a.indexOf(CTATExampleTracerLink.SUCCESS.toLowerCase())};
CTATTutorMessageBuilder.prototype=Object.create(CTATBase.prototype);CTATTutorMessageBuilder.prototype.createInCorrectActionMessage=function(a,b){this.ctatdebug("createInCorrectActionMessage ()");a="<message><verb>SendNoteProperty</verb><properties><MessageType>InCorrectAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>");this.ctatdebug("In CTATTutorMessageBuilder "+b);a+=b.toXMLString(!1);return a+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createCorrectActionMessage=function(a,b){this.ctatdebug("createCorrectActionMessage ()");a="<message><verb>SendNoteProperty</verb><properties><MessageType>CorrectAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>")+b.toXMLString(!1);return a+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createAssociatedRulesMessageForHint=function(a,b,c,d,e,h,g,k,n){g=void 0==g?a.length:g;k=void 0==k?1:k;b="<message><verb>SendNoteProperty</verb><properties><MessageType>AssociatedRules</MessageType><Indicator>Hint</Indicator>"+(b?b:new CTATSAI("","","")).toXMLString();b+="<TutorAdvice>";for(var q=0;q<a.length;q++)b+="<value><![CDATA["+a[q]+"]]\x3e</value>";b=b+("</TutorAdvice><TotalHintsAvailable>"+g+"</TotalHintsAvailable><CurrentHintNumber>"+k+"</CurrentHintNumber>")+
("<Actor>"+c+"</Actor>")+this.fmtSkillBarVector(d);b+="<skillBarDelimiter><![CDATA[`]]\x3e</skillBarDelimiter>";if(e||0===e)b+="<StepID>"+e+"</StepID>";b+="<transaction_id>"+h+"</transaction_id>";b+="<LogAsResult>true</LogAsResult>";b+=this.formatCustomFields(n);return b+="</properties></message>"};
CTATTutorMessageBuilder.prototype.createAssociatedRulesMessageForAction=function(a,b,c,d,e,h,g,k,n,q,l){this.ctatdebug("TMB.createAssociatedRulesMessageForAction(indicator "+a+", sai "+b+", actor "+c+", studentSAI "+d+",\n  skillBarVector "+e+", stepID "+h+", transactionID "+g+",\n  tutorAdvice "+k+", outOfOrder "+n+", traceOutcome "+l);var f="<message><verb>SendNoteProperty</verb><properties><MessageType>AssociatedRules</MessageType>",f=f+("<Indicator>"+(CTATTutorMessageBuilder.isCorrect(a)?"Correct":
"InCorrect")+"</Indicator>"),f=f+(b?b:new CTATSAI("","","")).toXMLString();a=d.toXMLString().replace("<Selection>","<StudentSelection>").replace("<Action>","<StudentAction>").replace("<Input>","<StudentInput>");a=a.replace("</Selection>","</StudentSelection>").replace("</Action>","</StudentAction>").replace("</Input>","</StudentInput>");f+=a;f+="<Actor>"+c+"</Actor>";f+=this.fmtSkillBarVector(e);f+="<skillBarDelimiter><![CDATA[`]]\x3e</skillBarDelimiter>";f+="<StepID>"+h+"</StepID>";f+="<transaction_id>"+
g+"</transaction_id>";k&&(k=k instanceof Array?k:[k],f+="<TutorAdvice>",k.forEach(function(a){return f+="<value><![CDATA["+a+"]]\x3e</value>"}),f+="</TutorAdvice>",f+="<TotalHintsAvailable>"+k.length+"</TotalHintsAvailable><CurrentHintNumber>1</CurrentHintNumber>");f+="<LogAsResult>true</LogAsResult>";f+="<end_of_transaction>"+(k?!1:!0)+"</end_of_transaction>";f+="undefined"!=typeof n&&n?"<OutOfOrder>true</OutOfOrder>":"";f+=l?"<"+CTATMsgType.TRACE_OUTCOME+">"+l+"</"+CTATMsgType.TRACE_OUTCOME+">":
"";f+=this.formatCustomFields(q);return f+="</properties></message>"};CTATTutorMessageBuilder.prototype.formatCustomFields=function(a){var b="";if(a)for(var c in a)a.hasOwnProperty(c)&&(b+="<custom_field><name>"+c+"</name><value>"+(null==a[c]?"":a[c].toString())+"</value></custom_field>");return b?"<custom_fields>"+b+"</custom_fields>":""};
CTATTutorMessageBuilder.prototype.isDoneStep=function(a,b){b[0]=!1;var c=a.getIndicator();if(!c)return!1;var d=a.getStudentSelection();d||(d=a.getProperty("tool_selection"));b[0]=CTATTutorMessageBuilder.isCorrect(indicator);a="done"==d;this.ctatdebug("isDoneStep() indicatorObj "+c+", selectionObj "+d+", correct[0] "+b[0]+", result "+a);return a};
CTATTutorMessageBuilder.prototype.createHintMessage=function(a,b,c,d){c="<message><verb>SendNoteProperty</verb><properties><MessageType>ShowHintsMessage</MessageType><HintsMessage>";for(var e=0;e<a.length;e++)c+="<value><![CDATA["+a[e]+"]]\x3e</value>";c+="</HintsMessage>";b&&b.toXMLString&&(c+=b.toXMLString());return c+("<transaction_id>"+d+"</transaction_id>")+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createErrorMessage=function(a,b){a="<message><verb>SendNoteProperty</verb><properties><MessageType>TutoringServiceError</MessageType><ErrorType>"+a+"</ErrorType><Details>"+(b?b:"");return a+="</Details></properties></message>"};
CTATTutorMessageBuilder.prototype.createSuccessMessage=function(a,b){b=b instanceof Array?b:[b];var c="<message><verb>SendNoteProperty</verb><properties><MessageType>SuccessMessage</MessageType>",c=c+"<SuccessMsg>";b.forEach(function(a){return c+="<value><![CDATA["+a+"]]\x3e</value>"});c+="</SuccessMsg>";c+="<transaction_id>"+a+"</transaction_id>";c+="<end_of_transaction>true</end_of_transaction>";return c+="</properties></message>"};
CTATTutorMessageBuilder.prototype.createBuggyMessage=function(a,b){b=b instanceof Array?b:[b];var c="<message><verb>SendNoteProperty</verb><properties><MessageType>BuggyMessage</MessageType>",c=c+"<BuggyMsg>";b.forEach(function(a){return c+="<value><![CDATA["+a+"]]\x3e</value>"});c+="</BuggyMsg>";c+="<transaction_id>"+a+"</transaction_id>";c+="<end_of_transaction>true</end_of_transaction>";return c+="</properties></message>"};
CTATTutorMessageBuilder.prototype.createLockWidgetMsg=function(a){return"<message><verb>SendNoteProperty</verb><properties><MessageType>SendWidgetLock</MessageType>"+("<WidgetLockFlag>"+a+"</WidgetLockFlag>")+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createMessage=function(a,b){var c="<message><verb>SendNoteProperty</verb><properties><MessageType>"+a+"</MessageType>";if(b)for(var d in b)c+="<"+d+">"+b[d]+"</"+d+">";c+="</properties></message>";this.ctatdebug("CTATTutorMessageBuilder.createMessage("+a+", "+b+") returns "+c);return c};
CTATTutorMessageBuilder.prototype.createStateGraphMessage=function(a,b,c,d,e,h,g){a="<message><verb>SendNoteProperty</verb><properties><MessageType>StateGraph</MessageType>"+("<caseInsensitive>"+a+"</caseInsensitive>")+("<unordered>"+b+"</unordered>")+("<lockWidget>"+c+"</lockWidget>");a+="<suppressStudentFeedback>"+d+"</suppressStudentFeedback>";a+="<highlightRightSelection>"+e+"</highlightRightSelection>";a+="<confirmDone>"+h+"</confirmDone>";a+="<skillBarDelimiter><![CDATA[`]]\x3e</skillBarDelimiter>";
a+=this.fmtSkillBarVector(g);return a+="</properties></message>"};CTATTutorMessageBuilder.prototype.fmtSkillBarVector=function(a){var b="";if(void 0!==a&&null!==a&&0<a.length){for(var b=b+"<Skills>",c=0;c<a.length;c++)b+="<value><![CDATA["+a[c]+"]]\x3e</value>";b+="</Skills>"}return b};
CTATTutorMessageBuilder.prototype.createHighlightWidgetMessage=function(a,b,c,d){a="<message><verb>SendNoteProperty</verb><properties><MessageType>HighlightMsg</MessageType>"+("<HighlightMsgText>"+c+"</HighlightMsgText>")+("<Selection><value>"+a+"</value></Selection>")+("<Action><value>"+b+"</value></Action>");a+="<transaction_id>"+d+"</transaction_id>";a+="<end_of_transaction>true</end_of_transaction>";return a+="</properties></message>"};
Object.defineProperty(CTATTutorMessageBuilder,"TRIGGER",{enumerable:!1,configurable:!1,writable:!1,value:"trigger"});Object.defineProperty(CTATTutorMessageBuilder,"SUBTYPE",{enumerable:!1,configurable:!1,writable:!1,value:"subtype"});Object.defineProperty(CTATTutorMessageBuilder,"TUTOR_PERFORMED",{enumerable:!1,configurable:!1,writable:!1,value:"tutor-performed"});Object.defineProperty(CTATTutorMessageBuilder,"HINT",{enumerable:!1,configurable:!1,writable:!1,value:"Hint"});
Object.defineProperty(CTATTutorMessageBuilder,"CORRECT",{enumerable:!1,configurable:!1,writable:!1,value:"Correct"});CTATTutorMessageBuilder.prototype.constructor=CTATTutorMessageBuilder;"undefined"!==typeof module&&(module.exports=CTATTutorMessageBuilder);var CTATLMS={identifier:null,initLMSConnection:function(){},closeLMSConnection:function(){},setValue:function(a,b){},getValue:function(a){return null},saveProblemState:function(a){if(CTATConfiguration.get("restoreProblemUrl")&&CTATConfiguration.get("curriculum_service_url")){var b=[],c;for(c in a)b.push(c+"="+encodeURIComponent(a[c]));$.post(CTATConfiguration.get("curriculum_service_url"),b.join("&"),null,"application/x-www-form-urlencoded")}},getProblemState:function(a){CTATConfiguration.get("restoreProblemUrl")?
$.get(CTATConfiguration.get("restoreProblemUrl"),"",null,"text").done(function(b){a(b)}).fail(function(b,c,d){a(null);b=(new CTATTutorMessageBuilder).createErrorMessage("Load ProblemState Error",c+" "+d);CTAT.ToolTutor.sendToInterface(b,!0)}):a(null)},gradeStudent:function(a,b){},logEvent:function(a){},processProblemSummary:function(a){},is:{},init:{}};
CTATLMS.init.StandAlone=function(){CTATLMS.identifier=null;CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.commit=function(){};CTATLMS.setValue=function(){};CTATLMS.getValue=function(){return null};CTATLMS.logEvent=function(a){};CTATLMS.saveProblemState=function(){};CTATLMS.getProblemState=function(a){return a(null)};CTATLMS.gradeStudent=function(){};CTATLMS.processProblemSummary=function(){}};CTATLMS.is.SCORM=function(){return window.location.search&&/[?&;]mode=SCORM/i.test(window.location.search)};
CTATLMS.init.SCORM=function(){var a=!1;CTATLMS.identifier="SCORM";CTATLMS.initLMSConnection=function(){if(!0!==a){window.parent.doLMSInitialize();var b=CTATLMS.getValue("cmi.core.lesson_status");CTATConfiguration.set("problem_state_status",b);"not attempted"==b&&CTATConfiguration.set("problem_state_status","incomplete");"passed"==b&&CTATConfiguration.set("problem_state_status","completed");"failed"==b&&CTATConfiguration.set("problem_state_status","incomplete");"browsed"==b&&CTATConfiguration.set("problem_state_status",
"incomplete");CTATLMS.setValue("cmi.core.lesson_status","incomplete");a=!0}};CTATLMS.commit=window.parent.doLMSCommit;CTATLMS.closeLMSConnection=window.parent.doLMSFinish;CTATLMS.setValue=window.parent.doLMSSetValue;CTATLMS.getValue=window.parent.doLMSGetValue;CTATLMS.logEvent=function(a){};CTATLMS.saveProblemState=function(a){return CTATLMS.setValue("cmi.suspend_data",a.problem_state)};CTATLMS.getProblemState=function(a){var b=CTATLMS.getValue("cmi.suspend_data");if(!b&&window.parent&&"function"==
typeof window.parent.doLMSGetLastError){var d=window.parent.doLMSGetLastError();if(0!=d)return console.log("Empty result with error "+d+" from LMS.getValue('cmi.suspend_data'):",window.parent.doLMSGetErrorString?window.parent.doLMSGetErrorString(d):""),a(null)}return a(b)};CTATLMS.gradeStudent=function(a,c){CTATLMS.setValue("cmi.core.score.min",0);CTATLMS.setValue("cmi.core.score.max",100);return CTATLMS.setValue("cmi.core.score.raw",Number((a/c).toFixed(2).replace(/[.]/,"")))};CTATLMS.processProblemSummary=
function(a){["cmi.core.lesson_status","cmi.core.score.raw","cmi.core.exit","cmi.core.session_time"].forEach(function(a){var b=this.getElementsByTagName(a);CTATLMS.setValue(a,$("<div>").html(b[0].innerHTML).text())},a);CTATLMS.commit();CTATLMS.closeLMSConnection()};CTATLMS.initLMSConnection()};CTATLMS.is.XBlock=function(){return window.location.search&&/[?&;]mode=XBlock/i.test(window.location.search)};
CTATLMS.init.XBlock=function(){var a=document.referrer?(new URL(document.referrer)).origin:"";CTATLMS.identifier="XBlock";CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.commit=function(){};CTATLMS.setValue=function(a,c){};CTATLMS.getValue=function(a){return null};CTATLMS.saveProblemState=function(b){parent.postMessage({action:"save_problem_state",input:window.btoa(b.problem_state)},a)};CTATLMS.getProblemState=function(a){return a(window.atob(CTATConfiguration.get("saveandrestore")))};
CTATLMS.gradeStudent=function(b,c){parent.postMessage({action:"grade",input:{value:b,max:c}},a)};CTATLMS.logEvent=function(b){parent.postMessage({action:"log",input:b},a)};CTATLMS.processProblemSummary=function(a){}};CTATLMS.is.Authoring=function(){return window.location.search&&/[?&;]mode=AUTH(ORING)?/i.test(window.location.search)};CTATLMS.is.ToolsListener=function(){return window.location.search&&/[?&;]mode=ctatAsListener/i.test(window.location.search)};
CTATLMS.is.OLI=function(){return window.frameElement&&window.frameElement.getAttribute("data-superactivityserver")||"undefined"!=typeof CTATTarget&&"OLI"==CTATTarget};CTATLMS.is.TutorShop=function(){return window.frameElement&&/"LMS":\s*"TutorShop"/i.test(window.frameElement.getAttribute("data-params"))};
CTATLMS.init.TutorShop=function(){CTATLMS.identifier="TutorShop";CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.commit=function(){};CTATLMS.setValue=function(a,b){};CTATLMS.getValue=function(a){return null};CTATLMS.logEvent=function(a){};CTATLMS.saveProblemState=function(a){if(CTATConfiguration.get("restoreProblemUrl")&&CTATConfiguration.get("curriculum_service_url")){a.session_id=a.session_id?a.session_id:"dummySession";var b=[],c;for(c in a)b.push(c+"="+encodeURIComponent(a[c]));
$.post(CTATConfiguration.get("curriculum_service_url"),b.join("&"),null,"application/x-www-form-urlencoded")}};CTATLMS.getProblemState=function(a){CTATConfiguration.get("restoreProblemUrl")?$.get(CTATConfiguration.get("restoreProblemUrl"),"",null,"text").done(function(b){a(b)}).fail(function(b,c,d){a(null);b=(new CTATTutorMessageBuilder).createErrorMessage("Load ProblemState Error",c+" "+d);CTAT.ToolTutor.sendToInterface(b,!0)}):a(null)};CTATLMS.gradeStudent=function(){};CTATLMS.processProblemSummary=
function(){};console.log("CTATLMS.init.TutorShop emitters",document,"undefined"==typeof lifecycle?"undefined":lifecycle);CTATLMS.statechanges=Array(10).fill(null);"undefined"!=typeof lifecycle&&lifecycle.addEventListener("statechange",function(a){CTATLMS.statechanges.push({time:(new Date).toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:3,hour12:!1}),old:a.oldState,new:a.newState,event:a.originalEvent.type});return CTATLMS.statechanges.shift()});
document.addEventListener("visibilitychange",function(a){return"hidden"===document.visibilityState&&CTATCurriculumService.sendProblemSummary(CTAT.ToolTutor.tutor.getProblemSummary(),!0)})};CTATLMS.is.Assistments=function(){return CTATTarget&&"ASSISTMENTS"==CTATTarget};var evt=new Event("ctatlms");console.log("CTATLMS.js dispatch send evt",evt);parent.dispatchEvent(evt);useDebuggingBasic=!0;console.log("CTATLMS.js dispatch return from evt",evt);var bundleFormatter="",inBundle=!1,useBundling=!1,useOLIEncoding=!1,CTATCommLibrary=function(a,b){CTATBase.call(this,"CTATCommLibrary",a);var c=authenticityToken="",d=0,e=[],h=null,g=a?a:null,k=null==b?!0:b,n=!0,q=null,l=this,f="http",t="ERROR_CONN_TS",p="",w=0;this.teamMembers={};this.setUseCommSettings=function(a){n=a};this.getUseCommSettings=function(){return n};this.setConnectionRefusedMessage=function(a){t=a};this.sendTutorReady=function(a){var b=CTATConfiguration.get("collaborators"),c=CTATConfiguration.get("user_guid"),
d=CTATCommShell.commShell.getGotProblemRestoreEnd();console.log("sendTutorReady collaborators",b,"otm",a,"teamMembers",this.teamMembers,"gotProblemRestoreEnd",d);if(a&&a[c]&&-1!=a[c].subscribed||!d)return a;b=this.teamMembers[c]||{};b.subscribed||(b.subscribed=Date.now(),this.teamMembers[c]=b);for(var f in this.teamMembers)if(-1==this.teamMembers[f].subscribed)return a;parent.postMessage({command:"tutorready",username:CTATConfiguration.get("user_guid"),teamMembers:this.teamMembers},"*");return a};
this.interpretCollab=function(a){ctatdebug("Interpret collab:",a.command,a);var b=null;if("tutorready"==a.command&&a.username!=CTATConfiguration.get("user_guid")){var c=CTATConfiguration.get("collaborators"),d=0,f=(c||"").split(",");for(console.log("interpretCollab",c,"teamMembers",this.teamMembers,"cNames",f);d<f.length;++d){c=this.teamMembers[f[d]]||{};if(-1==c.subscribed){console.log("collaborator quit:",f[d],c,new Date);break}a.username==f[d]&&(c.subscribed=Date.now(),this.teamMembers[f[d]]=c);
if(!c.subscribed){console.log("collaborator still missing:",f[d],c,new Date);break}}this.sendTutorReady(a.teamMembers);d>=f.length&&CTATScrim.scrim.scrimDown()}else"message"==a.command?a.from!=CTATConfiguration.get("user_guid")?b=a.data:ctatdebug("Own message echoed "+a.data):"unsubscribed"==a.command?(d=this.teamMembers[a.from||","])&&-1!=d.subscribed&&(d.subscribed=-1,d=CTATGlobals.languageManager.filterString("YOUR_COLLABORATOR")+(a.from||"")+" ","function"==typeof exitTutor?(d+=CTATGlobals.languageManager.filterString("COLLABORATOR_QUIT_CLICK_OK"),
console.log("scrimUp("+d+")",new Date,exitTutor),CTATScrim.scrim.OKScrimUp(d,exitTutor)):(d+=CTATGlobals.languageManager.filterString("COLLABORATOR_QUIT_CLICK_X"),console.log("scrimUp("+d+")",new Date,typeof exitTutor),CTATScrim.scrim.scrimUp(d,w))):"subscribed"==a.command&&(a.team_members?console.log("subscribed from "+a.from+": teamMembers",this.teamMembers,"data.team_members",a.team_members):console.log("interpretCollab: team_members property missing",a));"function"==typeof document.dispatchEvent&&
document.dispatchEvent(new CustomEvent("receiveFromCollaborator",{detail:a}));return b};this.setSocketType=function(a){f=a;if(l.hasWebSocket()||l.hasPostMessage())$(window).on("message",function(a){if(a.originalEvent.origin===window.location.origin&&(a=a.originalEvent?a.originalEvent.data:null,console.log("message from "+a.from+":",a),a))if(g){if(a=l.interpretCollab(a))g.processMessage(a),l.hasPostMessage()||CTAT.ToolTutor.sendToTutor(a)}else console.log("No http handler defined for websocket listener.")})};
this.setScrimWait=function(a){w=a};this.hasSecureSocket=function(){return/https/i.test(f)||/wss/i.test(f)};this.hasJavaScriptConnection=function(){return/javascript/i.test(f)};this.hasWebSocket=function(){return/websocket/i.test(f)};this.hasPostMessage=function(){return/postmessage/i.test(f)};this.assignHandler=function(a){g=a};this.assignMessageListener=function(a){q=a};this.encodeVariables=function(a){l.ctatdebug("encodeVariables ()");for(var b="",c=0;c<a.length;c++){var d=a[c];0<c&&(b+="&");b+=
d.name;b+="=";b+=encodeURIComponent(d.value)}return b};this.encodeVariablesOLI=function(a){l.ctatdebug("encodeVariablesOLI ()");for(var b="",c=0;c<a.length;c++){var d=a[c];0<c&&(b+="&");b+=d.name;b+="=";b+=encodeURIComponent(d.value)}return b};this.createConnection=function(a,b,c){l.ctatdebug("createConnection () canBeWebSocket "+c);c="undefined"==typeof c?!0:!1!==c;if(!b)return new CTATConnection(a);if(c&&l.hasWebSocket())return c=this.findWSConnection(b),c||(c=new CTATWSConnection(a),c.setID(d),
c.setURL(b),c.assignReceiveFunction(this.processWSReply),c.assignCloseFunction(this.processWSClose),e.push(c),d++),c;c=new CTATConnection(a);c.setID(d);c.setURL(b);c.assignReceiveFunction(l.processReply);e.push(c);d++;return h=c};this.findWSConnection=function(a){ctatdebug("findWSConnection( "+a+" )");a=l.editSocketURLForHTTPS(a);for(var b=0;b<e.length;b++){var c=e[b];ctatdebug("checking: socketType = "+c.getSocketType()+" URL = "+c.getURL());if("ws"==c.getSocketType()&&c.getURL()==a)return c}return null};
this.startBundle=function(){l.ctatdebug("startBundle ()");!1===useBundling?this.ctatdebug("Not using bundling, bump"):(bundleFormatter='<?xml version="1.0" encoding="UTF-8"?><message><verb/><properties><MessageType>MessageBundle</MessageType><messages>',inBundle=!0)};this.endBundle=function(){l.ctatdebug("endBundle ()");!1===useBundling?l.ctatdebug("Not using bundling, bump"):(inBundle=!1,bundleFormatter+="</messages></properties></message>",l.sendXML(bundleFormatter))};this.setFixedURL=function(a){c=
a};this.getURL=function(){l.ctatdebug("getURL ()");if(""!==c)return l.ctatdebug("Returning fixedURL: "+c),c;var a=flashVars.getRawFlashVars(),b="http://";l.hasSecureSocket()&&(b="https://");b=b+a.remoteSocketURL+":"+a.remoteSocketPort;a.remoteSocketURL&&-1!=a.remoteSocketURL.indexOf("http")&&(b=a.remoteSocketURL+":"+a.remoteSocketPort);return b};this.sendXML=function(a,b){l.ctatdebug("Sending: "+a);l.ctatdebug("sendXML ("+a+")");g.updateLastActionTimestamp&&g.updateLastActionTimestamp();if(!0===useBundling&&
!0===inBundle)l.ctatdebug("Bundling ..."),bundleFormatter+=a;else{bundleFormatter=a;flashVars.getRawFlashVars();a=this.getURL();var c=bundleFormatter;-1==bundleFormatter.indexOf("<?xml")&&(c='<?xml version="1.0" encoding="UTF-8"?>'+bundleFormatter);l.getUseCommSettings()&&l.hasJavaScriptConnection()?(l.sendToToolsOrCollaborators(a,c,b),CTATConfiguration.get("noLocalTrace")||CTAT.ToolTutor.sendToTutor(c)):l.send_post(a,c)}};this.sendToToolsOrCollaborators=function(a,b,c){return!l.hasWebSocket()||"ctatAsListener"!=
CTATConfiguration.get("mode")&&"undefined"!=typeof c&&!1===c?!1:(this.send_post(a,b),!0)};this.sendXMLNoBundle=function(a){l.ctatdebug("sendXMLNoBundle ("+a+")");bundleFormatter=a;g.updateLastActionTimestamp&&g.updateLastActionTimestamp();var b=this.getURL(),c=a;-1==a.indexOf("<?xml")&&(c='<?xml version="1.0" encoding="UTF-8"?>'+a);flashVars.getRawFlashVars();l.getUseCommSettings()&&l.hasJavaScriptConnection()?(l.sendToToolsOrCollaborators(b,c),CTAT.ToolTutor.sendToTutor(c)):this.send_post(b,c)};
this.sendXMLURL=function(a,b,c){ctatdebug("sendXMLURL ("+b+", "+c+")");var d=a;-1==a.indexOf("<?xml")&&(d='<?xml version="1.0" encoding="UTF-8"?>'+a);flashVars.getRawFlashVars();l.ctatdebug("Sending: "+d);g.updateLastActionTimestamp&&g.updateLastActionTimestamp();this.getUseCommSettings()&&l.hasJavaScriptConnection()?(l.sendToToolsOrCollaborators(b,d),c||CTAT.ToolTutor.sendToTutor(d)):this.send_post(b,d)};this.send_post_variables=function(a,b){l.ctatdebug("send_post_variables ("+a+")");flashVars.getRawFlashVars();
b=!1===useOLIEncoding?this.encodeVariables(b):this.encodeVariablesOLI(b);this.ctatdebug("Sending: "+b);g.updateLastActionTimestamp&&g.updateLastActionTimestamp();if(!0===CTATGlobals.CommDisabled)return l.ctatdebug("Communications globally disabled, please check your settings"),Promise.reject("Communications globally disabled, please check your settings");var c=l.createConnection(CTATConfiguration.getRawFlashVars(),a,!1);c.setContentType("application/x-www-form-urlencoded");l.ctatdebug("CTATCommLibrary.send_post_variables() data to send:\n  "+
b);null!==q&&q.processOutgoing(b);c.setURL(a);c.setData(b);c.assignReceiveFunction(l.processReply);c.send();return c};this.formPostMessage=function(a){return{command:"message",user_guid:CTATConfiguration.get("user_guid"),data:a}};this.send_post=function(a,b){ctatdebug("send_post ("+a+")");if(!0===CTATGlobals.CommDisabled)l.ctatdebug("Communications globally disabled, please check your settings");else{ctatdebug("Outgoing on wire, "+(l.hasPostMessage()?"to post":"no post")+"; data "+b);var c=flashVars.getRawFlashVars(),
d=a;if(l.hasPostMessage())b=l.formPostMessage(b),b.dest="sendToTutor",parent.postMessage(b,parent.location.origin);else{if(l.hasWebSocket()){if(CTATCommShell.commShell.hasTutorShopCable()){parent.postMessage(l.formPostMessage(b),"*");return}a&&(ctatdebug("opening websocket connection: url "+a),d=a.replace(/https?:/,"ws:"),d=l.editSocketURLForHTTPS(d),ctatdebug("opening websocket connection to "+d))}a=l.createConnection(c,d);a.setData(b);null!==q&&q.processOutgoing(b);a.send()}}};this.processReply=
function(a,b,c){l.ctatdebug("processReply ("+e.length+","+a+", ...)");"undefined"==typeof c&&"function"==typeof this.getHTTPObject&&this.getHTTPObject();b=0;a=[];var d;for(d=0;d<e.length;d++){var f=e[d];if(f&&"function"==typeof f.getHTTPObject){var m=f.getHTTPObject();l.ctatdebug("Testing connection entry["+d+"]: readyState & status: "+(m?m.readyState+" & "+m.status:"null")+", consumed: "+f.getConsumed());m&&(4==m.readyState&&!1===f.getConsumed()?(l.ctatdebug("Investigating request response: "+b+
" -> "+m.status+", for: "+f.getURL()),c=!1,0===m.status&&(c=!0,l.ctatdebug("Received message (status 0): ("+m.responseText+"), status: "+m.status),k&&CTATScrim.scrim.errorScrimUp(CTATGlobals.languageManager.filterString(t))),408==m.status&&(c=!0,l.ctatdebug("Received message (status 408): "+m.responseText),k&&CTATScrim.scrim.scrimDown()),502==m.status&&(c=!0,l.ctatdebug("Received message (status 502): "+m.responseText),k&&CTATScrim.scrim.errorScrimUp(CTATGlobals.languageManager.filterString(ERROR_502))),
200==m.status?(c=!0,l.ctatdebug("Processing 200 response ..."),null!==g?(a.push(m.responseText),null!==q&&q.processIncoming(m.responseText)):l.ctatdebug("Error: httphandler is null, can't process response!")):g&&g.processError&&(c=!0,l.ctatdebug("Processing non-200 response, status "+m.status),g.processError(m.status,m.responseText)),!1===c&&l.ctatdebug("Error: status not handled for: "+m.status),l.ctatdebug("Marking connection as consumed ..."),f.setConsumed(!0)):(0===m.readyState&&l.ctatdebug("Received message (status 0, request not initialized)"),
1===m.readyState&&l.ctatdebug("Received message (status 1, server connection established)"),2===m.readyState&&l.ctatdebug("Received message (status 2, request received)"),3===m.readyState&&l.ctatdebug("Received message (status 3, processing request)")),b++)}}l.cleanup();for(b=0;b<a.length;b++)l.ctatdebug("Processing incoming message: "+b),c=a[b],-1!=c.indexOf("status=success")?l.ctatdebug("Info: logging success message received, not propagating to message handler"):g&&g.processMessage&&(l.ctatdebug("Processing incoming message: "+
c),g.processMessage(c))};this.processWSReply=function(a){l.ctatdebug("processWSReply() length "+(null===a?null:a.toString().length));"string"==typeof a&&(null!==q&&q.processIncoming(a),-1!=a.indexOf("status=success")?l.ctatdebug("processWSReply() logging success message received, not propagating to message handler: "+a):(l.ctatdebug("Processing incoming message: "+a),g.processMessage(a)))};this.processWSClose=function(a){l.ctatdebug("processWSClose("+a+")");a instanceof CloseEvent&&l.ctatdebug("CloseEvent: code "+
a.code+", reason "+a.reason+", wasClean "+a.wasClean);CTATLMS.is.Authoring()||CTATLMS.is.ToolsListener()?CTATScrim.scrim.scrimUp(CTATGlobals.languageManager.filterString("AUTHORPLEASECLOSE")):CTATScrim.scrim.handleTSDisconnect()};this.cleanup=function(){l.ctatdebug("cleanup ()");l.ctatdebug("checkEntries() httprequests.length "+e.length);for(var a=0,b=e.length-1;0<=b;b--){var c=e[b];if(c)if(!0===c.getConsumed())l.ctatdebug("checkEntries() removing["+b+"] ID: "+c.getID()),e.splice(b,1),a++;else if("function"==
typeof c.getHTTPObject){var d=c.getHTTPObject();l.ctatdebug("checkEntries() checking["+b+"], readyState: "+(d?d.readyState:"null")+", consumed: "+c.getConsumed())}}l.ctatdebug("Removed "+a+" entries")};this.retrieveProblemFile=function(a,b,c){"function"==typeof CTATScrim&&CTATScrim.scrim&&CTATScrim.scrim.waitScrimUp();var d=/\.([A-z]*)$/.exec(a);d&&d[1]&&"nools"===d[1].toLowerCase()?(console.log("got a nools file:",a),c.processNools(a)):(console.log("got an xml file, maybe:",a),l.retrieveXMLFile(a,
b,c))};this.getFileRequest=function(a,b,c){var d=-1!=(location.href?location.href:a).indexOf("file://")?!0:!1;location.href||l.ctatdebug("We can't check location.href in the current configuration");if(d)c=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+a+" - You are trying to use the file:// protocol, which is not allowed in this browser."),l.ctatdebug("onerror GET for fileName "+c),CTAT.ToolTutor.sendToInterface(c,!0);else return p=a,a=new CTATConnection,a.assignReceiveFunction(function(a,
c,d){"undefined"==typeof d&&(d="function"==typeof this.getHTTPObject&&this.getHTTPObject());l.ctatdebug("onready... GET for xmlFile xmlhttp "+d+", .readyState & .status "+(d?d.readyState+" & "+d.status:""));d&&4!=d.readyState||(d&&200==d.status&&b(d),d&&404==d.status&&(a=(new CTATTutorMessageBuilder).createErrorMessage("Unable to download file","("+p+") not found"),l.ctatdebug("Error loading xmlFile "+p+": "+a),CTAT.ToolTutor.sendToInterface(a,!0)))}),a.assignFailFunction(c),a};this.retrieveXMLFile=
function(a,b,c){l.ctatdebug("retrieveXMLFile ("+a+")");b=this.getFileRequest(a,function(a){a.responseXML?(l.ctatdebug("parsing brd xml using something else"),a=a.responseXML.documentElement):(l.ctatdebug("parsing brd xml using node"),a=(new CTATXML).parseXML(a.responseText));null===a?(a=(new CTATTutorMessageBuilder).createErrorMessage("Error parsing xmlFile "+p),l.ctatdebug("Error parsing xmlFile "+p+": "+a),CTAT.ToolTutor.sendToInterface(a,!0)):c.processXML(a)},function(){var a=(new CTATTutorMessageBuilder).createErrorMessage("",
"Unable to load: "+p+" - Either you are trying to use the  file:// protocol, there is a firewall between the tutor and BRD, or the BRD is on a different domain and permission to retrieve data from that server is denied.");l.ctatdebug("onerror GET for xmlFile "+a);CTAT.ToolTutor.sendToInterface(a,!0);c.processXML(null)});b.setMethod("GET");b.setURL(a);b.setContentType("text/plain");b.send()};this.retrieveJSONFile=function(a,b){l.ctatdebug("retrieveJSONFile ("+a+")");var c=this.getFileRequest(a,function(){4==
c.readyState&&200==c.status&&(l.ctatdebug("Successfully retrieved file: "+a),b(JSON.parse(c.responseText)))},function(){var a=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+p+" - Either you are trying to use the  file:// protocol, there is a firewall between the tutor and BRD, or the BRD is on a different domain and permission to retrieve data from that server is denied.");l.ctatdebug("onerror GET for xmlFile "+a);CTAT.ToolTutor.sendToInterface(a,!0)});c.open("GET",a,!0);c.setRequestHeader("Content-type",
"text/plain");c.send()};this.retrieveFile=function(a,b){l.ctatdebug("retrieveFile ("+a+")");var c=this.getFileRequest(a,function(){4==c.readyState&&200==c.status&&(l.ctatdebug("Successfully retrieved file: "+a),b(c.responseText))},function(){var a=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+p+" - Either you are trying to use the  file:// protocol, there is a firewall between the tutor and BRD, or the BRD is on a different domain and permission to retrieve data from that server is denied.");
l.ctatdebug("onerror GET for xmlFile "+a);CTAT.ToolTutor.sendToInterface(a,!0)});c.open("GET",a,!0);c.setRequestHeader("Content-type","text/plain");c.send()};this.then=function(a,b){return h&&"function"==typeof h.then?h.then(a,b):Promise.resolve("CTATCommLibrary.then() not supported").then(a,b)}};CTATCommLibrary.setAuthenticityToken=function(a){Array.isArray(a)&&(a=0<a.length?a[0]:"");a&&(CTATCommLibrary.authenticityToken=decodeURIComponent(a))};CTATCommLibrary.getAuthenticityToken=function(a){return CTATCommLibrary.authenticityToken};
CTATCommLibrary.addAuthenticityToken=function(a){return CTATCommLibrary.authenticityToken&&(""===a||0>a.search(/authenticity_token=/)&&0<=a.search(/^[?]?[^?&=><]+=?[^&=]*(&[^?&=><]+=?[^&=]*)*$/))?""+a+(a?"&":"")+"authenticity_token="+encodeURIComponent(CTATCommLibrary.authenticityToken):a};CTATCommLibrary.prototype=Object.create(CTATBase.prototype);CTATCommLibrary.prototype.constructor=CTATCommLibrary;
CTATCommLibrary.prototype.editSocketURLForHTTPS=function(a){if(a&&!/[^0-9]127[.]0[.]0[.]1[^0-9]/.test(a)&&"https:"===window.top.location.protocol){ctatdebug("We're embedded in an https window, using wss...");a=a.replace("ws:","wss:");var b=CTATConfiguration.get("remoteSocketSecurePort");b&&(a=a.replace(/(wss:\/\/[^:]{1,}:)\d{1,}/,"$1"+b));ctatdebug("url after replace: "+a)}return a};var CTATArgument=function(){var a="",b="Undefined",c="String",d="text";this.setValue=function(a){b=a};this.getValue=function(){return b};this.setName=function(b){a=b};this.getName=function(){return a};this.setType=function(a){c=a};this.getType=function(){return c};this.setFormat=function(a){d=a};this.getFormat=function(){return d}};CTATArgument.prototype.clone=function(){var a=new CTATArgument;a.setValue(this.getValue());a.setType(this.getType());a.setFormat(this.getFormat());return a};
"undefined"!==typeof module&&(module.exports=CTATArgument);var CTATHTMLManager=function(){var a=null,b="";this.urldecode=function(a){return decodeURIComponent((a+"").replace(/\+/g,"%20"))};this.showEntities=function(){ctatdebug("showEntities ()");for(var b,d=0;d<a.length;d++)b=a[d],ctatdebug(b)};this.initEntities=function(){null==a&&(a=[],a["&amp;"]="*!*",a["&nbsp;"]="\u00a0",a["&iexcl;"]="\u00a1",a["&cent;"]="\u00a2",a["&pound;"]="\u00a3",a["&curren;"]="\u00a4",a["&yen;"]="\u00a5",a["&brvbar;"]="\u00a6",a["&sect;"]="\u00a7",a["&uml;"]="\u00a8",a["&copy;"]=
"\u00a9",a["&reg;"]="\u00ae",a["&deg;"]="\u00b0",a["&plusmn;"]="\u00b1",a["&sup1;"]="\u00b9",a["&sup2;"]="\u00b2",a["&sup3;"]="\u00b3",a["&acute;"]="\u00b4",a["&micro;"]="\u00b5",a["&frac14;"]="\u00bc",a["&frac12;"]="\u00bd",a["&frac34;"]="\u00be",a["&iquest;"]="\u00bf",a["&Agrave;"]="\u00c0",a["&Aacute;"]="\u00c1",a["&Acirc;"]="\u00c2",a["&Atilde;"]="\u00c3",a["&Auml;"]="\u00c4",a["&Aring;"]="\u00c5",a["&AElig;"]="\u00c6",a["&Ccedil;"]="\u00c7",a["&Egrave;"]="\u00c8",a["&Eacute;"]="\u00c9",a["&Ecirc;"]=
"\u00ca",a["&Euml;"]="\u00cb",a["&Igrave;"]="\u00cc",a["&Iacute;"]="\u00cd",a["&Icirc;"]="\u00ce",a["&Iuml;"]="\u00cf",a["&ETH;"]="\u00d0",a["&Ntilde;"]="\u00d1",a["&Ograve;"]="\u00d2",a["&Oacute;"]="\u00d3",a["&Ocirc;"]="\u00d4",a["&Otilde;"]="\u00d5",a["&Ouml;"]="\u00d6",a["&Oslash;"]="\u00d8",a["&Ugrave;"]="\u00d9",a["&Uacute;"]="\u00da",a["&Ucirc;"]="\u00db",a["&Uuml;"]="\u00dc",a["&Yacute;"]="\u00dd",a["&THORN;"]="\u00de",a["&szlig;"]="\u00df",a["&agrave;"]="\u00e0",a["&aacute;"]="\u00e1",a["&acirc;"]=
"\u00e2",a["&atilde;"]="\u00e3",a["&auml;"]="\u00e4",a["&aring;"]="\u00e5",a["&aelig;"]="\u00e6",a["&ccedil;"]="\u00e7",a["&egrave;"]="\u00e8",a["&eacute;"]="\u00e9",a["&ecirc;"]="\u00ea",a["&euml;"]="\u00eb",a["&igrave;"]="\u00ec",a["&iacute;"]="\u00ed",a["&icirc;"]="\u00ee",a["&iuml;"]="\u00ef",a["&eth;"]="\u00f0",a["&ntilde;"]="\u00f1",a["&ograve;"]="\u00f2",a["&oacute;"]="\u00f3",a["&ocirc;"]="\u00f4",a["&otilde;"]="\u00f5",a["&ouml;"]="\u00f6",a["&oslash;"]="\u00f8",a["&ugrave;"]="\u00f9",a["&uacute;"]=
"\u00fa",a["&ucirc;"]="\u00fb",a["&uuml;"]="\u00fc",a["&yacute;"]="\u00fd",a["&thorn;"]="\u00fe",a["&yuml;"]="\u00ff",a["&gt;"]=">",a["&lt;"]="<",a["&#61;"]="=",a["&361;"]="=",a["&quot;"]='"');ctatdebug("(singleQuoteEscape==true) Replacing &apos; with: \\'");a["&apos;"]="\\'"};this.entitiesConvert=function(a){ctatdebug("entitiesConvert ()");return this.urldecode(unescape(a))};this.entitiesGenerate=function(a){return b=a};this.htmlEncode=function(a){return a};this.htmlDecode=function(a){return"undefined"!==
typeof $?$("<div/>").html(a).text():"undefined"!==typeof Entities?(new Entities).decode(a):a}};"undefined"!==typeof module&&(module.exports=CTATHTMLManager);var CTATStringUtil=function(){this.String2Boolean=function(a){switch(a){case "0":case "false":case "no":case "FALSE":case "NO":case "No":return!1}return!0};this.replaceString=function(a,b,c){return a.replace(b,c)}};"undefined"!==typeof module&&(module.exports=CTATStringUtil);var CTATSAI=function(a,b,c,d){CTATBase.call(this,"CTATSAI","sai");var e=new CTATStringUtil,h="undefined",g=[],k=[],n=[],q=[],l=null,f=this,l="xml"==CTATConfig.parserType?new CTATXML:new CTATJSON;this.getArguments=function(){return n};this.getArgument=function(a){if(0==n.length){var b=new CTATArgument;n.push(b)}return n[a]};this.getArgumentsTyped=function(){f.ctatdebug("getArgumentsTyped");var a,b=[];for(a=0;a<n.length;a++){var c=n[a];"Boolean"===c.getType()?(f.ctatdebug("Adding Boolean argument ("+
c.getValue()+") ..."),b.push(e.String2Boolean(c.getValue()))):"Number"===c.getType()?(f.ctatdebug("Adding Number argument ("+c.getValue()+") ..."),b.push(Number(c.getValue()))):"String"===c.getType()?"No_Value"===c.getValue()?(f.ctatdebug("Detected default argument ("+c.getValue()+"), setting contents to null instead"),b.push(null)):b.push(String(c.getValue())):f.ctatdebug("Unrecognized argument type: "+c.getType()+" in "+f.toSerializedString()+" IGNORING IT!!!")}f.ctatdebug("Resulting arguments: "+
b);return b};this.addSelection=function(a,b){var c=new CTATArgument;c.setValue(a);void 0!=b&&null!=b&&c.setType(b);g.push(c)};this.addAction=function(a){k.push(a)};this.checkDefaultArgument=function(){f.ctatdebug("checkDefaultArgument ()");if(0===n.length){f.ctatdebug("Adding default argument ...");var a=new CTATArgument;n.push(a)}};this.setArgument=function(a,b){f.checkDefaultArgument();for(var c=n.length;c<=a;++c)n.push(new CTATArgument);a=n[a];a.setValue(b);return a};this.addArgument=function(a,
b,c){this.ctatdebug("addArgument ("+a+","+b+","+c+")");var d=new CTATArgument;d.setValue(a);d.setType(b);d.setFormat(c);n.push(d);return d};this.addExistingArgument=function(a){n.push(a);return a};this.setSAI=function(a,b,c,d,e){f.setSelection(Array.isArray(a)?0<a.length?a[0]:"":a);f.setAction(Array.isArray(b)?0<b.length?b[0]:"":b);f.setInput(Array.isArray(c)?0<c.length?c[0]:"":c);f.setType(d);h=e};this.setInput=function(a){f.ctatdebug("setInput("+a+")");f.checkDefaultArgument();f.getArgument(0).setValue(a)};
this.getInputObject=function(){return 0===n.length?null:n[0]};this.getInput=function(){return 0===n.length?"":f.getArgument(0).getValue()};this.setType=function(a){f.checkDefaultArgument();f.getArgument(0).type=a};this.getType=function(){return 0===n.length?"":f.getArgument(0).type};this.setFormat=function(a){f.checkDefaultArgument();f.getArgument(0).setFormat(a)};this.getFormat=function(){return 0===n.length?"":f.getArgument(0).getFormat()};this.toString=function(){return"["+String(f.getSelection())+
","+String(f.getAction())+","+String(f.getInput())+"]"};this.setSelection=function(a,b){var c=f.getSelectionObject();null==c?(c=new CTATArgument,c.setValue(a),void 0!=b&&null!=b&&c.setType(b),g.push(c)):c.setValue(a)};this.getSelectionObject=function(){return 0==g.length?null:g[0]};this.getSelection=function(){if(0==g.length)return null;var a=g[0];return"object"===typeof a?a.getValue():a};this.setAction=function(a){0<k.length?k[0]=a:k.push(a)};this.getAction=function(){return 0==k.length?null:k[0]};
this.appendToSelectionArray=function(a,b){var c=new CTATArgument;c.setValue(String(a));void 0!=b&&null!=b&&c.setType(b);g.push(c)};this.setSelectionArray=function(a){g=[];for(var b=0;b<a.length;b++)f.appendToSelectionArray(a[b],"String")};this.getSelectionArray=function(){for(var a=[],b=0;b<g.length;b++){var c=g[b];"object"===typeof c?a.push(g[b].getValue()):a.push(c)}return a};this.appendToActionArray=function(a){null==a?k.push(""):k.push(String(a))};this.setActionArray=function(a){k=null==a?[]:
Array.isArray(a)?a.slice():[String(a)]};this.getActionArray=function(){return k};this.appendToInputArray=function(a){f.ctatdebug("appendToInputArray ("+a+")");null==a?f.addArgument("","String","text"):f.addArgument(a,"String","text")};this.setInputArray=function(a){n=[];if(null!=a)for(var b=0;b<a.length;b++)f.appendToInputArray(a[b])};this.getInputArray=function(){f.ctatdebug("getInputArray ("+n.length+")");q=[];for(var a=0;a<n.length;a++){var b=n[a];"object"===typeof b?(f.ctatdebug("Adding object value ("+
b.getValue()+") to temp input array"),q.push(b.getValue())):(f.ctatdebug("Adding string value ("+b+") to temp input array"),q.push(b))}return q};this.setPrompt=function(a){h=a};this.getPrompt=function(){return h};this.propagate=function(a){f.ctatdebug("propagate ()");a=a.getArguments();for(var b=0;b<a.length;b++){var c=a[b],d=n[b];if(null===c||null===d){f.ctatdebug("Internal error: argument lists do not align between received SAI and source SAI");break}d.setValue(c.getValue())}};this.fromString=function(a){a=
l.parse(a);f.fromXML(a)};this.fromXML=function(a){f.ctatdebug("fromXML ()");n=[];a=l.getElementChildren(a);for(var b,c=0;c<a.length;c++){var d=a[c];if("selection"==l.getElementName(d)||"Selection"==l.getElementName(d)){for(var e=l.getElementChildren(d),g=!1,h=0;h<e.length;h++)b=e[h],"value"==l.getElementName(b)&&(b=l.getNodeTextValue(b),1>h?f.setSelectionArray(b):f.appendToSelectionArray(b),g=!0,f.setSelection(b));!1===g&&(b=l.getNodeTextValue(d),f.setSelectionArray(b),f.setSelection(b))}if("action"==
l.getElementName(d)||"Action"==l.getElementName(d)){e=l.getElementChildren(d);g=!1;for(h=0;h<e.length;h++)b=e[h],"value"==l.getElementName(b)&&(b=l.getNodeTextValue(b),1>h?f.setActionArray(b):f.appendToActionArray(b),g=!0,f.setAction(b));!1===g&&(b=l.getNodeTextValue(d),f.setActionArray(b),f.setAction(b))}if("inputArray"==l.getElementName(d)||"value"==l.getElementName(d)||"Input"==l.getElementName(d)){b=l.getElementChildren(d);var k;n=[];e=new CTATHTMLManager;g=new CTATArgument;h=0;n.push(g);for(var t=
0;t<b.length;t++){var p=b[t];"value"==l.getElementName(p)&&(k=l.getElementChildren(p),null!==k?(f.ctatdebug("Parsing SAI input ..."),f.ctatdebug("Childnodes: "+k.length),1===k.length?(k=e.htmlDecode(l.getNodeTextValue(p)),f.ctatdebug("Setting new value to: "+k),g.setValue(k)):(k=e.htmlDecode(l.getNodeTextValue(p)),f.ctatdebug("Setting new value to: "+k),g.setValue(k),g.setName(p.attributes.getNamedItem("name").value),g.setType(p.attributes.getNamedItem("type").value),g.setFormat(p.attributes.getNamedItem("format").value),
h++),1>t?f.setInputArray(k):f.appendToInputArray(k)):(p=e.htmlDecode(l.getNodeTextValue(p)),f.ctatdebug("Setting new value to: "+p),g.setValue(p),1>t?f.setInputArray(p):f.appendToInputArray(p)))}}if("prompt"==l.getElementName(d)||"Prompt"==l.getElementName(d))f.ctatdebug("Parsing prompt ..."),f.setPrompt(l.getNodeTextValue(d))}f.checkDefaultArgument()};this.appendFromElement=function w(a,b,c,d,e){f.ctatdebug("appendFromElement ()");d=String(l.getElementName(b)).toLowerCase();if(d==a||"value"==d)if(d=
l.getElementChildren(b),!Array.isArray(d)||1>d.length)0==e?c.push(l.getNodeTextValue(b)):f.appendToInputArray(l.getNodeTextValue(b));else for(b=0;b<d.length;++b)w(a,d[b],c,b,e)};this.setArrayFromElements=function(a){f.ctatdebug("setArrayFromElements ()");if(!a||!Array.isArray(a)||1>a.length)f.ctatdebug("can't get name: don't know whether selection, action or input");else{var b,c=String(l.getElementName(a[0])).toLowerCase();switch(c){case "selection":f.ctatdebug("Processing selection field ...");g=
[];for(b=0;b<a.length;++b)f.appendFromElement(c,a[b],g,b,!1);break;case "action":f.ctatdebug("Processing action field ...");k=[];for(b=0;b<a.length;++b)f.appendFromElement(c,a[b],k,b,!1);break;case "input":f.ctatdebug("Processing input field ...");n=[];for(b=0;b<a.length;++b)f.appendFromElement(c,a[b],n,b,!0);break;default:console.log('CTATSAI.setArrayFromElements(): unexpected element name "'+c+'"');return}f.ctatdebug("CTATSAI.setArrayFromElements() eltName "+c+", length "+b+", selectionArray "+
f.getSelectionArray()+", actionArray "+f.getActionArray()+", inputArray "+f.getInputArray())}};this.fromXMLInternal=function(a){f.ctatdebug("fromXMLInternal ()");new CTATXML;n=[];a=l.getElementChildren(a);for(var b,c=0;c<a.length;c++){var d=a[c];if("selection"==l.getElementName(d)||"Selection"==l.getElementName(d)){for(var e=l.getElementChildren(d),g=!1,h=0;h<e.length;h++)b=e[h],"value"==l.getElementName(b)&&(b=l.getNodeTextValue(b),1>h?f.setSelectionArray(b):f.appendToSelectionArray(b),g=!0,f.setSelection(b));
!1===g&&(b=l.getNodeTextValue(d),f.setSelectionArray(b),f.setSelection(b))}if("action"==l.getElementName(d)||"Action"==l.getElementName(d)){e=d.childNodes;g=!1;for(h=0;h<e.length;h++)b=e[h],"value"==l.getElementName(b)&&(b=l.getNodeTextValue(b),1>h?f.setActionArray(b):f.appendToActionArray(b),g=!0,f.setAction(b));!1===g&&(b=l.getNodeTextValue(d),f.setActionArray(b),f.setAction(b))}if("inputArray"==l.getElementName(d)||"Input"==l.getElementName(d)){b=d.childNodes;n=[];var e=new CTATHTMLManager,g=new CTATArgument,
h=0,k;n.push(g);for(var t=0;t<b.length;t++)if(k=b[t],"value"==l.getElementName(k)){var q=l.getElementChildren(k);null!==q?(f.ctatdebug("Parsing SAI input ..."),f.ctatdebug("Childnodes: "+q.length),1===q.length?(k=e.htmlDecode(l.getNodeTextValue(k)),f.ctatdebug("Setting new value to: "+k),g.setValue(k)):(k=e.htmlDecode(l.getNodeTextValue(k)),f.ctatdebug("Setting new value to: "+k),g.setValue(k),g.setName(l.getElementAttr("name")),g.setType(l.getElementAttr("type")),g.setFormat(l.getElementAttr("format")),
h++)):(k=e.htmlDecode(l.getNodeTextValue(k)),f.ctatdebug("Setting new value to: "+k),g.setValue(k));1>t?f.setInputArray(k):f.appendToInputArray(k)}}if("prompt"==l.getElementName(d)||"Prompt"==l.getElementName(d))f.ctatdebug("Parsing prompt ..."),f.setPrompt(l.getNodeTextValue(d))}f.checkDefaultArgument()};this.toXMLString=function(a){f.ctatdebug("toXMLString ()");return a?f.toLSxmlString():f.toTSxmlString()};this.toLSxmlString=function(){f.ctatdebug("toLSxmlString ()");for(var a="",b=0;b<g.length;b++){var c=
g[b];"object"===typeof c?(a="String"!=c.getType()?a+('<selection type="'+c.getType()+'">'):a+"<selection>",a+=c.getValue()+"</selection>"):a+="<selection>"+c+"</selection>"}a+="<action>"+f.getAction();for(b=1;b<k.length;b++)a+="</action><action>"+k[b];a+="</action>";for(b=0;b<n.length;b++)c=n[b],a="object"===typeof c?"String"!=c.getType()?a+('<input type="'+c.getType()+'"><![CDATA['+c.getValue()+"]]\x3e</input>"):a+("<input><![CDATA["+c.getValue()+"]]\x3e</input>"):a+("<input><![CDATA["+c+"]]\x3e</input>");
return a};this.toTSxmlString=function(){f.ctatdebug("toTSxmlString ()");var a;a="<Selection><value>"+f.getSelection();for(var b=1;b<g.length;b++){var c=g[b];a="object"===typeof c?a+("</value><value>"+c.getValue()):a+("</value><value>"+c)}a+="</value></Selection><Action><value>"+f.getAction();for(b=1;b<k.length;b++)a+="</value><value>"+k[b];a+="</value></Action><Input>";if(1<n.length)for(b=0;b<n.length;b++)c=n[b],a+='<value fmt="text" name="'+c.getName()+'" type="'+c.getType()+'"><![CDATA['+c.getValue()+
"]]\x3e</value>";else a+="<value><![CDATA["+f.getInput()+"]]\x3e</value>";return a+"</Input>"};this.toSerializedString=function(){var a;a=""+("<selection>"+f.getSelection()+"</selection><action>"+f.getAction()+"</action><inputArray>");for(var b=0;b<n.length;b++){var c=n[b];a+='<value fmt="text" name="'+c.getName()+'" type="'+c.getType()+'">'+c.getValue()+"</value>"}return a+"</inputArray>"};this.clone=function(){f.ctatdebug("clone ()");for(var a=new CTATSAI(f.getSelection(),f.getAction(),f.getInput(),
f.getPrompt()),b=0;b<f.getArguments().length;++b)a.setArgument(b,f.getArgument(b).clone());a.setSelectionArray(f.getSelectionArray().slice());a.setActionArray(f.getActionArray().slice());a.setInputArray(f.getInputArray().slice());f.ctatdebug("CTATSAI.clone() this "+f+", clone "+a+", clone inputArray "+a.getInputArray());return a};this.isDone=function(){var a=f.getSelection(),b=f.getAction();return null==a||null==b?!1:"done"==a.toString().toLowerCase()&&"buttonpressed"==b.toString().toLowerCase()};
var t=!1;if(Array.isArray(a)&&Array.isArray(b)&&(Array.isArray(c)||null==c)&&(f.setSelectionArray(a),f.setActionArray(b),f.setInputArray(c),t=!0,0<a.length&&0<b.length)){f.setSAI(a[0],b[0],null==c?null:c[0],"String",d);return}null!==a&&""!==a&&f.setSelection(a);null!==a&&(f.setSAI(a,b,c,"String",d),t||(f.setSelectionArray(Array.isArray(a)?a:[a]),f.setActionArray(Array.isArray(b)?b:[b]),f.setInputArray(Array.isArray(c)?c:[c]),t=!0))};CTATSAI.prototype=Object.create(CTATBase.prototype);
CTATSAI.prototype.constructor=CTATSAI;CTATSAI.delayedActionRegExp=/^([^:]+):([0-9]+)$/;"undefined"!==typeof module&&(module.exports=CTATSAI);var CTATSkill=function(){CTATBase.call(this,"CTATSkill","skill");var a="",b="",c="",d="",e=0,h="",g=!1,k="",n="",q="",l="",f=0,t=0;this.setSkillName=function(b){a=b};this.setDisplayName=function(a){b=a};this.setModelName=function(a){d=a};this.setCategory=function(a){c=a};this.setLevel=function(a){!0===isNaN(a)?ctatdebug("Error: attempting to set a level to NaN"):(e=a,this.setPKnown(String(e)))};this.setDescription=function(a){h=a};this.getSkillName=function(){return a};this.getDisplayName=function(){return b};
this.hasDisplayName=function(){return""!==b&&null!==b};this.getModelName=function(){return d};this.hasCategory=function(){return""!==c};this.hasModelName=function(){return""!==d};this.getCategory=function(){return c};this.getLevel=function(){return e};this.getDescription=function(){return h};this.setTouched=function(a){g=a};this.getTouched=function(){return g};this.toXMLString=function(){return""};this.toSetPreferencesXMLString=function(){var d='<skill label="'+b+'" pSlip="'+n+'" description="'+h;
return d+='" pKnown="'+q+'" category="'+c+'" pLearn="'+l+'" name="'+a+'" pGuess="'+k+'" history="'+f+'" opportunityCount="'+t+'" />'};this.setPGuess=function(a){k=a};this.getPGuess=function(){return k};this.setPSlip=function(a){n=a};this.getPSlip=function(){return n};this.setPLearn=function(a){l=a};this.getPLearn=function(){return l};this.setPKnown=function(a){q=a};this.getPKnown=function(){return q};this.setSkillHistory=function(a){f=Number(a)||0};this.getSkillHistory=function(){return f};this.setSkillOpportunityCount=
function(a){t=Number(a)||0};this.getSkillOpportunityCount=function(){return t}};CTATSkill.prototype=Object.create(CTATBase.prototype);CTATSkill.prototype.constructor=CTATSkill;var CTATSkillSet=function(){CTATBase.call(this,"CTATSkillSet","skills");this.internalSkillSet=[];var a=this;this.fromXMLString=function(a,c){this.ctatdebug("fromXMLString ()");this.ctatdebug("Skills string: "+a);null===a?this.ctatdebug("Warning: skill object is null"):""===a?this.ctatdebug("Info: empty skill string provided, bump"):a?(this.ctatdebug("CTATSkillSet.fromXMLString() Raw:     "+a),a=c?a:decodeURIComponent(a.replace(/\+/g," ")),this.ctatdebug("CTATSkillSet.fromXMLString() Decoded: "+a),
null!==/\/<value>.+<\/value>/.exec(a)?this.parseByValue(a):(c=(new CTATXML).parseXML(a),this.parseByAttributes(c,a)),this.ctatdebug("fromXMLString () done")):this.ctatdebug("Warning: skill object is undefined or otherwise empty.")};this.fromXMLData=function(a,c){this.ctatdebug("fromXMLData ()");null!==/\/<value>.+<\/value>/.exec(c)?this.parseByValue(c):this.parseByAttributes(a);this.ctatdebug("fromXMLData () done")};this.parseByValue=function(b){this.ctatdebug("parseByValue()");if(b){b=b.childNodes;
for(var c=new CTATXML,d=0;d<b.length;d++){var e=c.getNodeTextValue(b[d]).split("`"),h=e[0].split(" ");4==e.length?this.addSkill(h[0],e[1],e[2],e[3],e[3],h[1]):this.addSkill(h[0],e[1],e[2],e[3],e[4],h[1])}}else a.ctatdebug("Error: aSkills is null")};this.parseDOM=function(a){this.ctatdebug("parseDOM()");var b=new CTATXML;a=b.getElementChildren(a);for(var d=0;d<a.length;d++){var e=b.getNodeTextValue(a[d]).split("`"),h=e[0].split(" ");4==e.length?this.addSkill(h[0],e[1],e[2],e[3],e[3],h[1]):this.addSkill(h[0],
e[1],e[2],e[3],e[4],h[1])}};this.parseByAttributes=function(b){this.ctatdebug("parseByAttributes()");if(b)if(b=b.childNodes)for(var c=0;c<b.length;c++){var d=b[c];if("Skill"==d.nodeName||"skill"==d.nodeName){this.ctatdebug("Parsing node ("+c+"): "+d.nodeName+" -> "+d.nodeValue);var e=d.attributes.getNamedItem("name");if(e=e?e.value:""){var h=d.attributes.getNamedItem("pKnown"),h=h?h.value:"",g=d.attributes.getNamedItem("description"),g=g?g.value:"",k=d.attributes.getNamedItem("label"),k=k?k.value:
"",n=d.attributes.getNamedItem("category"),n=n?n.value:"",q=d.attributes.getNamedItem("pGuess"),q=q?q.value:"",l=d.attributes.getNamedItem("pLearn"),l=l?l.value:"",f=d.attributes.getNamedItem("pSlip"),f=f?f.value:"",t=d.attributes.getNamedItem("history"),t=t?t.value:"",d=(d=d.attributes.getNamedItem("opportunityCount"))?d.value:"";this.addSkill(e,h,.95,g,k,n,q,l,f,t,d)}}}else this.ctatdebug("Error: list of skill xml elements is null");else a.ctatdebug("Error: aSkills is null")};this.getSkillSet=function(){return this.internalSkillSet};
this.getSize=function(){return this.internalSkillSet.length};this.addSkill=function(a,c,d,e,h,g,k,n,q,l,f){this.ctatdebug("addSkill() name = "+a+" level = "+c+" mastery = "+d+" aDescription = "+e+" adisplayName = "+h+" aCategory = "+g+" pguess= "+k+" plearn = "+n+" pslip = "+q+" history = "+l+" oppCt = "+f);a=this.setSkillLevel(a,c,d);this.ctatdebug("Configuring "+a.getDisplayName());e&&a.setDescription(e);h&&a.setDisplayName(h);g&&a.setCategory(g);(k||0===k)&&a.setPGuess(k);(n||0===n)&&a.setPLearn(n);
(q||0===q)&&a.setPSlip(q);a.setSkillHistory(l);a.setSkillOpportunityCount(f);return a};this.addSkillAsObject=function(a){this.addSkill(a.name,a.level,a.mastery,a.description,a.label,a.category,a.pGuess,a.pLearn,a.pSlip,"","")};this.setSkillLevel=function(a,c,d){this.ctatdebug("setSkillLevel ("+a+","+c+","+d+")");d=this.getSkill(a);null===d?(this.ctatdebug("Skill not found, creating new one ..."),d=new CTATSkill,d.setSkillName(a),d.setLevel(c),this.internalSkillSet.push(d)):(this.ctatdebug("Skill found, adjusting ..."),
d.setLevel(1),d.setLevel(c));d.setTouched(!0);return d};this.getSkill=function(a){this.ctatdebug("getSkill ("+a+") -> "+this.internalSkillSet.length);if(!a)return null;for(var b=0;b<this.internalSkillSet.length;b++){var d=this.internalSkillSet[b];if(d.getSkillName()==a)return this.ctatdebug("Returning: "+b),d}return null};this.getSkillLevel=function(a){if(!a)return-1;for(var b in this.internalSkillSet)if(b.getSkillName()==a)return b.getLevel();return-1};this.getTouched=function(){this.ctatdebug("getTouched ()");
for(var a=[],c=0;c<this.internalSkillSet.length;c++){var d=this.internalSkillSet[c];!0===d.getTouched()&&(this.ctatdebug("Adding touched skill: "+d.getSkillName()),a.push(d))}return a};this.untouchSkills=function(){this.ctatdebug("untouchSkills ()");for(var a=0;a<this.internalSkillSet.length;a++)this.internalSkillSet[a].setTouched(!1)};this.toSetPreferencesXMLString=function(){this.ctatdebug("toSetPreferencesXMLString ()");for(var a="<skills>",c=0;c<this.internalSkillSet.length;c++)a+=this.internalSkillSet[c].toSetPreferencesXMLString();
return a+"</skills>"};this.toLogString=function(){this.ctatdebug("toLogString ("+this.internalSkillSet.length+")");for(var a="",c=0;c<this.internalSkillSet.length;c++){var d=this.internalSkillSet[c],a=a+('<skill probability="'+d.getLevel()+'"><name>'+d.getSkillName()+"</name>");d.hasCategory()&&(a+="<category>"+d.getCategory()+"</category>");d.hasModelName()&&(a+="<model_name>"+d.getModelName()+"</model_name>");a+="</skill>"}return a}};CTATSkillSet.prototype=Object.create(CTATBase.prototype);
CTATSkillSet.prototype.constructor=CTATSkillSet;CTATSkillSet.skills=null;"undefined"!==typeof module&&(module.exports=CTATSkillSet);function CTATJSONObject(a,b){this.name=a||"";this.value=b||null}
var transformArray=[],CTATJSON=function(){CTATBase.call(this,"CTATJSON","json");var a=null,b=0;this.isJSONObject=function(a){return a.ctat?!0:!1};this.parse=function(a){return this.parseJSON(a)};this.parseJSON=function(b){this.ctatdebug("parseJSON ()");a=null;if("string"==typeof b){this.ctatdebug("Parsing JSON as a string ... ");try{a=JSON.parse(b)}catch(e){return this.ctatdebug("Error parsing JSON message: "+e.message),a=null}this.ctatdebug("Successfully parsed JSON string")}this.ctatdebug("JSON string has already been parsed, assigning as an object ...");for(var c in a)return this.ctatdebug("Creating internal JSON object with name: "+
c),b=new CTATJSONObject,b.name=c,b.value=a[c],b;return null};this.getElementName=function(a){return"object"!=typeof a?(this.ctatdebug("Internal error, the provided element is not of type CTATJSONObject, instead we found: "+typeof a),null):a.name};this.getElementValue=function(a){return null==a?(this.ctatdebug("Error: anElement is null"),null):"object"!=typeof a?(this.ctatdebug("Internal error, the provided element is not of type CTATJSONObject, instead we found: "+typeof a),null):a.value};this.getElementChildren=
function(a){if(null==a)return this.ctatdebug("Error: anElement is null"),null;if("object"!=typeof a)return this.ctatdebug("Internal error, the provided element is not of type CTATJSONObject, instead we found: "+typeof a),null;var b=a.value,c=[],h;for(h in b){var g=b[h];if("string"==typeof g)a=new CTATJSONObject,a.name=h,a.value=g,c.push(a);else if(null==g[0]||void 0==g[0])a=new CTATJSONObject,a.name=h,a.value=g,c.push(a);else for(var k in g)a=new CTATJSONObject,a.name=h,a.value=g[k],c.push(a)}return c};
this.getNodeTextValue=function(a){if("string"!=typeof a.value){var b=null;for(b in a.value)if("content"==b)return a.value[b].toString();for(b in a.value)if("value"==b)return a.value[b].toString()}return a.value};this.getElementAttr=function(a,b){a=a.value;for(var c in a)if(c==b)return a[c];return null};this.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)};this.walkDOM=function(a){this.ctatdebug("walkDOM () >>>>>>>>>>>>>>>>>>");b=0;this.walk(a);this.ctatdebug("walkDOM () <<<<<<<<<<<<<<<<<<")};
this.walk=function(a){b++;if(!(5<b)){var c=0,e;for(e in a){var h=a[e];this.ctatdebug("("+c+") typeof (key): "+typeof e+" -> typeof(value): "+typeof h+"("+h.length+")");"string"!=typeof h?(this.ctatdebug("walk ("+e+")"),this.walk(h)):this.ctatdebug("walk ("+e+") : "+h);c++}}};this.stringify=function(a){return this.toJSONString(a)};this.toJSONString=function(a){return JSON.stringify(a,null,2)};this.syntaxHighlight=function(a){"string"!=typeof a&&(a=JSON.stringify(a,void 0,2));a=a.replace(/&/g,"&amp;").replace(/</g,
"&lt;").replace(/>/g,"&gt;");return a.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(a){var b="number";/^"/.test(a)?b=/:$/.test(a)?"key":"string":/true|false/.test(a)?b="boolean":/null/.test(a)&&(b="null");return'<span class="'+b+'">'+a+"</span>"})}};CTATJSON.prototype=Object.create(CTATBase.prototype);CTATJSON.prototype.constructor=CTATJSON;"undefined"!==typeof module&&(module.exports=CTATJSON);var CTATMessage=function(a){function b(a){var b=[],c=g.getElementChildren(a);this.ctatdebug("CTATMessage.parseCustomFields("+g.stringify(a)+"): valueElts.length "+c.length);for(a=0;a<c.length;++a){var d=c[a];"value"!=g.getElementName(d)?console.log("CTATMessage.parseRules(): unexpected element name "+g.getElementName(d)+" at custom_fields["+a+"]"):(d=g.getNodeTextValue(d))&&b.push(d)}return b}function c(a){var b={},c=g.getElementChildren(a);this.ctatdebug("CTATMessage.parseCustomFields("+g.stringify(a)+
"): cfElts.length "+c.length);for(a=0;a<c.length;++a){var d=c[a];if("custom_field"==g.getElementName(d)){for(var f=null,e=null,d=g.getElementChildren(d),h=0,k=0;h<d.length&&2>k;++h){var l=d[h];switch(g.getElementName(l)){case "name":f=g.getNodeTextValue(l);k++;break;case "value":e=g.getNodeTextValue(l),k++}}f&&(b[f]=e?e:"",this.ctatdebug("CTATMessage.parseCustomFields(): result["+f+"]="+b[f]+";"))}}return b}CTATBase.call(this,"CTATMessage","message");CTATMessage.makeTransactionId=function(){return CTATGuid.guid()};
var d=a,e=null,h=null,g=null;void 0==a&&(d=null);g="xml"==CTATConfig.parserType?new CTATXML:new CTATJSON;d&&(this.ctatdebug("messageParser "+g+", messageObj "+d),d.children&&this.ctatdebug(d.children));var k="ungraded",n=!1,q=!1,l=new CTATSkillSet,f="",t="",p="",w="",m="",r=!0,z,v=null,B=null,G=null,E=!1;this.setURL=function(a){z=a};this.getURL=function(){return z};this.assignSAI=function(a){q=!0;v=a};this.setTransactionID=function(a){t=a};this.getTransactionID=function(){return t};this.setGradeResult=
function(a){k=a};this.getGradeResult=function(){return k};this.getXMLObject=function(){return d};this.getSkillsObject=function(){return l};this.getCustomFields=function(){return B};this.getRules=function(){return G};this.getSuccessMessage=function(){return p};this.getBuggyMsg=function(){return w};this.getHighlightMsg=function(){return m};this.parse=function(){this.ctatdebug("parse ()");if(null!==d){this.ctatdebug("messageParser: "+g);this.ctatdebug("Root name: "+g.getElementName(d));"tool_message"==
g.getElementName(d)?(this.ctatdebug("Detected tool message"),f="tool_message"):"message"!=g.getElementName(d)?(this.ctatdebug("Detected log message"),n=!0,f=g.getElementName(d)):(this.ctatdebug("Detected regular message"),n=!1,this.parseMessageType());this.parseTransactionID();this.parseSAI();for(var a=g.getElementChildren(d),b=0;b<a.length;b++){var c=a[b];"properties"==g.getElementName(c)&&(ctatdebug("Found a 'properties' element ... "),e=c,h=g.getElementChildren(c))}this.ctatdebug("Message "+f+
", with transaction id: "+t)}};this.parseSAI=function(){this.ctatdebug("parseSAI ()");var a="",e="",h="",k="",t=[],r=[],E=[];if("tool_message"==f){this.ctatdebug("Parsing s, a and i");a=g.getElementChildren(d);for(e=0;e<a.length;e++)if(h=a[e],"tool_message"==g.getElementName(h))for(h=g.getElementChildren(h),k=0;k<h.length;k++)t=h[k],"event_descriptor"==g.getElementName(t)&&(v=new CTATSAI,v.fromXMLInternal(t));q=!0}else{if(n){this.ctatdebug("isLogMessage ...");for(var F=g.getElementChildren(d),C=0;C<
F.length;C++){var A=F[C];if("event_descriptor"==g.getElementName(A))for(var A=g.getElementChildren(A),D=0;D<A.length;D++){var u=A[D];"selection"==g.getElementName(u)&&(a=g.getNodeTextValue(u),t.push(u));"action"==g.getElementName(u)&&(e=g.getNodeTextValue(u),r.push(u));"input"==g.getElementName(u)&&(h=g.getNodeTextValue(u),E.push(u));"prompt"==g.getElementName(u)&&(k=g.getNodeTextValue(u))}}}else for(this.ctatdebug("!isLogMessage ..."),F=g.getElementChildren(d),C=0;C<F.length;C++)if(A=F[C],"properties"==
g.getElementName(A))for(A=g.getElementChildren(A),D=0;D<A.length;D++){var u=A[D],H=g.getElementName(u);this.ctatdebug("Nodename: "+H);switch(H){case "URL":z=g.getNodeTextValue(u);break;case "Skills":l.parseByValue(u);break;case "SuccessMsg":p=g.getValueNodesAsText(u);a=p[0];break;case "BuggyMsg":w=g.getValueNodesAsText(u);break;case "Selection":a=g.getNodeTextValue(u);t.push(u);break;case "Action":e=g.getNodeTextValue(u);r.push(u);break;case "Input":h=g.getNodeTextValue(u);E.push(u);break;case "prompt":k=
g.getNodeTextValue(u);break;case "HighlightMsgText":m=g.getNodeTextValue(u);break;case "custom_fields":B=c(u);break;case "Rules":G=b(u)}}this.ctatdebug("SAI: "+a+","+e+","+h);""!==a&&null!==a?(v=new CTATSAI(a,e,h,k),v.setArrayFromElements(t),v.setArrayFromElements(r),v.setArrayFromElements(E),q=!0):(this.ctatdebug("No SAI found"),q=!1);this.ctatdebug("parseSAI () done, hassai: "+q+", ("+a+","+e+","+h+","+k+")")}};this.parseTransactionID=function(){this.ctatdebug("parseTransactionID()");if("tool_message"!=
f){if(!n)for(var a=g.getElementChildren(d),b=0;b<a.length;b++){var c=a[b];if("properties"==g.getElementName(c))for(var c=g.getElementChildren(c),e=0;e<c.length;e++){var h=c[e];"transaction_id"==g.getElementName(h)&&(t=g.getNodeTextValue(h))}}this.ctatdebug("parseTransactionID() done, id: "+t)}};this.parseMessageType=function(){this.ctatdebug("parseMessageType()");for(var a=g.getElementChildren(d),b=0;b<a.length;b++){var c=a[b];if("properties"==g.getElementName(c))for(var c=g.getElementChildren(c),
e=0;e<c.length;e++){var h=c[e];"MessageType"==g.getElementName(h)&&(f=g.getNodeTextValue(h))}}this.ctatdebug("parseMessageType() -> "+f)};this.getMessageType=function(){return f};this.getTransactionID=function(){return t};this.getSAI=function(){return q?v:new CTATSAI};this.getSelection=function(){return q?v.getSelection():""};this.getAction=function(){return q?v.getAction():""};this.getInput=function(){return q?v.getInput():""};this.getSelectionArray=function(){return q?v.getSelectionArray():[]};
this.getActionArray=function(){return q?v.getActionArray():[]};this.getInputArray=function(){return q?v.getInputArray():[]};this.getXML=function(){return d};this.getXMLString=function(a){if(d.xml)return d.xml;if(XMLSerializer)return(new XMLSerializer).serializeToString(d);alert("ERROR: Extremely old browser");return""};this.getIndicator=function(){return"AssociatedRules"!=f?"":this.getProperty("Indicator")};this.getIndicatorSub=function(){return"AssociatedRules"!=f?"":this.getProperty("IndicatorSub")};
this.setProperty=function(a,b){this.ctatdebug("setProperty ("+a+","+b+")");if(null!==h){for(var c=0;c<h.length;c++){var d=h[c];if(g.getElementName(d)==a)return g.setNodeTextValue(d,b)}a=g.addElement(e,a,b);h.push(a);return b}this.ctatdebug("Internal error: no messageProperties object available");return null};this.getProperty=function(a){if(!n)if(null!==h)for(var b=0;b<h.length;b++){var c=h[b];if(g.getElementName(c)==a)return g.getNodeTextValue(c)}else this.ctatdebug("Internal error: no messageProperties object available");
return""};this.hasProperty=function(a){a=this.getProperty(a);return!n&&""!==a};this.hasSAI=function(){return q};this.isEndOfTransaction=function(){return"true"==this.getProperty("end_of_transaction")?!0:!1};this.isLogMessageType=function(){return n};this.hasStudentSAI=function(){return!1};this.getStudentSelection=function(){return null.getSelection()};this.getStudentAction=function(){return null.getAction()};this.getStudentInput=function(){return null.getInput()};this.getStudentSAI=function(){return null};
this.getToolSelection=function(){return""};t=CTATMessage.makeTransactionId();this.parse();this.init=function(a){this.setMessageType(a)};this.setSelection=function(a){v&&v.setSelection(a)};this.setAction=function(a){v&&v.setAction(a)};this.setInput=function(a){v&&v.setInput(a)};this.lockTransactionId=function(a){if(null===a||"undefined"===typeof a||1>a.length)throw new CTATExampleTracerException("lockTranactionId() argument "+a+" must be a valid id");this.setProperty(CTATMessage.TRANSACTION_ID_TAG,
a);E=!0};this.setMessageType=function(a){this.setProperty(CTATMessage.MESSAGE_TYPE,a);f=a};this.setTransactionId=function(a){if(!E){if(null===a||"undefined"===typeof a||1>a.length)a=CTATMessage.makeTransactionId();this.setProperty(CTATMessage.TRANSACTION_ID_TAG,a)}};this.suppressLogging=function(){r=!1};this.isLoggingSuppressed=function(){return!r};CTATMessage.create=function(a,b){b=new CTATMessage;b.init(a);return b}};
Object.defineProperty(CTATMessage,"MESSAGE_TYPE",{enumerable:!1,configurable:!1,writable:!1,value:"MessageType"});Object.defineProperty(CTATMessage,"TRANSACTION_ID_TAG",{enumerable:!1,configurable:!1,writable:!1,value:"transaction_id"});CTATMessage.prototype=Object.create(CTATBase.prototype);CTATMessage.prototype.constructor=CTATMessage;"undefined"!==typeof module&&(module.exports=CTATMessage);var CTATSkills=function(a){CTATBase.call(this,"CTATSkills",a?String(a.length):"");var b={},c=0;a.forEach(function(a){b[a.getSkillName().toLowerCase()]=a});var d=new Set,e=this;this.toXML=function(a,c){c||(c="");var d=a?"&lt;Skills&gt;":"<Skills>",e=d.length,g;for(g in b)b.hasOwnProperty(g)&&b[g]&&(d+=c+b[g].toXML(a));d+=c&&d.length>e?"\n":"";return d+(a?"&lt;/Skills&gt;":"</Skills>")};this.getAllSkills=function(){var a=[],c;for(c in b)b.hasOwnProperty(c)&&b[c]&&a.push(b[c]);return a};this.addSkill=
function(a,c){if(!e.getSkill(a.getSkillName())||c)b[a.getSkillName().toLowerCase()]=a};this.updateSkill=function(a,b,k){var g=null,h=e.getSkill(b);null!==h&&"undefined"!==typeof h&&(h.setTransactionNumber(c),b=k+" "+b,d.has(b)||(d.add(b),h.recordUpdate(a)),CTATExampleTracerSkill.CORRECT.toString().toUpperCase()===a.toString().toUpperCase()&&d.delete(b),g=h);return g};this.startTransaction=function(){++c};this.getSkill=function(a){var c=null===a||"undefined"===typeof a?null:a.toLowerCase(),c=b[c];
e.ctatdebug("CTATSkills.getSkill("+a+") returns "+c);return c};this.getSkillBarVector=function(a,d){var e=[],g;for(g in b)!0===b.hasOwnProperty(g)&&(!0!==d&&b[g].getTransactionNumber()!==c||e.push(b[g].getSkillBarString(a)));return e};this.setExternallyDefined=function(a){};this.setVersion=function(a){for(var c in b)!0===b.hasOwnProperty(c)&&b[c].setVersion(a)};this.toJSONforTutorshop=function(){var a=[],c;for(c in b)!0===b.hasOwnProperty(c)&&a.push(b[c].toJSONforTutorshop());return a};this.toJSON=
function(a){e.ctatdebug("CTATSkills.toJSON("+a+") to return "+("pSummarySkills"==a?e.getAllSkills():e[a]));if(!a)return e;switch(a){case "pSummarySkills":return e.getAllSkills();case "pSummaryUpdates":return e.getAllUpdates();case "psSkills":var b=[];d.forEach(function(a){return b.push(a)});return b;default:return e[a]}};this.getSkillUpdates=function(a){var b=e.getSkill(a),b=b?b.getUpdates():[];e.ctatdebug("CTATSkills.getSkillUpdates("+a+") returns length "+b.length);return b};this.getAllUpdates=
function(){var a=[];e.getAllSkills().forEach(function(b){return a=a.concat(b.getUpdates())});e.ctatdebug("CTATSkills.getAllUpdates() returns length "+a.length);return a};this.updatesToJSONforTutorshop=function(){var a=[];e.getAllSkills().forEach(function(b){return a=a.concat(b.updatesToJSONforTutorshop())});e.ctatdebug("CTATSkills.getAllUpdates() returns length "+a.length);return a};this.restoreUpdates=function(a){a&&a.forEach(function(a){var b=e.getSkill(a.skillName);b&&b.addUpdate(a)})};this.fromJSON=
function(a){a instanceof Array&&a.forEach(function(a){return d.add(a)});return e}};
CTATSkills.parseSkills=function(a,b){var c=[];b||(b=new CTATXML);try{for(var d=b.getElementChildren(a),e=0;e<d.length;e++){var h=b.getElementName(d[e]);if(h&&"skill"==h.toLowerCase()){var g=b.getElementAttr(d[e],"name");if(g&&""!=g.trim()){var k=b.getElementAttr(d[e],"label"),n=b.getElementAttr(d[e],"pSlip"),q=b.getElementAttr(d[e],"description"),l=b.getElementAttr(d[e],"pKnown"),f=b.getElementAttr(d[e],"category"),t=b.getElementAttr(d[e],"pLearn"),p=b.getElementAttr(d[e],"pGuess"),w=b.getElementAttr(d[e],
"history"),m=new CTATExampleTracerSkill(f,g,p,l,n,t,w);m.setOpportunityCount(b.getElementAttr(d[e],"opportunityCount"));m.setLabel(k);m.setDescription(q);c.push(m)}}}}catch(r){console.log("Error in CTATSkills.parseSkills",r,"\n skillsElt",a)}return c};CTATSkills.prototype=Object.create(CTATBase.prototype);CTATSkills.prototype.constructor=CTATSkills;"undefined"!==typeof module&&(module.exports=CTATSkills);var CTATSequencer=function(a,b){CTATBase.call(this,"CTATSequencer","sequencer");"undefined"!=typeof location&&"basic"==location.search.replace(/.*[?&]show_debug_traces=([^&]*)&?.*/,"$1")&&(useDebuggingBasic=!0);CTATLMS.is.OLI()&&(useDebuggingBasic=!0);var c=this,d=new CTATPackage,e=new CTATXML,h=null,g="sequential",k=null,n=b||function(a){console.log("CTATSequencer default CTATLMSListener",a)},q=new CTATSkills([]);this.currentIndex=-1;this.iframeId="ctat_inner_frame";this.setAlgorithm=function(a){g=
a};this.getAlgorithm=function(){return g};this.handlePackageRetrieval=function(a){c.ctatdebug("handlePackageRetrieval ()");d.init(a);null!=k&&k(d,c.currentIndex+1)};this.processXML=function(a){c.ctatdebug("parseXML ()");d.init(a);null!=k&&k(d,c.currentIndex+1)};this.init=function(a,b,g,p,n,m){c.ctatdebug("CTATSequencer.init ("+a+", "+b+", "+g+", "+p+", "+n+", "+m+")");!Number.isNaN(m=Number(m))&&0<=m&&(c.currentIndex=m-1);c.iframeId=p||c.iframeId;d.setPackageURL(a);d.setURLPrefix(g);d.setDefaultStudentInterface(n);
k=b||c.runNextProblem.bind(c);h=new CTATCommLibrary(null,!1);h.retrieveXMLFile(a,e,this);addEventListener("message",function(a){var b=document.getElementById(c.iframeId);c.ctatdebug("CTATSequencer.init() iframe "+b+", evt.data "+a.data);if(a.data&&/tutorready/i.test(a.data.command))try{b.contentWindow.CTATCommShell.commShell.assignDoneProcessor(c.advanceToNextProblem.bind(c))}catch(v){throw Error("CTATSequencer.init() error adding listener to iframe '"+c.iframeId+": "+v);}})};this.getSequenceType=
function(){return"fixed"};this.getCurrentIndex=function(){return c.currentIndex};this.advanceToNextProblem=function(a){c.ctatdebug("advanceToNextProblem()\n psResp "+a);c.processProblemSummaryResponse(a);c.runNextProblem()};this.processProblemSummaryResponse=function(a){try{var b=(new CTATMessage(e.parse(a))).getProperty("ProblemSummary");c.ctatdebug("processProblemSummaryResponse typeof(ps)"+typeof b+", ps "+b);for(var d=e.parse(b),g=e.getElementChildren(d),b=0;b<g.length;++b)if(/^skills$/i.test(e.getElementName(g[b]))){var h=
CTATSkills.parseSkills(g[b],e);c.ctatdebug("processProblemSummaryResponse skillList.length "+(h?h.length:null));h.forEach(function(a){q.addSkill(a,!0)});break}}catch(m){console.log("Error in processProblemSummaryResponse",m,"\n psResp",a)}};this.getProblemSetSize=function(){c.ctatdebug("getProblemSetSize ()");var a=d.getProblemSets();return 0==a.length?(c.ctatdebug("Error: no problem sets available, trying list of problems directly ..."),d.getProblems().getProblemSize()):a[0].getProblemSize()};this.getFirstProblem=
function(){c.ctatdebug("getFirstProblem(): currentIndex "+c.currentIndex);c.currentIndex=-1;return getNextProblem()};this.getProblemList=function(){c.ctatdebug("getProblemList ()");var a=d.getProblemSets();return 0==a.length?(c.ctatdebug("Error: no problem sets available, trying list of problems directly ..."),d.getProblems()):a[0].getProblems()};this.runNextProblem=function(){var a=c.getNextProblem();c.ctatdebug("CTATSequencer.runNextProblem() "+a);return c.runProblem(a)||CTATScrim.scrim.scrimUp(CTATLanguageManager.theSingleton.filterString("DONE_WITH_PROBLEM_SET"))||
null};this.runProblem=function(a){if(!a)return null;var b=document.getElementById(c.iframeId);c.ctatdebug("CTATSequencer.runProblem("+a+") iframe "+b);if(!b)throw Error("CTATSequencer.runProblem("+a+"): iframe '"+c.iframeId+"' not found");var e={};Object.assign(e,CTATConfiguration.getRawFlashVars());e.dataset_level_name1||(e.dataset_level_name1=a.getProblemFile(),e.dataset_level_type1="Activity");e.problem_name=a.getProblemFile();e.question_file=d.getRelativePath(a.getStudentInterface(),a.getProblemFile());
e.student_interface=a.getStudentInterface();e.skills=encodeURIComponent(c.getRevisedSkills(a.getSkills()).toXML());b.setAttribute("data-params",JSON.stringify(e));b.src=d.getURLPrefix()+d.getRelativePath(a.getStudentInterface())+(e.mode?"?MODE="+e.mode:"");return a};this.getRevisedSkills=function(a,b){a.forEach(function(a){q.addSkill(a,b)});return q};this.getNextProblem=function(){c.ctatdebug("getNextProblem(): currentIndex "+c.currentIndex);var a=d.getProblemSets();return 0==a.length?(c.ctatdebug("Error: no problem sets available, trying list of problems directly ..."),
d.getProblems()[++c.currentIndex]):a[0].getProblems()[++c.currentIndex]};this.addProblem=function(a,b,c,e,g){d.addProblem(a,b,c,e,g)};CTATConfiguration.generateDefaultConfigurationObject(a,"undefined"==typeof CTATTarget?void 0:CTATTarget);addEventListener("ctatlms",function(a){console.log("CTATSequencer ctatlms listener evt",a);n(a)})};CTATSequencer.prototype=Object.create(CTATBase.prototype);CTATSequencer.prototype.constructor=CTATSequencer;
Object.defineProperty(CTATSequencer,"PackageListURI",{enumerable:!1,configurable:!1,writable:!1,value:/^([^?]*\/)?package[.]xml$/i});var CTATProtractor=function(a,b,c,d,e){function h(a,b,c,d,e){e=void 0===e?!0:e;this.protractor=a;this.name=b;this.point;this.ray;this.label;this.arrow;this.x=c;this.y=d;this.move=e;this.bd;var f=this;this.scalefactor;this.df;this.hidden=!1;this.renderProtRay=function(){this.scalefactor=f.protractor.magnitude/320;this.label.setAttributeNS(null,"x",this.x+.09*f.protractor.magnitude);this.label.setAttributeNS(null,"y",this.y);this.ray.setAttributeNS(null,"x1",f.protractor.origin.x);this.ray.setAttributeNS(null,
"y1",f.protractor.origin.y);this.ray.setAttributeNS(null,"x2",this.x);this.ray.setAttributeNS(null,"y2",this.y);this.point.setAttributeNS(null,"cx",this.x);this.point.setAttributeNS(null,"cy",this.y);this.point.setAttributeNS(null,"r",3+3*this.scalefactor);this.arrow.setAttributeNS(null,"points",this.x+","+this.y+" "+(this.x+5*this.scalefactor)+","+(this.y+3*this.scalefactor)+" "+this.x+","+(this.y-10*this.scalefactor)+" "+(this.x-5*this.scalefactor)+","+(this.y+3*this.scalefactor))};this.rerenderProtray=
function(){start90=this.protractor.getPointFromAnglitude(90,this.protractor.magnitude);this.x=start90.x;this.y=start90.y;this.renderProtRay();this.moveTo(this.protractor.getPointFromAnglitude(this.bd,this.protractor.magnitude))};this.createProtRay=function(){this.scalefactor=f.protractor.magnitude/320;this.df=document.createDocumentFragment();label=document.createElementNS(g,"text");label.classList.add("CTATProtractor--labelray");label.setAttributeNS(null,"id","label_"+this.name);label.appendChild(document.createTextNode(this.name));
ray=document.createElementNS(g,"line");ray.setAttributeNS(null,"id","ray_"+this.name);point=document.createElementNS(g,"circle");point.setAttributeNS(null,"id","point_"+this.name);arrow=document.createElementNS(g,"polygon");arrow.setAttributeNS(null,"id","arrow_"+this.name);f.point=point;f.ray=ray;f.label=label;f.arrow=arrow;this.renderProtRay();this.df.appendChild(label);this.df.appendChild(ray);this.df.appendChild(arrow);this.df.appendChild(point)};this.createProtRay();this.drawProtRay=function(){this.move?
(this.point.classList.add("CTATProtractor--select"),f.protractor._protrays.append(this.df)):f.protractor._fgrays.append(this.df);this.bd=this.getAngle()};this.point.getProtRay=function(){return f};this.moveTo=function(b){move_angle=f.protractor.calcAngle(b);move_mag=f.protractor.calcMagMult(b);point_coord=f.protractor.getPointFromAnglitude(move_angle,f.protractor.magnitude);ray_coord=f.protractor.getPointFromAnglitude(move_angle,f.protractor.magnitude*(move_mag+.075));this.point.setAttributeNS(null,
"cx",b.x);this.point.setAttributeNS(null,"cy",b.y);this.ray.setAttributeNS(null,"x2",ray_coord.x);this.ray.setAttributeNS(null,"y2",ray_coord.y);arrow_angle=move_angle-90;this.arrow.setAttributeNS(null,"transform","rotate("+arrow_angle+" "+a.origin.x+" "+a.origin.y+") translate(0 "+(1-move_mag-.075)*f.protractor.magnitude+")");this.move?(60>move_angle||120<move_angle?this.label.setAttributeNS(null,"y",1.1*b.y):this.label.setAttributeNS(null,"y",.9*b.y),b.x>=this.protractor.origin.x?this.label.setAttributeNS(null,
"x",b.x+.07*f.protractor.magnitude):this.label.setAttributeNS(null,"x",b.x-.07*f.protractor.magnitude)):(this.label.setAttributeNS(null,"x",b.x),this.label.setAttributeNS(null,"y",b.y+.08*f.protractor.magnitude));this.bd=this.getAngle()};this.setPoint=function(a){function b(a){setTimeout(function(){f.moveTo(f.protractor.getPointFromAnglitude(a,f.protractor.magnitude));e?a++:a--;a!=d?setTimeout(function(){b(a)},11):setTimeout(function(){f.moveTo(f.protractor.getPointFromAnglitude(d,f.protractor.magnitude))},
11);11})}var c=Math.floor(this.getAngle()),d=Math.floor(a),e=!0;if(0<c-d)e=!1;else if(c==d){f.moveTo(f.protractor.getPointFromAnglitude(d,f.protractor.magnitude));return}b(c)};this.differentialProtrayMove=function(a,b){if(!this.move)return console.error('Ray "'+this.name+'" is a non-moving base ray, so should not move.'),!1;var c=this.bd-a.bd;b-=Math.abs(c);if(1>Math.abs(b))return!1;if(0>c){if(c=this.bd-b,0>c||180<c)if(c=a.bd+b,0>c||180<c)return console.log("New angle not possible with Ray "+this.name),
!1}else if(c=this.bd+b,0>c||180<c)if(c=a.bd-b,0>c||180<c)return console.log("New angle not possible with Ray "+this.name),!1;this.setPoint(c);return!0};this.getAngle=function(){var a=this.point.getAttributeNS(null,"cx"),b=this.point.getAttributeNS(null,"cy");coord={x:a,y:b};return this.protractor.calcAngle(coord)};this.genInput=function(){function a(a){a.name!=f.name&&(rep_value=Math.abs(Math.round(f.bd-a.bd)),f.protractor.measureunit.includes("deg")||(rep_value=f.protractor.convertUnits(rep_value)),
b[f.name+f.protractor.baseOrigin+a.name]=rep_value)}var b={};Object.values(this.protractor.basePoints).forEach(a);Object.values(this.protractor.interactivePoints).forEach(a);return b};this.deactivateProtRay=function(){this.point.classList.add("unselectable");this.point.classList.remove("CTATProtractor--select")};this.reactivateProtRay=function(){this.point.classList.remove("unselectable");this.point.classList.add("CTATProtractor--select")};this.hideProtRay=function(){this.deactivateProtRay();$("#point_"+
this.name).hide();$("#label_"+this.name).hide();$("#ray_"+this.name).hide();$("#arrow_"+this.name).hide();this.hidden=!0};this.showProtRay=function(){this.reactivateProtRay();$("#point_"+this.name).show();$("#label_"+this.name).show();$("#ray_"+this.name).show();$("#arrow_"+this.name).show();this.hidden=!1};this.fadeOutProtRay=function(){this.deactivateProtRay();$("#point_"+this.name).fadeOut(this.protractor.fadespd);$("#label_"+this.name).fadeOut(this.protractor.fadespd);$("#ray_"+this.name).fadeOut(this.protractor.fadespd);
$("#arrow_"+this.name).fadeOut(this.protractor.fadespd);this.hidden=!0};this.fadeInProtRay=function(){this.reactivateProtRay();$("#point_"+this.name).fadeIn(this.protractor.fadespd);$("#label_"+this.name).fadeIn(this.protractor.fadespd);$("#ray_"+this.name).fadeIn(this.protractor.fadespd);$("#arrow_"+this.name).fadeIn(this.protractor.fadespd);this.hidden=!1};this.styleCorrect=function(){this.deStyle();this.ray.classList.add("CTATProtractor--correct")};this.styleIncorrect=function(){this.deStyle();
this.point.classList.add("CTATProtractor--incorrect");this.ray.classList.add("CTATProtractor--incorrect")};this.styleHint=function(){this.deStyle();this.point.classList.add("CTATProtractor--hint");this.ray.classList.add("CTATProtractor--hint")};this.deStyle=function(){this.point.classList.remove("CTATProtractor--correct");this.point.classList.remove("CTATProtractor--incorrect");this.point.classList.remove("CTATProtractor--hint");this.ray.classList.remove("CTATProtractor--correct");this.ray.classList.remove("CTATProtractor--incorrect");
this.ray.classList.remove("CTATProtractor--hint")}}CTAT.Component.Base.SVG.call(this,"CTATProtractor","aProtractor",a,b,c,d,e);this.magnitude;this.numIntPoints=1;this.radians=0;this.interval=15;this.snap=!0;this.snaps=[];this.protRays=[];this.origin={x:null,y:null};this.leftBound;this.rightBound;this.topBound;this.bottomBound;this.fadespd=1E3;this.basePointString="OB";this.baseOrigin="O";this.basePoints={};this.interactivePointString="A";this.interactivePoints={};this.innerLabels="none";this.outerLabels=
"counterclockwise degrees";this.chosenAngle;this.chosen=!1;this.measureunit="degrees";this.precision=2;this.denominator=null;this.dragOnArc=!0;this.radsnap=!1;this.radsnaps=[];var g=CTATGlobals.NameSpace.svg,k;this.getConfigurationActions=function(){var a=[],b,c=$(this.getDivWrap());c.attr("data-ctat-interactive-points")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("setInteractivePoints"),b.setInput(c.attr("data-ctat-interactive-points")),a.push(b));c.attr("data-ctat-base-points")&&
(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("setBasePoints"),b.setInput(c.attr("data-ctat-base-points")),a.push(b));c.attr("data-ctat-outer-labels")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("setOuterLabels"),b.setInput(c.attr("data-ctat-outer-labels")),a.push(b));c.attr("data-ctat-inner-labels")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("setInnerLabels"),b.setInput(c.attr("data-ctat-inner-labels")),a.push(b));c.attr("data-ctat-unit-of-measure")&&(b=
new CTATSAI,b.setSelection(this.getName()),b.setAction("setUOM"),b.setInput(c.attr("data-ctat-unit-of-measure")),a.push(b));c.attr("data-ctat-precision")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("setRadPrecision"),b.setInput(c.attr("data-ctat-precision")),a.push(b));c.attr("data-ctat-interval")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("setInterval"),b.setInput(c.attr("data-ctat-interval")),a.push(b));c.attr("data-ctat-snap")&&(b=new CTATSAI,b.setSelection(this.getName()),
b.setAction("setSnap"),b.setInput(c.attr("data-ctat-snap")),a.push(b));c.attr("data-ctat-drag-on-arc")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("setDragOnArc"),b.setInput(c.attr("data-ctat-drag-on-arc")),a.push(b));return a};this.setInteractivePoints=function(a){this.interactivePointString=a;this.numIntPoints=a.length};this.setParameterHandler("interactivePoints",this.setInteractivePoints);this.data_ctat_handlers.interactivePoints=this.setInteractivePoints;this.setBasePoints=function(a){this.basePointString=
a};this.setParameterHandler("basePoints",this.setBasePoints);this.data_ctat_handlers.basePoints=this.setBasePoints;this.setUOM=function(a){a.includes("rad")?(this.measureunit="rad",this.radsnap=!0):a.includes("frac")&&(this.measureunit="frac",this.radsnap=!0)};this.setParameterHandler("unitOfMeasure",this.setUOM);this.data_ctat_handlers.unitOfMeasure=this.setUOM;this.setRadPrecision=function(a){this.measureunit.includes("frac")?this.denominator=a:this.precision=a};this.setParameterHandler("precision",
this.setRadPrecision);this.data_ctat_handlers.precision=this.setRadPrecision;this.setSnap=function(a){a||(this.snap=!1)};this.setParameterHandler("snap",this.setSnap);this.data_ctat_handlers.snap=this.setSnap;this.setInterval=function(a){0!==180%a||90<a?console.log("Unacceptable value for data-ctat-interval set.  Value must evenly divide 180 degrees. Defaulting to 15."):this.interval=a};this.setParameterHandler("interval",this.setInterval);this.data_ctat_handlers.interval=this.setInterval;this.setDragOnArc=
function(a){this.dragOnArc=a};this.setParameterHandler("dragOnArc",this.setDragOnArc);this.data_ctat_handlers.dragOnArc=this.setDragOnArc;var n=function(a){a.target.classList.contains("CTATProtractor--select")&&(a.preventDefault(),this.removeRayStyles(),k=a.target.getProtRay())}.bind(this),q=function(a){k&&(a.preventDefault(),a=this.getMousePosition(a),a.x<this.leftBound&&(a.x=this.leftBound),a.x>this.rightBound&&(a.x=this.rightBound),a.y<this.topBound&&(a.y=this.topBound),a.y>this.bottomBound&&(a.y=
this.bottomBound),this.snap?k.moveTo(this.getClosestSnap(a)):this.radsnap?k.moveTo(this.getClosestSnap(a,!0)):this.dragOnArc?k.moveTo(this.getPointFromAnglitude(this.calcAngle(a),this.magnitude)):k.moveTo(a))}.bind(this),l=function(a){k&&(a=this.getMousePosition(a),this.snap?a=this.getClosestSnap(a):this.radsnap&&(a=this.getClosestSnap(a,!0)),a=Math.round(this.calcAngle(a)),0>a?a=0:180<a&&(a=180),k.setPoint(a),sas_input=k.genInput(),a=this.chosen?void 0!==sas_input[this.chosenAngle]?sas_input[this.chosenAngle]:
sas_input[this.chosenAngle.charAt(2)+this.chosenAngle.charAt(1)+this.chosenAngle.charAt(0)]?sas_input[this.chosenAngle.charAt(2)+this.chosenAngle.charAt(1)+this.chosenAngle.charAt(0)]:"Incorrect point selected!":JSON.stringify(sas_input).slice(1,-1),this.setActionInput("setAngle",a),this.processAction(),k=null)}.bind(this);this.getMousePosition=function(a){var b=this.component.firstElementChild.getScreenCTM();return{x:(a.clientX-b.e)/b.a,y:(a.clientY-b.f)/b.d}};this.removeRayStyles=function(){Object.values(this.interactivePoints).forEach(function(a){a.deStyle()});
Object.values(this.basePoints).forEach(function(a){a.deStyle()})};this.init=function(){var a=this.getDivWrap();this.initSVG();this.component.classList.add("CTATProtractor--container");this._compass=document.createElementNS(g,"g");this._compass.classList.add("CTATProtractor--compass","unselectable");this._labels=document.createElementNS(g,"g");this._labels.classList.add("CTATProtractor--labels","unselectable");this._fgrays=document.createElementNS(g,"g");this._fgrays.classList.add("CTATProtractor--fgrays",
"unselectable");this._protrays=document.createElementNS(g,"g");this._protrays.classList.add("CTATProtractor--protrays");this.component.appendChild(this._compass);this.component.appendChild(this._labels);this.component.appendChild(this._fgrays);this.component.appendChild(this._protrays);this.component.addEventListener("mousedown",n);this.component.addEventListener("mousemove",q);this.component.addEventListener("mouseup",l);this.dimensionalize();this.checkFractionInterval();this.drawCompass();this.initialBasePoints();
this.initialInteractivePoints();this.initialPositions();this.checkSingleAngleMode();this.setSnaps();this.setRadSnaps();this.drawOriginLabel();this.drawLabels();this.component.setAttributeNS(null,"viewBox","0,0,800,400");this.component.setAttributeNS(null,"preserveAspectRatio","xMidYMid meet");this.setComponent(a);this.setInitialized(!0);this.addComponentReference(this,a)};this.oldDimensionalize=function(){var a=this.getBoundingBox();this.leftBound=Math.floor(.05*a.width);this.rightBound=Math.floor(.95*
a.width);this.topBound=Math.floor(.05*a.height);this.bottomBound=Math.floor(.95*a.height);this.magnitude=Math.min(.4*a.width,.8*a.height);this.origin.x=a.width/2;this.origin.y=a.height/2+this.magnitude/2};this.dimensionalize=function(){this.leftBound=10;this.rightBound=790;this.topBound=10;this.bottomBound=360;this.magnitude=320;this.origin.x=400;this.origin.y=360;this.setFontSize()};this.setAngle=function(a){var b="{"+a+"}",c,d,f;this.chosen?(c=this.chosenAngle.charAt(0),d=this.chosenAngle.charAt(2)):
(specified_angles=JSON.parse(b),c=Object.keys(specified_angles)[0][0],d=Object.keys(specified_angles)[0][2]);b=this.findProtray(c);f=this.findProtray(d);targetAngleName=c+this.baseOrigin+d;targetAngle=null;targetAngle=this.chosen?a:specified_angles[targetAngleName];null!=targetAngle&&(this.measureunit.includes("deg")||(targetAngle=this.convertToDegrees(targetAngle)),b.differentialProtrayMove(f,targetAngle))};this.chooseAngle=function(a){this.chosenAngle=a;this.chosen=!0};this.findProtray=function(a){if(this.interactivePoints[a])return this.interactivePoints[a];
if(this.basePoints[a])return this.basePoints[a];console.error("Point/Ray not found! Name: "+a)};this.reportAngle=function(a){reportAngle_selectedKey=a.charAt(0);reportAngle_oppKey=a.charAt(2);reportAngle_selectedRay=this.findProtray(reportAngle_selectedKey);reportAngle_oppRay=this.findProtray(reportAngle_oppKey);reportAngle_final=this.convertUnits(Math.abs(reportAngle_selectedRay.bd-reportAngle_oppRay.bd));"number"===typeof reportAngle_final&&(reportAngle_final=Math.round(reportAngle_final));return reportAngle_final};
this.initialInteractivePoints=function(){for(i=0;i<this.numIntPoints;i++)this.basePointString.includes(this.interactivePointString.charAt(i))?console.error('Interactive point "'+this.interactivePointString.charAt(i)+'" in CTATProtractor "'+this.getDivWrap().id+'" is already a base point; choose unique names for all points!'):this.interactivePoints[this.interactivePointString.charAt(i)]=null;var a=Object.keys(this.interactivePoints);start90=this.getPointFromAnglitude(90,this.magnitude);var b=function(a,
b,c){this.interactivePoints[a]=new h(this,a,start90.x,start90.y)}.bind(this);a.forEach(b);Object.values(this.interactivePoints).forEach(function(a){a.drawProtRay()})};this.initialPositions=function(){start=intrv=Math.floor(180/(this.numIntPoints+1));self=this;Object.values(this.interactivePoints).forEach(function(a){a.moveTo(self.getPointFromAnglitude(start,self.magnitude));start+=intrv})};this.initialBasePoints=function(){var a=this.basePointString.length;0>=a||(this.baseOrigin=this.basePointString.charAt(0),
2>a||(start90=this.getPointFromAnglitude(90,this.magnitude),1<a&&(point_name=this.basePointString.charAt(1),this.basePoints[point_name]=new h(this,point_name,start90.x,start90.y,!1),this.basePoints[point_name].drawProtRay(),this.basePoints[point_name].moveTo(this.getPointFromAnglitude(180,this.magnitude))),2<a&&(this.basePointString.charAt(1)===this.basePointString.charAt(2)?(console.warn('Duplicate names for base points in CTATProtractor "'+this.getDivWrap().id+'"; please check your data-ctat-base-points property.'),
this.basePointString=this.basePointString.slice(0,2)):(point_name=this.basePointString.charAt(2),this.basePoints[point_name]=new h(this,point_name,start90.x,start90.y,!1),this.basePoints[point_name].drawProtRay(),this.basePoints[point_name].moveTo(this.getPointFromAnglitude(0,this.magnitude))))))};this.checkSingleAngleMode=function(){1===Object.keys(this.interactivePoints).length&&1===Object.keys(this.basePoints).length&&this.chooseAngle(this.interactivePointString+this.basePointString)};this.render=
function(){this.dimensionalize();this.renderCompass();Object.values(this.interactivePoints).forEach(function(a){a.rerenderProtray()});Object.values(this.basePoints).forEach(function(a){a.rerenderProtray()});this.snaps=[];this.setSnaps();this.radsnaps=[];this.setRadSnaps();this.redrawLabels()};this.createTick=function(a,b){tick=document.createElementNS(g,"line");tick.setAttributeNS(null,"x1",a.x);tick.setAttributeNS(null,"y1",a.y);tick.setAttributeNS(null,"x2",b.x);tick.setAttributeNS(null,"y2",b.y);
tick.classList.add("CTATProtractor--ticks");return tick};this.createTicks=function(){for(j=intrv=this.interval;179>=j;j+=intrv)coord1=this.getPointFromAnglitude(j,.97*this.magnitude),coord2=this.getPointFromAnglitude(j,1.03*this.magnitude),this._compass.appendChild(this.createTick(coord1,coord2))};this.checkFractionInterval=function(){null!==this.denominator&&(this.interval=180/this.denominator)};this.deleteTicks=function(){ticks=this._compass.children;length=ticks.length;for(i=length-1;1<=i;i--)ticks[i].remove()};
this.drawCompass=function(){compass=document.createElementNS(g,"path");compass.setAttributeNS(null,"d","M "+this.origin.x+" "+this.origin.y+"H "+(this.origin.x+this.magnitude)+" A "+this.magnitude+" "+this.magnitude+" 0 0 0 "+(this.origin.x-this.magnitude)+" "+this.origin.y+" H "+this.origin.x);this._compass.appendChild(compass);this.createTicks()};this.renderCompass=function(){this.deleteTicks();this._compass.firstElementChild.setAttributeNS(null,"d","M "+this.origin.x+" "+this.origin.y+"H "+(this.origin.x+
this.magnitude)+" A "+this.magnitude+" "+this.magnitude+" 0 0 0 "+(this.origin.x-this.magnitude)+" "+this.origin.y+" H "+this.origin.x);this.createTicks()};this.resetLabels=function(a){this.compLabels=parseInt(a);this.getDivWrap().setAttribute("data-ctat-complabels",a);this.redrawLabels()};this.setFontSize=function(){this.component.style.fontSize=7+.04*this.magnitude+"px"};this.resetRadians=function(a){this.radians=parseInt(a);this.getDivWrap().setAttribute("data-ctat-radians",labelcode);this.redrawLabels()};
this.createLabel=function(a,b,c,d){label=document.createElementNS(g,"text");label.setAttributeNS(null,"x",a);label.setAttributeNS(null,"y",b);label.setAttributeNS(null,"class",d);label.appendChild(document.createTextNode(c));this._labels.appendChild(label)};this.drawOriginLabel=function(){this.createLabel(this.origin.x,this.origin.y+.07*this.magnitude,this.baseOrigin,"CTATProtractor--label-origin")};this.drawLabels=function(){0==90%this.interval&&("none"==this.outerLabels||this.outerLabels.includes("rad")&&
this.innerLabels.includes("rad")||this.outerLabels.includes("deg")&&this.innerLabels.includes("deg")||this.drawLabel90("top"),"none"!=this.innerLabels&&this.drawLabel90());"none"!=this.outerLabels&&this.drawLabelOuter();"none"!=this.innerLabels&&this.drawLabelInner()};this.redrawLabels=function(){this.deleteLabels();this.drawLabels();this.drawOriginLabel()};this.lookupRadians=function(a){fraction=this.reduceDegreesToFrac(a);a=fraction[0];if(0===fraction[0])return"0";1===fraction[0]&&(a="");return 1===
fraction[1]?"\u03c0":a+"\u03c0/"+fraction[1]};this.setOuterLabels=function(a){this.outerLabels=a};this.setParameterHandler("outer-labels",this.setOuterLabels);this.data_ctat_handlers["outer-labels"]=this.setOuterLabels;this.drawLabelOuter=function(){var a=!1,b=!0;this.outerLabels.includes("counter")&&(b=!1);this.outerLabels.includes("rad")&&(a=!0);var c;10>this.interval?c=2*this.interval:c=this.interval;for(j=0;180>=j;j+=c)90!==j&&(coord=this.getPointFromAnglitude(j,1.1*this.magnitude),label_num=
b?j:180-j,0===j||180===j?(0===j?xcooord=coord.x-20:180===j&&(xcooord=coord.x+20),a?this.createLabel(xcooord+.05*(xcooord-this.origin.x),coord.y+5,this.lookupRadians(label_num),"outer"):this.createLabel(xcooord,coord.y+5,label_num,"outer")):a?this.createLabel(coord.x+.05*(coord.x-this.origin.x),coord.y+5,this.lookupRadians(label_num),"outer"):this.createLabel(coord.x,coord.y+5,label_num,"outer"))};this.setInnerLabels=function(a){this.innerLabels=a};this.setParameterHandler("inner-labels",this.setInnerLabels);
this.data_ctat_handlers["inner-labels"]=this.setInnerLabels;this.drawLabelInner=function(){var a=!1,b=!0;this.innerLabels.includes("counter")&&(b=!1);this.innerLabels.includes("rad")&&(a=!0);var c;10>this.interval||15>this.interval&&a?c=2*this.interval:c=this.interval;for(j=0;180>=j;j+=c)90!==j&&(label_num=b?j:180-j,coord=this.getPointFromAnglitude(j,.9*this.magnitude),0===j||180===j?a?this.createLabel(coord.x,coord.y-5,this.lookupRadians(label_num),"inner"):this.createLabel(coord.x,coord.y-5,label_num,
"inner"):a?this.createLabel(coord.x-.07*(coord.x-this.origin.x),coord.y,this.lookupRadians(label_num),"inner"):this.createLabel(coord.x,coord.y,label_num,"inner"))};this.drawLabel90=function(a){var b=!1,c=.88*this.magnitude;"top"==(void 0===a?"bottom":a)?(c=1.05*this.magnitude,this.outerLabels.includes("rad")&&(b=!0)):this.innerLabels.includes("rad")&&(b=!0);coord=this.getPointFromAnglitude(90,c);a=b?this.lookupRadians(90):"90";this.createLabel(coord.x,coord.y,a,"CTATProtractor--label90")};this.hideLabels=
function(a){"outer"==a?$(".outer").hide():"inner"==a?$(".inner").hide():($(".outer").hide(),$(".inner").hide(),$(".CTATProtractor--label90").hide())};this.showLabels=function(a){"outer"==a?$(".outer").show():"inner"==a?$(".inner").show():($(".outer").show(),$(".inner").show(),$(".CTATProtractor--label90").show())};this.deleteLabels=function(){labels=this._labels.children;length=labels.length;for(i=length-1;0<=i;i--)labels[i].remove()};this.calcAngle=function(a){var b=a.x;a=a.y;var c=!0;b<=this.origin.x?
b=this.origin.x-b:(b-=this.origin.x,c=!1);calcd_angle=180/Math.PI*Math.atan((a<=this.origin.y?this.origin.y-a:0)/b);c||(calcd_angle=180-calcd_angle);return calcd_angle};this.calcMagMult=function(a){var b=a.y;x_mag=Math.pow(a.x-this.origin.x,2);y_mag=Math.pow(b-this.origin.y,2);return Math.sqrt(x_mag+y_mag)/this.magnitude};this.getPointFromAnglitude=function(a,b){x=this.origin.x-Math.cos(a*Math.PI/180)*b;y=this.origin.y-Math.sin(a*Math.PI/180)*b;return coord={x:x,y:y}};this.convertUnits=function(a){var b=
a;this.measureunit.includes("rad")?b=(a*Math.PI/180).toFixed(this.precision):this.measureunit.includes("frac")&&(this.denominator?(numerator=Math.round(a/180*this.denominator),b=numerator+"/"+this.denominator):(frac=this.reduceDegreesToFrac(a),b=frac[0]+"/"+frac[1]));return b};this.convertToDegrees=function(a){this.measureunit.includes("rad")?converted_val=Math.round(180*a.toInt()/Math.PI):this.measureunit.includes("frac")&&(frac_index=a.search("/"),temp_numerator=a.slice(0,frac_index).toInt(),temp_denom=
a.slice(frac_index+1).toInt(),converted_val=Math.round(temp_numerator/temp_denom*180/Math.PI));return converted_val};this.reduceDegreesToFrac=function(a){return function(a,b){var c=function r(a,b){return b?r(b,a%b):a},c=c(a,b);return[a/c,b/c]}(a,180)};this.setSnaps=function(){for(i=0;180>=i;i+=this.interval)this.snaps.push(i)};this.setRadSnaps=function(){for(i=0;180>=i;i+=this.interval/4)this.radsnaps.push(i)};this.getClosestSnap=function(a,b){b=void 0===b?!1:b;var c=this.calcAngle(a);a=b?this.radsnaps.findIndex(function(a){if(c<=
a)return!0}):this.snaps.findIndex(function(a){if(c<=a)return!0});b?(b=this.radsnaps[a-1],a=this.radsnaps[a]):(b=this.snaps[a-1],a=this.snaps[a]);return a-c>=c-b?this.getPointFromAnglitude(b,this.magnitude):this.getPointFromAnglitude(a,this.magnitude)};this.lockPoints=function(a){Object.values(this.interactivePoints).forEach(function(b){a.includes(b.name)||!a?b.deactivateProtRay():b.reactivateProtRay()})};this.unlockPoints=function(a){Object.values(this.interactivePoints).forEach(function(b){!a.includes(b.name)&&
a||b.reactivateProtRay()})};this.hidePoints=function(a){Object.values(this.interactivePoints).forEach(function(b){!a.includes(b.name)&&a||b.hidden||b.hideProtRay()})};this.showPoints=function(a){Object.values(this.interactivePoints).forEach(function(b){!a.includes(b.name)&&a||!b.hidden||b.showProtRay()})};this.fadeOutPoints=function(a){Object.values(this.interactivePoints).forEach(function(b){!a.includes(b.name)&&a||b.hidden||b.fadeOutProtRay()})};this.fadeInPoints=function(a){Object.values(this.interactivePoints).forEach(function(b){!a.includes(b.name)&&
a||!b.hidden||b.fadeInProtRay()})};this.showCorrect=function(a){var b=a.getInput();switch(a.getAction()){case "setAngle":this.chosen?(b=this.findProtray(this.chosenAngle.charAt(0)),a=this.findProtray(this.chosenAngle.charAt(2))):(showcorrect_angles=JSON.parse("{"+b+"}"),b=this.findProtray(Object.keys(showcorrect_angles)[0][0]),a=this.findProtray(Object.keys(showcorrect_angles)[0][2]));b.styleCorrect();a.styleCorrect();break;default:console.log("Correct highlights not functioning properly.")}};this.showInCorrect=
function(a){var b=a.getInput();switch(a.getAction()){case "setAngle":this.chosen?a=this.findProtray(this.chosenAngle.charAt(0)):(showincorrect_angles=JSON.parse("{"+b+"}"),a=this.findProtray(Object.keys(showincorrect_angles)[0][0]));a.styleIncorrect();break;default:console.log("Incorrect highlights not functioning properly.")}};this.showHintHighlight=function(a,b){if(b)var c=b.getInput(),d=b.getAction();switch(d){case "setAngle":this.chosen?(b=this.findProtray(this.chosenAngle.charAt(0)),a=this.findProtray(this.chosenAngle.charAt(2))):
(showhint_angles=JSON.parse("{"+c+"}"),b=this.findProtray(Object.keys(showhint_angles)[0][0]),a=this.findProtray(Object.keys(showhint_angles)[0][2])),b.styleHint(),a.styleHint()}}};CTATProtractor.prototype=Object.create(CTAT.Component.Base.SVG.prototype);CTATProtractor.prototype.constructor=CTATProtractor;CTAT.ComponentRegistry.addComponentType("CTATProtractor",CTATProtractor);!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.lifecycle=b()}(this,function(){var a=void 0;try{new EventTarget,a=!1}catch(m){a=!1}var b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},c=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");
},d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?
Object.setPrototypeOf(a,b):a.__proto__=b)},h=function(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b},g=function(){function a(){c(this,a);this._registry={}}return d(a,[{key:"addEventListener",value:function(a,b){this._getRegistry(a).push(b)}},{key:"removeEventListener",value:function(a,b){a=this._getRegistry(a);b=a.indexOf(b);-1<b&&a.splice(b,1)}},{key:"dispatchEvent",value:function(a){return a.target=
this,Object.freeze(a),this._getRegistry(a.type).forEach(function(b){return b(a)}),!0}},{key:"_getRegistry",value:function(a){return this._registry[a]=this._registry[a]||[]}}]),a}(),k=a?EventTarget:g,n=a?Event:function r(a){c(this,r);this.type=a},q=function(a){function b(a,d){c(this,b);a=h(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return a.newState=d.newState,a.oldState=d.oldState,a.originalEvent=d.originalEvent,a}return e(b,n),b}(),l="object"===("undefined"==typeof safari?"undefined":
b(safari))&&safari.pushNotification,f=["focus","blur","visibilitychange","freeze","resume","pageshow","onpageshow"in self?"pagehide":"unload"],t=function(a){return a.preventDefault(),a.returnValue="Are you sure?"},p=[["active","passive","hidden","terminated"],["active","passive","hidden","frozen"],["hidden","passive","active"],["frozen","hidden"],["frozen","active"],["frozen","passive"]].map(function(a){return a.reduce(function(a,b,c){return a[b]=c,a},{})}),w=function(){return"hidden"===document.visibilityState?
"hidden":document.hasFocus()?"active":"passive"};return new (function(a){function b(){c(this,b);var a=h(this,(b.__proto__||Object.getPrototypeOf(b)).call(this)),d=w();return a._state=d,a._unsavedChanges=[],a._handleEvents=a._handleEvents.bind(a),f.forEach(function(b){return addEventListener(b,a._handleEvents,!0)}),l&&addEventListener("beforeunload",function(b){a._safariBeforeUnloadTimeout=setTimeout(function(){b.defaultPrevented||0<b.returnValue.length||a._dispatchChangesIfNeeded(b,"hidden")},0)}),
a}return e(b,k),d(b,[{key:"addUnsavedChanges",value:function(a){-1< !this._unsavedChanges.indexOf(a)&&(0===this._unsavedChanges.length&&addEventListener("beforeunload",t),this._unsavedChanges.push(a))}},{key:"removeUnsavedChanges",value:function(a){a=this._unsavedChanges.indexOf(a);-1<a&&(this._unsavedChanges.splice(a,1),0===this._unsavedChanges.length&&removeEventListener("beforeunload",t))}},{key:"_dispatchChangesIfNeeded",value:function(a,b){if(b!==this._state){a:{for(var c=this._state,d,e=0;d=
p[e];++e){var f=d[c],g=d[b];if(0<=f&&0<=g&&g>f){b=Object.keys(d).slice(f,g+1);break a}}b=[]}for(c=0;c<b.length-1;++c)d=b[c],this._state=e=b[c+1],this.dispatchEvent(new q("statechange",{oldState:d,newState:e,originalEvent:a}))}}},{key:"_handleEvents",value:function(a){switch(l&&clearTimeout(this._safariBeforeUnloadTimeout),a.type){case "pageshow":case "resume":this._dispatchChangesIfNeeded(a,w());break;case "focus":this._dispatchChangesIfNeeded(a,"active");break;case "blur":"active"===this._state&&
this._dispatchChangesIfNeeded(a,w());break;case "pagehide":case "unload":this._dispatchChangesIfNeeded(a,a.persisted?"frozen":"terminated");break;case "visibilitychange":"frozen"!==this._state&&"terminated"!==this._state&&this._dispatchChangesIfNeeded(a,w());break;case "freeze":this._dispatchChangesIfNeeded(a,"frozen")}}},{key:"state",get:function(){return this._state}},{key:"pageWasDiscarded",get:function(){return document.wasDiscarded||!1}}]),b}())});
